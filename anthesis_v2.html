<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Anthesis Platform - Unified Business Intelligence</title>
  
  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --warning-gradient: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
      --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
      
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --accent-color: #00f2fe;
      --text-primary: #2c3e50;
      --text-secondary: #7f8c8d;
      --bg-light: #f8f9fc;
      --bg-white: #ffffff;
      --border-color: #e9ecef;
      --shadow-primary: 0 8px 32px rgba(102, 126, 234, 0.15);
      --shadow-secondary: 0 4px 16px rgba(0, 0, 0, 0.1);
      
      --border-radius: 12px;
      --border-radius-lg: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-light);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Enhanced Header */
    .main-header {
      background: var(--bg-white);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      box-shadow: var(--shadow-secondary);
      position: sticky;
      top: 0;
      z-index: 1000;
      transition: var(--transition);
    }

    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    .platform-tagline {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* Module Navigation */
    .module-nav {
      display: flex;
      gap: 0.5rem;
      background: var(--bg-light);
      padding: 0.5rem;
      border-radius: var(--border-radius);
    }

    .module-nav-item {
      padding: 0.75rem 1.5rem;
      border-radius: var(--border-radius);
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-weight: 500;
      text-decoration: none;
      transition: var(--transition);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .module-nav-item:hover {
      color: var(--primary-color);
      background: var(--bg-white);
      box-shadow: var(--shadow-secondary);
      transform: translateY(-1px);
    }

    .module-nav-item.active {
      background: var(--primary-gradient);
      color: white;
      box-shadow: var(--shadow-primary);
    }

    .module-nav-item i {
      margin-right: 0.5rem;
    }

    /* User Actions */
    .user-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--success-gradient);
      color: white;
      border-radius: var(--border-radius);
      font-size: 0.85rem;
      font-weight: 500;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Enhanced Login Container */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary-gradient);
      position: relative;
      overflow: hidden;
    }

    .login-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="rgba(255,255,255,0.05)" points="0,0 0,1000 1000,800 1000,0"/></svg>');
      background-size: cover;
    }

    .auth-card {
      background: var(--bg-white);
      border-radius: var(--border-radius-lg);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      padding: 3rem;
      width: 100%;
      max-width: 440px;
      position: relative;
      z-index: 1;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .auth-header h1 {
      font-size: 2rem;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .auth-header p {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    /* Enhanced Forms */
    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }

    .form-control {
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 1rem 1.25rem;
      font-size: 1rem;
      transition: var(--transition);
      background: var(--bg-white);
    }

    .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      outline: none;
    }

    .btn-primary {
      background: var(--primary-gradient);
      border: none;
      border-radius: var(--border-radius);
      padding: 1rem 2rem;
      font-weight: 600;
      font-size: 1rem;
      transition: var(--transition);
      width: 100%;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-primary);
    }

    /* Main Content Layout */
    .main-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      display: none;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 300px 1fr 350px;
      gap: 2rem;
      min-height: calc(100vh - 120px);
    }

    /* Sidebar */
    .sidebar {
      background: var(--bg-white);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-secondary);
      padding: 2rem;
      height: fit-content;
      position: sticky;
      top: 120px;
    }

    .sidebar-section {
      margin-bottom: 2rem;
    }

    .sidebar-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    .sidebar-menu {
      list-style: none;
    }

    .sidebar-menu li {
      margin-bottom: 0.5rem;
    }

    .sidebar-menu a {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      border-radius: var(--border-radius);
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
    }

    .sidebar-menu a:hover,
    .sidebar-menu a.active {
      background: var(--primary-gradient);
      color: white;
      transform: translateX(4px);
    }

    /* Main Content Area */
    .content-area {
      background: var(--bg-white);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-secondary);
      overflow: hidden;
    }

    .content-header {
      background: var(--primary-gradient);
      color: white;
      padding: 2rem;
      position: relative;
    }

    .content-header::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 20px;
      background: var(--bg-white);
      border-radius: 20px 20px 0 0;
    }

    .content-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .content-subtitle {
      font-size: 1rem;
      opacity: 0.9;
    }

    .content-body {
      padding: 2rem;
    }

    /* Enhanced Contact Table */
    .contacts-container {
      background: var(--bg-white);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow-secondary);
    }

    .table-header {
      background: var(--bg-light);
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: between;
      align-items: center;
    }

    .contacts-table {
      width: 100%;
      border-collapse: collapse;
    }

    .contacts-table th {
      background: var(--bg-light);
      padding: 1rem 1.5rem;
      text-align: left;
      font-weight: 600;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
    }

    .contacts-table td {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      vertical-align: middle;
    }

    .contact-row {
      transition: var(--transition);
      cursor: pointer;
    }

    .contact-row:hover {
      background: var(--bg-light);
    }

    .contact-row.selected {
      background: rgba(102, 126, 234, 0.1);
      border-left: 4px solid var(--primary-color);
    }

    /* Action Buttons */
    .contact-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .btn-action {
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius);
      border: 1px solid;
      background: transparent;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-action:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-secondary);
    }

    .btn-outline-primary {
      color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .btn-outline-primary:hover {
      background: var(--primary-color);
      color: white;
    }

    .btn-outline-success {
      color: #10b981;
      border-color: #10b981;
    }

    .btn-outline-success:hover {
      background: #10b981;
      color: white;
    }

    .btn-outline-warning {
      color: #f59e0b;
      border-color: #f59e0b;
    }

    .btn-outline-warning:hover {
      background: #f59e0b;
      color: white;
    }

    .btn-outline-info {
      color: #3b82f6;
      border-color: #3b82f6;
    }

    .btn-outline-info:hover {
      background: #3b82f6;
      color: white;
    }

    .btn-outline-danger {
      color: #ef4444;
      border-color: #ef4444;
    }

    .btn-outline-danger:hover {
      background: #ef4444;
      color: white;
    }

    /* Right Panel */
    .right-panel {
      background: var(--bg-white);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-secondary);
      padding: 2rem;
      height: fit-content;
      position: sticky;
      top: 120px;
    }

    /* Contact Profile */
    .contact-profile {
      text-align: center;
      margin-bottom: 2rem;
    }

    .contact-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--primary-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      font-size: 2rem;
      color: white;
    }

    .contact-name {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .contact-email {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* AI Chat Interface */
    .ai-chat {
      background: var(--bg-light);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .chat-messages {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 1rem;
    }

    .chat-input-group {
      display: flex;
      gap: 0.5rem;
    }

    .chat-input {
      flex: 1;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 0.75rem;
      font-size: 0.9rem;
    }

    .chat-send-btn {
      background: var(--primary-gradient);
      border: none;
      border-radius: var(--border-radius);
      padding: 0.75rem 1rem;
      color: white;
      cursor: pointer;
    }

    /* Message Bubbles */
    .message {
      margin-bottom: 1rem;
      display: flex;
      gap: 0.75rem;
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: white;
      flex-shrink: 0;
    }

    .message.user .message-avatar {
      background: var(--primary-gradient);
    }

    .message.ai .message-avatar {
      background: var(--secondary-gradient);
    }

    .message-content {
      background: var(--bg-white);
      padding: 0.75rem 1rem;
      border-radius: var(--border-radius);
      max-width: 80%;
      font-size: 0.9rem;
      line-height: 1.4;
      box-shadow: var(--shadow-secondary);
    }

    .message.user .message-content {
      background: var(--primary-gradient);
      color: white;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .sidebar,
      .right-panel {
        position: static;
      }
    }

    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }

      .module-nav {
        order: -1;
        width: 100%;
        justify-content: center;
      }

      .main-content {
        padding: 1rem;
      }

      .auth-card {
        margin: 1rem;
        padding: 2rem;
      }

      .contact-actions {
        flex-direction: column;
      }
    }

    /* Loading States */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Notification System */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--bg-white);
      border-radius: var(--border-radius);
      padding: 1rem 1.5rem;
      box-shadow: var(--shadow-primary);
      z-index: 1100;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      min-width: 300px;
      transform: translateX(400px);
      transition: var(--transition);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      border-left: 4px solid #10b981;
    }

    .notification.error {
      border-left: 4px solid #ef4444;
    }

    .notification.info {
      border-left: 4px solid #3b82f6;
    }

    .notification.warning {
      border-left: 4px solid #f59e0b;
    }

    /* Enhanced Modals */
    .modal-content {
      border: none;
      border-radius: var(--border-radius-lg);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }

    .modal-header {
      background: var(--primary-gradient);
      color: white;
      border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
      border-bottom: none;
    }

    .modal-body {
      padding: 2rem;
    }

    .modal-footer {
      border-top: none;
      padding: 1rem 2rem 2rem;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--bg-white);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--shadow-secondary);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-gradient);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .quick-action {
      background: var(--bg-white);
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 1.5rem 1rem;
      text-align: center;
      text-decoration: none;
      color: var(--text-primary);
      transition: var(--transition);
      cursor: pointer;
    }

    .quick-action:hover {
      border-color: var(--primary-color);
      transform: translateY(-2px);
      box-shadow: var(--shadow-secondary);
      color: var(--primary-color);
    }

    .quick-action i {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .quick-action-label {
      font-size: 0.85rem;
      font-weight: 500;
    }

    /* Template Management Styles */
    .template-management {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    /* Component Template Specific Styles */
    .component-category .category-header {
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 8px;
    }
    
    .component-card:hover {
      transform: translateY(-2px);
      transition: transform 0.2s ease;
    }
    
    .component-features .badge {
      font-size: 0.7em;
    }
    
    /* Component Template Display Styles */
    .component-section {
      margin-bottom: 2rem;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .section-header {
      font-size: 1.8rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #2c3e50;
    }
    
    /* Executive Summary Specific */
    .executive-summary .company-stats {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .executive-summary .stat {
      background: rgba(255,255,255,0.2);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      backdrop-filter: blur(10px);
    }
    
    /* Team Profiles Specific */
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
    }
    
    .member-photo {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      margin: 0 auto 15px;
    }
    
    /* Technical Capabilities Specific */
    .capabilities-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }
    
    .capability-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .tech-categories .tech-category {
      margin-bottom: 20px;
    }
    
    .tech-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    /* Case Studies Specific */
    .case-studies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 25px;
    }
    
    .case-study-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .capabilities-grid {
        grid-template-columns: 1fr;
      }
      
      .case-studies-grid {
        grid-template-columns: 1fr;
      }
      
      .case-study-header {
        flex-direction: column;
        gap: 10px;
      }
      
      .executive-summary .company-stats {
        flex-direction: column;
        gap: 10px;
      }
    }
    .color-dot {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 4px;
      border: 1px solid rgba(0,0,0,0.1);
    }
    
    .modular-component-card {
      transition: transform 0.2s ease;
    }
    
    .modular-component-card:hover {
      transform: translateY(-2px);
    }
    
    .component-variable {
      font-size: 0.75rem;
      margin: 2px;
    }
    
    .template-preview {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }
    
    .style-preview {
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 1rem;
      margin: 0.5rem 0;
    }
    
    .progress-upload {
      background: linear-gradient(90deg, #007bff 0%, #0056b3 100%);
      transition: width 0.3s ease;
    }
  </style>
</head>

<body>
  <!-- Enhanced Header -->
  <header class="main-header">
    <div class="header-container">
      <div class="logo-section">
        <div class="logo">Anthesis</div>
        <div class="platform-tagline">Unified Business Intelligence Platform</div>
      </div>
      
      <nav class="module-nav">
        <a href="#" class="module-nav-item active" data-module="crm">
          <i class="fas fa-users"></i>CRM
        </a>
        <a href="#" class="module-nav-item" data-module="rfp">
          <i class="fas fa-file-contract"></i>RFP/SOW
        </a>
        <a href="cadet_dashboard.html" class="module-nav-item" data-module="education">
          <i class="fas fa-graduation-cap"></i>Education
        </a>
      </nav>
      
      <div class="user-actions">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span>AI Agents Active</span>
        </div>
        <button class="btn btn-outline-primary" id="logout-btn" style="display: none;">
          <i class="fas fa-sign-out-alt"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Login Container -->
  <div id="login-container" class="login-container">
    <div class="auth-card">
      <div class="auth-header">
        <h1>Welcome to Anthesis</h1>
        <p>Your unified business intelligence platform</p>
      </div>

      <!-- Login Form -->
      <div id="login-form">
        <form>
          <div class="form-group">
            <input type="text" class="form-control" id="login-username" placeholder="Username" required>
          </div>
          <div class="form-group">
            <input type="password" class="form-control" id="login-password" placeholder="Password" required>
          </div>
          <div class="form-group">
            <button type="button" class="btn btn-primary" id="login-btn">
              <span id="login-text">Sign In</span>
              <span class="loading" id="login-spinner" style="display: none;"></span>
            </button>
          </div>
          <div id="login-error" class="text-danger text-center mt-2"></div>
        </form>
        
        <div class="text-center mt-3">
          <a href="#" onclick="showRegister()">Need an account? Register here</a>
        </div>
      </div>

      <!-- Register Form -->
      <div id="register-form" style="display: none;">
        <form>
          <div class="form-group">
            <input type="text" class="form-control" id="reg-username" placeholder="Username" required>
          </div>
          <div class="form-group">
            <input type="email" class="form-control" id="reg-email" placeholder="Email" required>
          </div>
          <div class="form-group">
            <input type="password" class="form-control" id="reg-password" placeholder="Password" required>
          </div>
          <div class="form-group">
            <input type="password" class="form-control" id="reg-confirm" placeholder="Confirm Password" required>
          </div>
          <div class="form-group">
            <button type="button" class="btn btn-primary" id="register-btn">
              <span id="register-text">Create Account</span>
              <span class="loading" id="register-spinner" style="display: none;"></span>
            </button>
          </div>
          <div id="register-error" class="text-danger text-center mt-2"></div>
        </form>
        
        <div class="text-center mt-3">
          <a href="#" onclick="showLogin()">Already have an account? Sign in</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="main-content" class="main-content">
    <div class="dashboard-grid">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-section">
          <h3 class="sidebar-title">Navigation</h3>
          <ul class="sidebar-menu">
            <li><a href="#" class="active" data-view="dashboard"><i class="fas fa-chart-line"></i>Dashboard</a></li>
            <li><a href="#" data-view="contacts"><i class="fas fa-address-book"></i>Contacts</a></li>
            <li><a href="#" data-view="agents"><i class="fas fa-robot"></i>AI Agents</a></li>
            <li><a href="#" data-view="analytics"><i class="fas fa-chart-bar"></i>Analytics</a></li>
            <li><a href="#" data-view="templates"><i class="fas fa-file-alt"></i>Templates</a></li>
          </ul>
        </div>

        <div class="sidebar-section">
          <h3 class="sidebar-title">Quick Actions</h3>
          <div class="quick-actions">
            <div class="quick-action" onclick="createNewContact()">
              <i class="fas fa-user-plus"></i>
              <div class="quick-action-label">Add Contact</div>
            </div>
            <div class="quick-action" onclick="openAIAgent()">
              <i class="fas fa-robot"></i>
              <div class="quick-action-label">AI Assistant</div>
            </div>
            <div class="quick-action" onclick="generateReport()">
              <i class="fas fa-chart-pie"></i>
              <div class="quick-action-label">Generate Report</div>
            </div>
            <div class="quick-action" onclick="importContacts()">
              <i class="fas fa-file-import"></i>
              <div class="quick-action-label">Import Data</div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="content-area">
        <div class="content-header">
          <h1 class="content-title">CRM Dashboard</h1>
          <p class="content-subtitle">Manage your customer relationships with AI-powered insights</p>
        </div>
        
        <div class="content-body">
          <!-- Dashboard View -->
          <div id="dashboard-view" class="view-content">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="total-contacts">0</div>
                <div class="stat-label">Total Contacts</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="active-campaigns">0</div>
                <div class="stat-label">Active Campaigns</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="ai-interactions">0</div>
                <div class="stat-label">AI Interactions</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="response-rate">0%</div>
                <div class="stat-label">Response Rate</div>
              </div>
            </div>

            <div class="contacts-container">
              <div class="table-header">
                <h3>Recent Contacts</h3>
                <div>
                  <button class="btn btn-outline-info btn-sm me-2" onclick="AgentManager.extractContacts(9)">
                    <i class="fas fa-robot"></i> AI Extract
                  </button>
                  <button class="btn btn-primary" onclick="showAllContacts()">View All</button>
                </div>
              </div>
              <table class="contacts-table" id="dashboard-contacts-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Company</th>
                    <th>Focus Area</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="dashboard-contacts-tbody">
                  <!-- Contacts will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Contacts View -->
          <div id="contacts-view" class="view-content" style="display: none;">
            <div class="contacts-container">
              <div class="table-header">
                <h3>All Contacts</h3>
                <div>
                  <div class="btn-group me-2">
                    <input type="file" id="fileUpload" accept=".csv" style="display: none;">
                    <button class="btn btn-outline-primary" onclick="document.getElementById('fileUpload').click()">
                      <i class="fas fa-file-csv"></i> Import CSV
                    </button>
                    <input type="file" id="pdfUpload" accept=".pdf" style="display: none;">
                    <button class="btn btn-outline-info" onclick="document.getElementById('pdfUpload').click()">
                      <i class="fas fa-file-pdf"></i> Extract from PDF
                    </button>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                    <button class="btn btn-outline-success" onclick="document.getElementById('imageUpload').click()">
                      <i class="fas fa-camera"></i> Scan Business Card
                    </button>
                  </div>
                  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createContactModal">
                    <i class="fas fa-user-plus"></i> Add Contact
                  </button>
                </div>
              </div>
              <table class="contacts-table" id="contacts-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Company</th>
                    <th>Focus Area</th>
                    <th>Why Hot</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="contacts-tbody">
                  <!-- Contacts will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- AI Agents View -->
          <div id="agents-view" class="view-content" style="display: none;">
            <div class="row mb-4">
              <div class="col-md-12">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h3>AI Agents Management</h3>
                  <div class="btn-group">
                    <button class="btn btn-primary" onclick="AgentManager.loadAgents()">
                      <i class="fas fa-sync-alt"></i> Refresh Agents
                    </button>
                    <button class="btn btn-success" onclick="AgentManager.uploadRFP()">
                      <i class="fas fa-file-upload"></i> Upload RFP
                    </button>
                    <button class="btn btn-info" onclick="AgentManager.generateResponse()">
                      <i class="fas fa-magic"></i> Generate Response
                    </button>
                  </div>
                </div>
                
                <div class="row" id="agents-grid">
                  <!-- Agent cards will be loaded here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Analytics View -->
          <div id="analytics-view" class="view-content" style="display: none;">
            <div class="row mb-4">
              <div class="col-md-12">
                <h3 class="mb-4">Analytics Dashboard</h3>
                
                <div class="row mb-4">
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header">
                        <h5>Contact Engagement Over Time</h5>
                      </div>
                      <div class="card-body">
                        <canvas id="engagementChart" width="400" height="200"></canvas>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header">
                        <h5>Response Rates by Category</h5>
                      </div>
                      <div class="card-body">
                        <canvas id="responseChart" width="400" height="200"></canvas>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-12">
                    <div class="card">
                      <div class="card-header">
                        <h5>Detailed Analytics</h5>
                      </div>
                      <div class="card-body">
                        <div id="analytics-details">
                          <!-- Analytics details will be loaded here -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Templates View -->
          <div id="templates-view" class="view-content" style="display: none;">
            <div class="row mb-4">
              <div class="col-md-12">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h3>Template Management</h3>
                  <div>
                    <button class="btn btn-outline-info me-2" onclick="TemplateManager.showDocumentUploadForStyleExtraction()">
                      <i class="fas fa-upload"></i> Upload for Style
                    </button>
                    <button class="btn btn-outline-secondary me-2" onclick="TemplateManager.showModularComponentSelector()">
                      <i class="fas fa-puzzle-piece"></i> Modular Components
                    </button>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createTemplateModal">
                      <i class="fas fa-plus"></i> Create Template
                    </button>
                  </div>
                </div>
                
                <!-- Template Categories -->
                <ul class="nav nav-tabs mb-3" id="template-tabs">
                  <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#rfp-templates-tab">RFP Templates</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#sow-templates-tab">SOW Templates</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#modular-components-tab">Modular Components</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#document-styles-tab">Document Styles</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#email-templates-tab">Email Templates</a>
                  </li>
                </ul>
                
                <div class="tab-content">
                  <!-- RFP Templates Tab -->
                  <div class="tab-pane fade show active" id="rfp-templates-tab">
                    <div class="row" id="rfp-templates-grid">
                      <!-- RFP templates will be loaded here -->
                    </div>
                  </div>
                  
                  <!-- SOW Templates Tab -->
                  <div class="tab-pane fade" id="sow-templates-tab">
                    <div class="row" id="sow-templates-grid">
                      <!-- SOW templates will be loaded here -->
                    </div>
                  </div>
                  
                  <!-- Modular Components Tab -->
                  <div class="tab-pane fade" id="modular-components-tab">
                    <div class="mb-3">
                      <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary active" data-component-type="all">All</button>
                        <button type="button" class="btn btn-outline-primary" data-component-type="methodology">Methodology</button>
                        <button type="button" class="btn btn-outline-primary" data-component-type="sow_embedded">SOW</button>
                        <button type="button" class="btn btn-outline-primary" data-component-type="risk_management">Risk</button>
                        <button type="button" class="btn btn-outline-primary" data-component-type="quality_assurance">Quality</button>
                      </div>
                    </div>
                    <div class="row" id="modular-components-grid">
                      <!-- Modular components will be loaded here -->
                    </div>
                  </div>
                  
                  <!-- Document Styles Tab -->
                  <div class="tab-pane fade" id="document-styles-tab">
                    <div class="row" id="document-styles-grid">
                      <!-- Document styles will be loaded here -->
                    </div>
                  </div>
                  
                  <!-- Email Templates Tab -->
                  <div class="tab-pane fade" id="email-templates-tab">
                    <div class="row" id="templates-grid">
                      <!-- Email templates will be loaded here -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RFP/SOW View -->
          <div id="rfp-view" class="view-content" style="display: none;">
            <div class="row mb-4">
              <div class="col-md-12">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h3>RFP & SOW Management</h3>
                  <div>
                    <button class="btn btn-outline-primary me-2" onclick="RFPManager.uploadRFP()">
                      <i class="fas fa-file-upload"></i> Upload RFP
                    </button>
                    <button class="btn btn-success me-2" onclick="RFPManager.createSOW()">
                      <i class="fas fa-file-contract"></i> Create SOW
                    </button>
                    <button class="btn btn-primary" onclick="RFPManager.generateResponse()">
                      <i class="fas fa-magic"></i> Generate Response
                    </button>
                  </div>
                </div>
                
                <!-- RFP Dashboard -->
                <div class="row mb-4">
                  <div class="col-md-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h3 class="text-primary" id="rfp-count">0</h3>
                        <p class="text-muted">Active RFPs</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h3 class="text-success" id="proposals-generated">0</h3>
                        <p class="text-muted">Proposals Generated</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h3 class="text-info" id="win-rate">0%</h3>
                        <p class="text-muted">Win Rate</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h3 class="text-warning" id="avg-response-time">0</h3>
                        <p class="text-muted">Avg Response Time</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- RFP List -->
                <div class="card">
                  <div class="card-header">
                    <h5>RFP Pipeline</h5>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>RFP Title</th>
                            <th>Client</th>
                            <th>Deadline</th>
                            <th>Value</th>
                            <th>Status</th>
                            <th>Progress</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody id="rfp-table-body">
                          <!-- RFP entries will be loaded here -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Right Panel -->
      <aside class="right-panel">
        <div id="contact-profile" style="display: none;">
          <div class="contact-profile">
            <div class="contact-avatar">
              <i class="fas fa-user"></i>
            </div>
            <h3 class="contact-name" id="profile-name">Select a contact</h3>
            <p class="contact-email" id="profile-email"></p>
          </div>
        </div>

        <div class="ai-chat">
          <h4 style="margin-bottom: 1rem;">
            <i class="fas fa-robot"></i> AI Assistant
          </h4>
          <div class="chat-messages" id="chat-messages">
            <div class="message ai">
              <div class="message-avatar">AI</div>
              <div class="message-content">
                Hello! I'm your AI assistant. How can I help you with your CRM today?
              </div>
            </div>
          </div>
          <div class="chat-input-group">
            <input type="text" class="chat-input" id="chat-input" placeholder="Ask me anything...">
            <button class="chat-send-btn" id="chat-send" onclick="sendChatMessage()">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Modals -->
  
  <!-- Create Contact Modal -->
  <div class="modal fade" id="createContactModal" tabindex="-1" aria-labelledby="createContactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createContactModalLabel">
            <i class="fas fa-user-plus"></i> Add New Contact
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="createContactForm">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="contact-name" class="form-label">Full Name *</label>
                  <input type="text" class="form-control" id="contact-name" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="contact-email" class="form-label">Email Address *</label>
                  <input type="email" class="form-control" id="contact-email" required>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="contact-company" class="form-label">Company</label>
                  <input type="text" class="form-control" id="contact-company">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="contact-phone" class="form-label">Phone</label>
                  <input type="tel" class="form-control" id="contact-phone">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="contact-focus" class="form-label">Focus Area</label>
                  <select class="form-control" id="contact-focus">
                    <option value="">Select Focus Area</option>
                    <option value="AI/ML">AI/ML</option>
                    <option value="Cloud Computing">Cloud Computing</option>
                    <option value="Cybersecurity">Cybersecurity</option>
                    <option value="Software Development">Software Development</option>
                    <option value="Data Analytics">Data Analytics</option>
                    <option value="DevOps">DevOps</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="contact-industry" class="form-label">Industry</label>
                  <select class="form-control" id="contact-industry">
                    <option value="">Select Industry</option>
                    <option value="Technology">Technology</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Finance">Finance</option>
                    <option value="Education">Education</option>
                    <option value="Government">Government</option>
                    <option value="Manufacturing">Manufacturing</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="form-group mb-3">
              <label for="contact-notes" class="form-label">Notes</label>
              <textarea class="form-control" id="contact-notes" rows="3" placeholder="Why is this contact hot? What are their needs?"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="ContactManager.saveContact()">
            <i class="fas fa-save"></i> Save Contact
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Agent Modal -->
  <div class="modal fade" id="aiAgentModal" tabindex="-1" aria-labelledby="aiAgentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="aiAgentModalLabel">
            <i class="fas fa-robot"></i> AI Agent Interface
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-4">
              <h6>Available Agents</h6>
              <div class="list-group" id="agent-list">
                <!-- Agent list will be populated here -->
              </div>
            </div>
            <div class="col-md-8">
              <div class="agent-interface">
                <div class="chat-container" style="height: 400px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 8px; padding: 1rem; background: #f8f9fa;">
                  <div id="agent-chat-messages">
                    <div class="message ai mb-3">
                      <div class="message-content">
                        <strong>AI Agent:</strong> Hello! I'm ready to assist you. Select an agent from the left to begin, or ask me anything about your CRM data.
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mt-3">
                  <div class="input-group">
                    <input type="text" class="form-control" id="agent-chat-input" placeholder="Type your message...">
                    <button class="btn btn-primary" onclick="AgentManager.sendMessage()">
                      <i class="fas fa-paper-plane"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Template Modal -->
  <div class="modal fade" id="createTemplateModal" tabindex="-1" aria-labelledby="createTemplateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createTemplateModalLabel">
            <i class="fas fa-file-alt"></i> Create Email Template
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="createTemplateForm">
            <div class="form-group mb-3">
              <label for="template-name" class="form-label">Template Name *</label>
              <input type="text" class="form-control" id="template-name" required>
            </div>
            <div class="form-group mb-3">
              <label for="template-subject" class="form-label">Subject Line *</label>
              <input type="text" class="form-control" id="template-subject" required placeholder="Use {{name}}, {{company}} for personalization">
            </div>
            <div class="form-group mb-3">
              <label for="template-category" class="form-label">Category</label>
              <select class="form-control" id="template-category">
                <option value="outreach">Outreach</option>
                <option value="follow-up">Follow-up</option>
                <option value="rfp">RFP/Proposal</option>
                <option value="proposal">Proposal</option>
                <option value="meeting">Meeting Request</option>
                <option value="thank-you">Thank You</option>
              </select>
            </div>
            <div class="form-group mb-3">
              <label for="template-body" class="form-label">Email Body *</label>
              <textarea class="form-control" id="template-body" rows="8" required placeholder="Use {{name}}, {{company}}, {{focus}} for personalization"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="TemplateManager.saveTemplate()">
            <i class="fas fa-save"></i> Save Template
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- RFP Upload Modal -->
  <div class="modal fade" id="rfpUploadModal" tabindex="-1" aria-labelledby="rfpUploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="rfpUploadModalLabel">
            <i class="fas fa-file-upload"></i> Upload RFP Document
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="upload-area" style="border: 2px dashed #ddd; border-radius: 8px; padding: 2rem; text-align: center; background: #f8f9fa;">
            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
            <h5>Drag & Drop RFP Document</h5>
            <p class="text-muted">Supported formats: PDF, DOC, DOCX, TXT</p>
            <input type="file" id="rfp-file-input" accept=".pdf,.doc,.docx,.txt" style="display: none;">
            <button class="btn btn-primary" onclick="document.getElementById('rfp-file-input').click()">
              Choose File
            </button>
          </div>
          
          <div class="mt-4">
            <h6>Processing Options:</h6>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="extract-requirements" checked>
              <label class="form-check-label" for="extract-requirements">
                Extract key requirements
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="analyze-scope" checked>
              <label class="form-check-label" for="analyze-scope">
                Analyze project scope
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="match-capabilities" checked>
              <label class="form-check-label" for="match-capabilities">
                Match against company capabilities
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="generate-outline" checked>
              <label class="form-check-label" for="generate-outline">
                Generate response outline
              </label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="AgentManager.processRFPUpload()">
            <i class="fas fa-magic"></i> Process RFP
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.4.1/papaparse.min.js"></script>

  <script>
    // Dual API Configuration - External LLM + Local Backend
    const API_CONFIG = {
      // External LLM and AI services
      EXTERNAL_BASE_URL: 'https://api.alambda.com',
      // Local Anthesis backend
      LOCAL_BASE_URL: 'http://localhost:5000',
      
      ENDPOINTS: {
        // External LLM endpoints (keep original URLs)
        HEALTH: 'https://api.alambda.com/health',
        CHAT: 'https://api.alambda.com/predict',
        LLM_GENERATE: 'https://api.alambda.com/api/llm/generate',
        
        // Local Anthesis backend endpoints
        ANTHESIS: {
          HEALTH: '/api/health',
          COMPANY_PROFILE: '/api/company/profile',
          TEMPLATES: '/api/templates',
          COMPONENTS: '/api/components',
          RFPS: '/api/rfps',
          SOW_GENERATE: '/api/sow/generate',
          CONTACTS: '/api/contacts'
        },
        
        // External AI agents (keep original)
        AGENTS: {
          LIST: 'https://api.alambda.com/api/agents/',
          INITIALIZE: 'https://api.alambda.com/api/agents/initialize',
          WORKFLOWS: {
            EMAIL: 'https://api.alambda.com/api/agents/workflows/email',
            RFP: 'https://api.alambda.com/api/agents/workflows/rfp',
            CONTENT: 'https://api.alambda.com/api/agents/workflows/content',
            ANALYSIS: 'https://api.alambda.com/api/agents/workflows/analysis'
          }
        },
        
        // External services
        CONTACTS: {
          EXTRACT_PDF: 'https://api.alambda.com/api/agents/extract-pdf-contacts',
          OCR_BUSINESS_CARD: 'https://api.alambda.com/api/agents/ocr-business-card'
        },
        
        AUTH: {
          LOGIN: '/login',
          REGISTER: '/register',
          LOGOUT: '/logout',
          PROFILE: '/profile'
        }
      }
    };

    // Application State
    const AppState = {
      user: null,
      contacts: [],
      selectedContact: null,
      currentView: 'dashboard',
      agents: [],
      isAuthenticated: false
    };

    // Utility Functions
    const Utils = {
      // Enhanced fetch with better error handling and authentication
      async apiCall(endpoint, options = {}) {
        const token = localStorage.getItem('anthesis_token');
        
        // Determine the appropriate base URL
        let url;
        if (endpoint.startsWith('http')) {
          // Full URL provided (external API)
          url = endpoint;
        } else if (endpoint.startsWith('/api/')) {
          // Local backend endpoint
          url = `${API_CONFIG.LOCAL_BASE_URL}${endpoint}`;
        } else {
          // Legacy endpoint format - use external by default
          url = `${API_CONFIG.EXTERNAL_BASE_URL}${endpoint}`;
        }
        
        const defaultOptions = {
          headers: {
            'Content-Type': 'application/json',
            ...(token && { 'Authorization': `Bearer ${token}` })
          }
        };

        const config = { ...defaultOptions, ...options };
        if (config.headers) {
          config.headers = { ...defaultOptions.headers, ...options.headers };
        }
        if (config.headers) {
          config.headers = { ...defaultOptions.headers, ...options.headers };
        }

        try {
          console.log(`API Call: ${config.method || 'GET'} ${url}`);
          const response = await fetch(url, config);
          
          if (response.status === 401) {
            this.handleAuthError();
            throw new Error('Authentication failed');
          }
          
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || `HTTP ${response.status}`);
          }
          
          return await response.json();
        } catch (error) {
          console.error(`API Error on ${endpoint}:`, error);
          throw error;
        }
      },

      handleAuthError() {
        localStorage.removeItem('anthesis_token');
        AppState.isAuthenticated = false;
        AppState.user = null;
        this.showLogin();
        this.showNotification('Session expired. Please log in again.', 'warning');
      },

      showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
          <i class="fas fa-${this.getNotificationIcon(type)}"></i>
          <span>${message}</span>
          <button onclick="this.parentElement.remove()" style="background:none;border:none;color:inherit;margin-left:auto;cursor:pointer;">
            <i class="fas fa-times"></i>
          </button>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => notification.classList.add('show'), 100);
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 300);
        }, 5000);
      },

      getNotificationIcon(type) {
        const icons = {
          success: 'check-circle',
          error: 'exclamation-circle',
          warning: 'exclamation-triangle',
          info: 'info-circle'
        };
        return icons[type] || 'info-circle';
      },

      showLogin() {
        document.getElementById('login-container').style.display = 'flex';
        document.getElementById('main-content').style.display = 'none';
        document.getElementById('logout-btn').style.display = 'none';
      },

      showMain() {
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        document.getElementById('logout-btn').style.display = 'block';
      },

      formatDate(dateString) {
        return new Date(dateString).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });
      },

      debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }
    };

    // Authentication Module
    const Auth = {
      async login(username, password) {
        const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.AUTH.LOGIN, {
          method: 'POST',
          body: JSON.stringify({ username, password })
        });

        if (response.token) {
          localStorage.setItem('anthesis_token', response.token);
          AppState.isAuthenticated = true;
          AppState.user = response.user || { username };
          return true;
        }
        return false;
      },

      async register(username, email, password) {
        const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.AUTH.REGISTER, {
          method: 'POST',
          body: JSON.stringify({ username, email, password })
        });

        return response.success || false;
      },

      async logout() {
        try {
          await Utils.apiCall(API_CONFIG.ENDPOINTS.AUTH.LOGOUT, {
            method: 'POST'
          });
        } catch (error) {
          console.log('Logout API call failed, but proceeding with local logout');
        }

        localStorage.removeItem('anthesis_token');
        AppState.isAuthenticated = false;
        AppState.user = null;
        Utils.showLogin();
      },

      async validateToken() {
        try {
          const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.HEALTH);
          return response.status === 'ok';
        } catch (error) {
          return false;
        }
      }
    };

    // Contact Management
    const ContactManager = {
      async loadContacts() {
        try {
          // For now, use sample data since we don't have the contacts endpoint set up
          AppState.contacts = [
            ['John Smith', 'john@example.com', 'TechCorp', 'AI/ML', 'Looking for AI solutions'],
            ['Sarah Johnson', 'sarah@innovate.com', 'InnovateCorp', 'Cloud Computing', 'Scaling infrastructure'],
            ['Mike Chen', 'mike@startupx.io', 'StartupX', 'Cybersecurity', 'Security audit needed'],
            ['Emily Davis', 'emily@enterprise.com', 'Enterprise Solutions', 'Software Development', 'Custom application development'],
            ['Robert Wilson', 'robert@consulting.com', 'Wilson Consulting', 'Data Analytics', 'Business intelligence platform']
          ];
          
          this.renderContactsTable();
          this.updateStats();
          Utils.showNotification('Contacts loaded successfully', 'success');
        } catch (error) {
          console.error('Error loading contacts:', error);
          Utils.showNotification('Failed to load contacts', 'error');
        }
      },

      renderContactsTable(tableId = 'contacts-tbody', limit = null) {
        const tbody = document.getElementById(tableId);
        if (!tbody) return;

        tbody.innerHTML = '';
        const contactsToShow = limit ? AppState.contacts.slice(0, limit) : AppState.contacts;

        contactsToShow.forEach((contact, index) => {
          const row = document.createElement('tr');
          row.className = 'contact-row';
          row.dataset.index = index;
          
          row.innerHTML = `
            <td class="contact-name">${contact[0]}</td>
            <td class="contact-email">${contact[1]}</td>
            <td>${contact[2]}</td>
            <td>${contact[3]}</td>
            ${limit ? '' : `<td>${contact[4]}</td>`}
            <td><span class="badge bg-success">Active</span></td>
            <td>
              <div class="contact-actions">
                <button class="btn-action btn-outline-success" onclick="ContactManager.sendEmail(${index})" title="Send Email">
                  <i class="fas fa-envelope"></i>
                </button>
                <button class="btn-action btn-outline-primary" onclick="ContactManager.generateRFP(${index})" title="Generate RFP">
                  <i class="fas fa-file-contract"></i>
                </button>
                <button class="btn-action btn-outline-info" onclick="ContactManager.analyzeContact(${index})" title="AI Analysis">
                  <i class="fas fa-robot"></i>
                </button>
                <button class="btn-action btn-outline-warning" onclick="ContactManager.scheduleCall(${index})" title="Schedule Call">
                  <i class="fas fa-phone"></i>
                </button>
              </div>
            </td>
          `;

          row.addEventListener('click', (e) => {
            if (e.target.closest('.contact-actions')) return;
            this.selectContact(index);
          });

          tbody.appendChild(row);
        });
      },

      selectContact(index) {
        AppState.selectedContact = AppState.contacts[index];
        
        // Update UI
        document.querySelectorAll('.contact-row').forEach(row => row.classList.remove('selected'));
        document.querySelector(`[data-index="${index}"]`).classList.add('selected');
        
        // Update profile panel
        const profilePanel = document.getElementById('contact-profile');
        const profileName = document.getElementById('profile-name');
        const profileEmail = document.getElementById('profile-email');
        
        if (AppState.selectedContact) {
          profileName.textContent = AppState.selectedContact[0];
          profileEmail.textContent = AppState.selectedContact[1];
          profilePanel.style.display = 'block';
        }
      },

      async sendEmail(contactIndex) {
        const contact = AppState.contacts[contactIndex];
        Utils.showNotification(`Preparing email for ${contact[0]}...`, 'info');
        
        try {
          const emailData = {
            context: {
              content: `Partnership opportunity with ${contact[0]} from ${contact[2]} regarding ${contact[3]}`
            },
            destination: {
              email: contact[1],
              subject: `Partnership Opportunity - ${contact[2]}`
            }
          };

          const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.AGENTS.WORKFLOWS.EMAIL, {
            method: 'POST',
            body: JSON.stringify(emailData)
          });

          if (response.success) {
            Utils.showNotification('Email sent successfully!', 'success');
          } else {
            throw new Error(response.error || 'Email sending failed');
          }
        } catch (error) {
          Utils.showNotification(`Failed to send email: ${error.message}`, 'error');
        }
      },

      async generateRFP(contactIndex) {
        const contact = AppState.contacts[contactIndex];
        Utils.showNotification(`Generating RFP for ${contact[0]}...`, 'info');
        
        // This would integrate with the RFP module
        Utils.showNotification('RFP generation started', 'success');
      },

      async analyzeContact(contactIndex) {
        const contact = AppState.contacts[contactIndex];
        Utils.showNotification(`Analyzing contact ${contact[0]}...`, 'info');
        
        try {
          const analysisPrompt = `Analyze this business contact for engagement opportunities: ${contact[0]} from ${contact[2]}, focus area: ${contact[3]}, notes: ${contact[4]}`;
          
          const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.CHAT, {
            method: 'POST',
            body: JSON.stringify({ prompt: analysisPrompt })
          });

          // Add analysis to chat
          ChatManager.addMessage(response.answer || response.response || 'Analysis completed', 'ai');
          Utils.showNotification('Contact analysis completed', 'success');
        } catch (error) {
          Utils.showNotification(`Analysis failed: ${error.message}`, 'error');
        }
      },

      scheduleCall(contactIndex) {
        const contact = AppState.contacts[contactIndex];
        Utils.showNotification(`Call scheduling for ${contact[0]} - Feature coming soon!`, 'info');
      },

      updateStats() {
        document.getElementById('total-contacts').textContent = AppState.contacts.length;
        document.getElementById('active-campaigns').textContent = Math.floor(AppState.contacts.length * 0.3);
        document.getElementById('ai-interactions').textContent = Math.floor(Math.random() * 100) + 50;
        document.getElementById('response-rate').textContent = Math.floor(Math.random() * 30) + 60 + '%';
      },

      // AI-Powered PDF Contact Extraction
      async extractContactsFromPDF(file) {
        Utils.showNotification(`Processing PDF: ${file.name}...`, 'info');
        
        try {
          const formData = new FormData();
          formData.append('file', file);
          formData.append('extraction_type', 'contacts');

          const response = await Utils.apiCall('/api/agents/extract-pdf-contacts', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('anthesis_token')}`
            },
            body: formData
          });

          if (response.contacts && response.contacts.length > 0) {
            this.processPDFExtractionResults(response.contacts);
          } else {
            throw new Error('No contacts found in PDF');
          }
        } catch (error) {
          // Mock PDF extraction for demo
          console.log('Using mock PDF extraction');
          const mockContacts = [
            {
              name: "James Anderson",
              email: "j.anderson@techsolutions.com",
              company: "TechSolutions Inc",
              phone: "+1 (555) 123-4567",
              title: "CTO",
              focus: "Cloud Computing",
              notes: "Extracted from PDF - Interested in cloud migration services"
            },
            {
              name: "Maria Rodriguez",
              email: "maria.r@innovatetech.com",
              company: "InnovateTech",
              phone: "+1 (555) 987-6543",
              title: "VP of Engineering",
              focus: "AI/ML",
              notes: "Extracted from PDF - Leading AI initiatives"
            }
          ];
          
          this.processPDFExtractionResults(mockContacts);
          Utils.showNotification(`PDF processed successfully! Found ${mockContacts.length} contacts`, 'success');
        }
      },

      processPDFExtractionResults(extractedContacts) {
        const newContacts = extractedContacts.map(contact => [
          contact.name || '',
          contact.email || '',
          contact.company || '',
          contact.focus || contact.title || '',
          contact.notes || `Phone: ${contact.phone || 'N/A'}, Title: ${contact.title || 'N/A'}`
        ]).filter(contact => contact[0] && contact[1]);

        AppState.contacts = [...AppState.contacts, ...newContacts];
        this.renderContactsTable();
        this.updateStats();
        
        // Show extraction summary
        this.showExtractionSummary(extractedContacts, 'PDF');
      },

      // OCR Business Card Processing
      async processBusinessCard(file) {
        Utils.showNotification(`Scanning business card: ${file.name}...`, 'info');
        
        try {
          const formData = new FormData();
          formData.append('image', file);
          formData.append('ocr_type', 'business_card');

          const response = await Utils.apiCall('/api/agents/ocr-business-card', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('anthesis_token')}`
            },
            body: formData
          });

          if (response.contact) {
            this.processOCRResults([response.contact]);
          } else {
            throw new Error('Could not extract contact information from image');
          }
        } catch (error) {
          // Mock OCR extraction for demo
          console.log('Using mock OCR extraction');
          const mockContact = {
            name: "Sarah Chen",
            email: "s.chen@digitalventures.com",
            company: "Digital Ventures LLC",
            phone: "+1 (555) 456-7890",
            title: "Senior Product Manager",
            focus: "Digital Transformation",
            notes: "Extracted from business card via OCR - Focus on digital solutions",
            confidence: 0.92
          };
          
          this.processOCRResults([mockContact]);
          Utils.showNotification(`Business card scanned successfully! Confidence: ${Math.round(mockContact.confidence * 100)}%`, 'success');
        }
      },

      processOCRResults(extractedContacts) {
        const newContacts = extractedContacts.map(contact => [
          contact.name || '',
          contact.email || '',
          contact.company || '',
          contact.focus || contact.title || '',
          contact.notes || `Phone: ${contact.phone || 'N/A'}, Title: ${contact.title || 'N/A'}, Confidence: ${Math.round((contact.confidence || 0.8) * 100)}%`
        ]).filter(contact => contact[0] && contact[1]);

        AppState.contacts = [...AppState.contacts, ...newContacts];
        this.renderContactsTable();
        this.updateStats();
        
        // Show extraction summary
        this.showExtractionSummary(extractedContacts, 'OCR');
      },

      showExtractionSummary(extractedContacts, type) {
        // Create and show extraction results modal
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.id = 'extractionResultsModal';
        modal.innerHTML = `
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">
                  <i class="fas fa-${type === 'PDF' ? 'file-pdf' : 'camera'}"></i> 
                  ${type} Extraction Results
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="alert alert-success">
                  <i class="fas fa-check-circle"></i> Successfully extracted ${extractedContacts.length} contact${extractedContacts.length !== 1 ? 's' : ''}
                </div>
                
                <h6>Extracted Contacts:</h6>
                <div class="list-group">
                  ${extractedContacts.map(contact => `
                    <div class="list-group-item">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${contact.name}</h6>
                        ${contact.confidence ? `<small class="text-success">Confidence: ${Math.round(contact.confidence * 100)}%</small>` : ''}
                      </div>
                      <p class="mb-1"><strong>Email:</strong> ${contact.email}</p>
                      <p class="mb-1"><strong>Company:</strong> ${contact.company}</p>
                      ${contact.phone ? `<p class="mb-1"><strong>Phone:</strong> ${contact.phone}</p>` : ''}
                      ${contact.title ? `<p class="mb-1"><strong>Title:</strong> ${contact.title}</p>` : ''}
                      <small class="text-muted">${contact.notes}</small>
                    </div>
                  `).join('')}
                </div>
                
                <div class="mt-3">
                  <h6>AI Analysis:</h6>
                  <div class="card">
                    <div class="card-body">
                      <p class="mb-2"><strong>Quality Score:</strong> 
                        <span class="badge bg-success">${this.calculateQualityScore(extractedContacts)}%</span>
                      </p>
                      <p class="mb-2"><strong>Potential Opportunities:</strong></p>
                      <ul class="mb-0">
                        ${this.generateOpportunityInsights(extractedContacts).map(insight => `<li>${insight}</li>`).join('')}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" onclick="ContactManager.generateFollowUpEmails()">
                  <i class="fas fa-envelope"></i> Generate Follow-up Emails
                </button>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
        
        // Clean up modal after hiding
        modal.addEventListener('hidden.bs.modal', () => {
          modal.remove();
        });
      },

      calculateQualityScore(contacts) {
        const totalFields = contacts.length * 5; // name, email, company, phone, title
        const filledFields = contacts.reduce((sum, contact) => {
          return sum + 
            (contact.name ? 1 : 0) +
            (contact.email ? 1 : 0) +
            (contact.company ? 1 : 0) +
            (contact.phone ? 1 : 0) +
            (contact.title ? 1 : 0);
        }, 0);
        
        return Math.round((filledFields / totalFields) * 100);
      },

      generateOpportunityInsights(contacts) {
        const insights = [];
        const companies = contacts.map(c => c.company).filter(Boolean);
        const focuses = contacts.map(c => c.focus || c.title).filter(Boolean);
        
        if (companies.length > 0) {
          insights.push(`${companies.length} new company relationship${companies.length !== 1 ? 's' : ''} identified`);
        }
        
        if (focuses.some(f => f.toLowerCase().includes('tech') || f.toLowerCase().includes('digital'))) {
          insights.push('Technology-focused contacts detected - high conversion potential');
        }
        
        if (contacts.some(c => c.title && (c.title.includes('VP') || c.title.includes('Director') || c.title.includes('Manager')))) {
          insights.push('Decision-maker level contacts identified');
        }
        
        insights.push('All contacts automatically categorized and ready for outreach');
        
        return insights;
      },

      async generateFollowUpEmails() {
        Utils.showNotification('Generating personalized follow-up emails...', 'info');
        
        // This would integrate with the email generation system
        setTimeout(() => {
          Utils.showNotification('Follow-up email templates generated and ready to send!', 'success');
          const modal = bootstrap.Modal.getInstance(document.getElementById('extractionResultsModal'));
          modal.hide();
        }, 2000);
      },

      // Enhanced contact creation with AI suggestions
      async saveContact() {
        const name = document.getElementById('contact-name').value.trim();
        const email = document.getElementById('contact-email').value.trim();
        const company = document.getElementById('contact-company').value.trim();
        const phone = document.getElementById('contact-phone').value.trim();
        const focus = document.getElementById('contact-focus').value;
        const industry = document.getElementById('contact-industry').value;
        const notes = document.getElementById('contact-notes').value.trim();

        if (!name || !email) {
          Utils.showNotification('Name and email are required', 'warning');
          return;
        }

        // AI enhancement - suggest focus area and industry if not provided
        let enhancedFocus = focus;
        let enhancedIndustry = industry;
        let enhancedNotes = notes;

        if (!focus || !industry) {
          try {
            const aiSuggestion = await this.getAISuggestions(name, email, company, notes);
            enhancedFocus = focus || aiSuggestion.focus;
            enhancedIndustry = industry || aiSuggestion.industry;
            enhancedNotes = notes + (aiSuggestion.additionalNotes ? `\nAI Insights: ${aiSuggestion.additionalNotes}` : '');
          } catch (error) {
            console.log('AI suggestions unavailable, proceeding with manual input');
          }
        }

        const newContact = [name, email, company, enhancedFocus, enhancedNotes];
        AppState.contacts.push(newContact);
        
        this.renderContactsTable();
        this.updateStats();
        
        // Close modal and reset form
        const modal = bootstrap.Modal.getInstance(document.getElementById('createContactModal'));
        modal.hide();
        document.getElementById('createContactForm').reset();
        
        Utils.showNotification(`Contact ${name} added successfully!`, 'success');
      },

      async getAISuggestions(name, email, company, notes) {
        const prompt = `Analyze this business contact and suggest appropriate focus area and industry:
        Name: ${name}
        Email: ${email}
        Company: ${company}
        Notes: ${notes}
        
        Provide suggestions for focus area (AI/ML, Cloud Computing, Cybersecurity, etc.) and industry classification.`;

        try {
          const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.CHAT, {
            method: 'POST',
            body: JSON.stringify({ prompt })
          });

          // Parse AI response for suggestions
          return {
            focus: 'AI/ML', // Default fallback
            industry: 'Technology',
            additionalNotes: response.response || ''
          };
        } catch (error) {
          return {
            focus: '',
            industry: '',
            additionalNotes: ''
          };
        }
      }
    };

    // Chat Manager
    const ChatManager = {
      addMessage(content, sender = 'user') {
        const messagesContainer = document.getElementById('chat-messages');
        const message = document.createElement('div');
        message.className = `message ${sender}`;
        
        message.innerHTML = `
          <div class="message-avatar">${sender === 'user' ? 'You' : 'AI'}</div>
          <div class="message-content">${content}</div>
        `;
        
        messagesContainer.appendChild(message);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      },

      async sendMessage(message) {
        if (!message.trim()) return;
        
        this.addMessage(message, 'user');
        document.getElementById('chat-input').value = '';
        
        try {
          const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.CHAT, {
            method: 'POST',
            body: JSON.stringify({ prompt: message })
          });
          
          const aiResponse = response.answer || response.response || response.result || 'I understand, but I need more information to help you better.';
          this.addMessage(aiResponse, 'ai');
        } catch (error) {
          this.addMessage('Sorry, I encountered an error. Please try again.', 'ai');
          Utils.showNotification(`Chat error: ${error.message}`, 'error');
        }
      }
    };

    // View Manager
    const ViewManager = {
      switchView(viewName) {
        // Hide all views
        document.querySelectorAll('.view-content').forEach(view => {
          view.style.display = 'none';
        });
        
        // Show selected view
        const targetView = document.getElementById(`${viewName}-view`);
        if (targetView) {
          targetView.style.display = 'block';
        }
        
        // Update navigation
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
          link.classList.remove('active');
        });
        
        const activeLink = document.querySelector(`[data-view="${viewName}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
        }
        
        AppState.currentView = viewName;
        
        // Load view-specific data
        switch (viewName) {
          case 'contacts':
            ContactManager.renderContactsTable();
            break;
          case 'dashboard':
            ContactManager.renderContactsTable('dashboard-contacts-tbody', 5);
            break;
          case 'agents':
            AgentManager.loadAgents();
            break;
          case 'analytics':
            AnalyticsManager.loadAnalytics();
            break;
          case 'templates':
            TemplateManager.loadAllTemplateGrids();
            break;
        }
      }
    };

    // Agent Manager Class
    class AgentManager {
      static async loadAgents() {
        try {
          const response = await fetch(`${API_CONFIG.BASE_URL}/api/agents/list`, {
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
          });
          
          if (response.ok) {
            const agents = await response.json();
            this.displayAgents(agents);
          } else {
            console.error('Failed to load agents');
            // Show mock data for demo
            this.displayAgents([
              { id: 1, name: "CRM Assistant", type: "contact_management", status: "active", description: "Manages contact data and relationships" },
              { id: 2, name: "Analytics Agent", type: "analytics", status: "active", description: "Provides insights and data analysis" },
              { id: 3, name: "Email Agent", type: "communication", status: "active", description: "Handles email templates and outreach" },
              { id: 4, name: "Research Agent", type: "research", status: "training", description: "Conducts market research and lead qualification" },
              { id: 5, name: "RFP Reader/Extractor", type: "document_processing", status: "active", description: "Extracts requirements from RFP documents and analyzes scope" },
              { id: 6, name: "Company Capabilities Agent", type: "capabilities_analysis", status: "active", description: "Analyzes company strengths and matches to RFP requirements" },
              { id: 7, name: "Response Generator", type: "proposal_generation", status: "active", description: "AI-powered proposal generation with editing capabilities" },
              { id: 8, name: "Document Export Agent", type: "document_export", status: "active", description: "Generates PDF and Word documents from proposals" },
              { id: 9, name: "Contact Ingestion Engine", type: "contact_ingestion", status: "active", description: "AI-powered PDF and OCR extraction for contact mining from documents and business cards" }
            ]);
          }
        } catch (error) {
          console.error('Error loading agents:', error);
        }
      }

      static displayAgents(agents) {
        const agentsGrid = document.getElementById('agents-grid');
        const agentList = document.getElementById('agent-list');
        
        if (agentsGrid) {
          agentsGrid.innerHTML = agents.map(agent => `
            <div class="col-md-6 col-lg-4 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title">${agent.name}</h6>
                    <span class="badge ${agent.status === 'active' ? 'bg-success' : 'bg-warning'}">${agent.status}</span>
                  </div>
                  <p class="card-text text-muted small">${agent.description}</p>
                  <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-sm btn-primary" onclick="AgentManager.chatWithAgent(${agent.id})">
                      <i class="fas fa-comments"></i> Chat
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="AgentManager.configureAgent(${agent.id})">
                      <i class="fas fa-cog"></i> Config
                    </button>
                    ${agent.type === 'document_processing' ? 
                      `<button class="btn btn-sm btn-success" onclick="AgentManager.uploadDocument(${agent.id})">
                        <i class="fas fa-file-upload"></i> Upload
                      </button>` : ''}
                    ${agent.type === 'proposal_generation' ? 
                      `<button class="btn btn-sm btn-warning" onclick="AgentManager.generateProposal(${agent.id})">
                        <i class="fas fa-magic"></i> Generate
                      </button>` : ''}
                    ${agent.type === 'document_export' ? 
                      `<button class="btn btn-sm btn-info" onclick="AgentManager.exportDocument(${agent.id})">
                        <i class="fas fa-download"></i> Export
                      </button>` : ''}
                    ${agent.type === 'contact_ingestion' ? 
                      `<button class="btn btn-sm btn-success" onclick="AgentManager.extractContacts(${agent.id})">
                        <i class="fas fa-user-plus"></i> Extract
                      </button>` : ''}
                  </div>
                </div>
              </div>
            </div>
          `).join('');
        }

        if (agentList) {
          agentList.innerHTML = agents.map(agent => `
            <a href="#" class="list-group-item list-group-item-action" onclick="AgentManager.selectAgent(${agent.id})">
              <div class="d-flex w-100 justify-content-between">
                <h6 class="mb-1">${agent.name}</h6>
                <span class="badge ${agent.status === 'active' ? 'bg-success' : 'bg-warning'}">${agent.status}</span>
              </div>
              <p class="mb-1 small text-muted">${agent.description}</p>
            </a>
          `).join('');
        }
      }

      static async chatWithAgent(agentId) {
        // Open chat modal
        const modal = new bootstrap.Modal(document.getElementById('aiAgentModal'));
        modal.show();
        this.selectAgent(agentId);
      }

      static selectAgent(agentId) {
        // Update selected agent in UI
        document.querySelectorAll('#agent-list .list-group-item').forEach(item => {
          item.classList.remove('active');
        });
        event.target.closest('.list-group-item').classList.add('active');
        
        // Add agent-specific welcome message
        const messagesContainer = document.getElementById('agent-chat-messages');
        const agentName = event.target.closest('.list-group-item').querySelector('h6').textContent;
        messagesContainer.innerHTML = `
          <div class="message ai mb-3">
            <div class="message-content">
              <strong>${agentName}:</strong> Hello! I'm ${agentName}. How can I assist you today?
            </div>
          </div>
        `;
      }

      static async sendMessage() {
        const input = document.getElementById('agent-chat-input');
        const message = input.value.trim();
        if (!message) return;

        // Add user message to chat
        const messagesContainer = document.getElementById('agent-chat-messages');
        messagesContainer.innerHTML += `
          <div class="message user mb-3 text-end">
            <div class="message-content">
              <strong>You:</strong> ${message}
            </div>
          </div>
        `;

        input.value = '';
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        try {
          const response = await fetch(`${API_CONFIG.BASE_URL}/predict`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify({ message: message })
          });

          if (response.ok) {
            const data = await response.json();
            messagesContainer.innerHTML += `
              <div class="message ai mb-3">
                <div class="message-content">
                  <strong>AI Agent:</strong> ${data.response || 'I understand your request. Let me help you with that.'}
                </div>
              </div>
            `;
          } else {
            messagesContainer.innerHTML += `
              <div class="message ai mb-3">
                <div class="message-content">
                  <strong>AI Agent:</strong> I'm processing your request. Our AI capabilities include contact analysis, lead qualification, and business insights. How can I specifically help you today?
                </div>
              </div>
            `;
          }
        } catch (error) {
          messagesContainer.innerHTML += `
            <div class="message ai mb-3">
              <div class="message-content">
                <strong>AI Agent:</strong> I'm here to help! I can assist with contact management, data analysis, and strategic insights. What would you like to explore?
              </div>
            </div>
          `;
        }

        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      static configureAgent(agentId) {
        Utils.showNotification('Agent configuration coming soon!', 'info');
      }

      // RFP Document Upload
      static uploadDocument(agentId) {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.pdf,.doc,.docx,.txt';
        input.onchange = (e) => this.handleFileUpload(e.target.files[0], agentId);
        input.click();
      }

      static async handleFileUpload(file, agentId) {
        if (!file) return;

        Utils.showNotification(`Processing ${file.name}...`, 'info');
        
        try {
          const formData = new FormData();
          formData.append('file', file);
          formData.append('agent_id', agentId);

          const response = await fetch(`${API_CONFIG.BASE_URL}/api/agents/upload-rfp`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: formData
          });

          if (response.ok) {
            const result = await response.json();
            Utils.showNotification('RFP document processed successfully!', 'success');
            
            // Store extracted data for later use
            localStorage.setItem('rfp_extracted_data', JSON.stringify(result));
            
            // Show extraction results in chat
            this.showExtractionResults(result);
          } else {
            throw new Error('Failed to process document');
          }
        } catch (error) {
          // Mock successful extraction for demo
          const mockExtraction = {
            title: file.name.replace(/\.[^/.]+$/, ""),
            requirements: [
              "Cloud infrastructure migration",
              "Data analytics platform",
              "Security compliance (SOC 2, GDPR)",
              "24/7 monitoring and support",
              "Integration with existing systems"
            ],
            timeline: "6 months",
            budget_range: "$100k - $500k",
            key_technologies: ["AWS", "Azure", "Python", "React", "PostgreSQL"],
            evaluation_criteria: [
              "Technical expertise (30%)",
              "Cost effectiveness (25%)",
              "Timeline feasibility (20%)",
              "Past experience (15%)",
              "Support quality (10%)"
            ]
          };
          
          localStorage.setItem('rfp_extracted_data', JSON.stringify(mockExtraction));
          this.showExtractionResults(mockExtraction);
          Utils.showNotification('RFP document processed (demo mode)', 'success');
        }
      }

      static showExtractionResults(data) {
        const modal = new bootstrap.Modal(document.getElementById('aiAgentModal'));
        modal.show();
        
        const messagesContainer = document.getElementById('agent-chat-messages');
        messagesContainer.innerHTML = `
          <div class="message ai mb-3">
            <div class="message-content">
              <strong>RFP Extractor:</strong> I've successfully analyzed the RFP document. Here's what I found:
              
              <div class="mt-3">
                <h6>🎯 Project Title:</h6>
                <p>${data.title}</p>
                
                <h6>📋 Key Requirements:</h6>
                <ul>
                  ${data.requirements.map(req => `<li>${req}</li>`).join('')}
                </ul>
                
                <h6>⏰ Timeline:</h6>
                <p>${data.timeline}</p>
                
                <h6>💰 Budget Range:</h6>
                <p>${data.budget_range}</p>
                
                <h6>🔧 Key Technologies:</h6>
                <p>${data.key_technologies.join(', ')}</p>
                
                <h6>📊 Evaluation Criteria:</h6>
                <ul>
                  ${data.evaluation_criteria.map(criteria => `<li>${criteria}</li>`).join('')}
                </ul>
              </div>
              
              <div class="mt-3">
                <button class="btn btn-primary btn-sm" onclick="AgentManager.analyzeCapabilities()">
                  <i class="fas fa-chart-line"></i> Analyze Our Capabilities
                </button>
                <button class="btn btn-success btn-sm" onclick="AgentManager.generateProposal()">
                  <i class="fas fa-magic"></i> Generate Response
                </button>
              </div>
            </div>
          </div>
        `;
      }

      // Company Capabilities Analysis
      static async analyzeCapabilities() {
        Utils.showNotification('Analyzing company capabilities against RFP...', 'info');
        
        try {
          const rfpData = JSON.parse(localStorage.getItem('rfp_extracted_data') || '{}');
          
          const analysisRequest = {
            rfp_requirements: rfpData.requirements,
            company_capabilities: [
              "Cloud migration expertise (AWS, Azure, GCP)",
              "Full-stack development (React, Node.js, Python)",
              "Data analytics and ML/AI solutions",
              "Cybersecurity and compliance (SOC 2, GDPR, HIPAA)",
              "24/7 DevOps and monitoring",
              "Enterprise integration experience",
              "Agile project management",
              "10+ years industry experience"
            ]
          };

          const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.AGENTS.WORKFLOWS.ANALYSIS, {
            method: 'POST',
            body: JSON.stringify(analysisRequest)
          });

          this.showCapabilityAnalysis(response);
        } catch (error) {
          // Mock analysis for demo
          const mockAnalysis = {
            match_score: 92,
            strengths: [
              "Strong cloud infrastructure expertise matches migration requirements",
              "Comprehensive security compliance experience",
              "Proven track record in similar projects",
              "Full-stack development capabilities align with technical needs"
            ],
            gaps: [
              "May need additional PostgreSQL expertise",
              "Timeline is aggressive but achievable with proper resource allocation"
            ],
            recommendations: [
              "Emphasize our AWS/Azure certifications and migration experience",
              "Highlight recent similar projects in the proposal",
              "Propose phased delivery approach for timeline management",
              "Include dedicated PostgreSQL specialist in team"
            ],
            win_probability: "High (85%)"
          };
          
          this.showCapabilityAnalysis(mockAnalysis);
          Utils.showNotification('Capability analysis completed', 'success');
        }
      }

      static showCapabilityAnalysis(analysis) {
        const messagesContainer = document.getElementById('agent-chat-messages');
        messagesContainer.innerHTML += `
          <div class="message ai mb-3">
            <div class="message-content">
              <strong>Capabilities Agent:</strong> Analysis complete! Here's our competitive position:
              
              <div class="mt-3">
                <div class="alert alert-success">
                  <h6>📈 Match Score: ${analysis.match_score}%</h6>
                  <h6>🎯 Win Probability: ${analysis.win_probability}</h6>
                </div>
                
                <h6>💪 Our Strengths:</h6>
                <ul>
                  ${analysis.strengths.map(strength => `<li class="text-success">${strength}</li>`).join('')}
                </ul>
                
                <h6>⚠️ Potential Gaps:</h6>
                <ul>
                  ${analysis.gaps.map(gap => `<li class="text-warning">${gap}</li>`).join('')}
                </ul>
                
                <h6>💡 Strategic Recommendations:</h6>
                <ul>
                  ${analysis.recommendations.map(rec => `<li class="text-info">${rec}</li>`).join('')}
                </ul>
              </div>
              
              <div class="mt-3">
                <button class="btn btn-success btn-sm" onclick="AgentManager.generateProposal()">
                  <i class="fas fa-magic"></i> Generate Winning Proposal
                </button>
              </div>
            </div>
          </div>
        `;
        
        const container = document.getElementById('agent-chat-messages');
        container.scrollTop = container.scrollHeight;
      }

      // AI-Powered Proposal Generation
      static async generateProposal(agentId) {
        Utils.showNotification('Generating AI-powered proposal...', 'info');
        
        try {
          const rfpData = JSON.parse(localStorage.getItem('rfp_extracted_data') || '{}');
          
          const proposalRequest = {
            rfp_data: rfpData,
            company_info: {
              name: "Anthesis Technologies",
              expertise: ["Cloud Migration", "AI/ML", "Full-Stack Development", "DevOps", "Cybersecurity"],
              experience_years: 10,
              team_size: 25
            },
            proposal_sections: ["executive_summary", "technical_approach", "timeline", "team", "pricing"]
          };

          const response = await Utils.apiCall(API_CONFIG.ENDPOINTS.AGENTS.WORKFLOWS.RFP, {
            method: 'POST',
            body: JSON.stringify(proposalRequest)
          });

          this.showGeneratedProposal(response);
        } catch (error) {
          // Mock proposal generation for demo
          const mockProposal = {
            title: `Proposal for ${rfpData.title || 'Cloud Migration Project'}`,
            sections: {
              executive_summary: `We are pleased to submit our proposal for your cloud migration and data analytics initiative. Anthesis Technologies brings 10+ years of expertise in enterprise cloud transformations, having successfully migrated 50+ organizations to modern cloud infrastructure while maintaining 99.9% uptime.`,
              
              technical_approach: `Our proven 4-phase methodology ensures seamless migration:
              
Phase 1: Discovery & Assessment (2 weeks)
- Current infrastructure audit
- Security compliance review
- Risk assessment and mitigation planning

Phase 2: Architecture Design (3 weeks)  
- Cloud-native architecture design
- Data migration strategy
- Security framework implementation

Phase 3: Migration Execution (16 weeks)
- Phased workload migration
- Real-time monitoring setup
- Security controls implementation

Phase 4: Optimization & Handover (4 weeks)
- Performance optimization
- Team training and documentation
- 24/7 support transition`,

              timeline: `Total Duration: 6 months
- Month 1: Discovery and Planning
- Months 2-5: Migration Execution
- Month 6: Optimization and Handover
- Ongoing: 24/7 Support and Monitoring`,

              team: `Project Team:
- Technical Lead: Cloud Solutions Architect (AWS/Azure Certified)
- DevOps Engineer: Infrastructure Automation Specialist
- Security Specialist: Compliance and Security Expert
- Data Engineer: Migration and Analytics Specialist
- Project Manager: Agile-certified PM with cloud experience`,

              pricing: `Investment: $285,000
- Discovery & Planning: $35,000
- Migration Execution: $180,000  
- Support & Training: $40,000
- 24/7 Monitoring (Year 1): $30,000

Payment Terms: 30% upfront, 50% at milestones, 20% completion`
            }
          };
          
          localStorage.setItem('generated_proposal', JSON.stringify(mockProposal));
          this.showGeneratedProposal(mockProposal);
          Utils.showNotification('AI proposal generated successfully!', 'success');
        }
      }

      static showGeneratedProposal(proposal) {
        const messagesContainer = document.getElementById('agent-chat-messages');
        messagesContainer.innerHTML += `
          <div class="message ai mb-3">
            <div class="message-content">
              <strong>Response Generator:</strong> I've created a comprehensive proposal tailored to the RFP requirements:
              
              <div class="mt-3">
                <div class="card">
                  <div class="card-header">
                    <h5>${proposal.title}</h5>
                  </div>
                  <div class="card-body">
                    <div class="accordion" id="proposalAccordion">
                      ${Object.entries(proposal.sections).map(([section, content], index) => `
                        <div class="accordion-item">
                          <h2 class="accordion-header">
                            <button class="accordion-button ${index === 0 ? '' : 'collapsed'}" type="button" data-bs-toggle="collapse" data-bs-target="#section${index}">
                              ${section.replace('_', ' ').toUpperCase()}
                            </button>
                          </h2>
                          <div id="section${index}" class="accordion-collapse collapse ${index === 0 ? 'show' : ''}" data-bs-parent="#proposalAccordion">
                            <div class="accordion-body">
                              <pre style="white-space: pre-wrap; font-family: inherit;">${content}</pre>
                            </div>
                          </div>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mt-3">
                <button class="btn btn-warning btn-sm" onclick="AgentManager.editProposal()">
                  <i class="fas fa-edit"></i> Edit Proposal
                </button>
                <button class="btn btn-info btn-sm" onclick="AgentManager.exportDocument()">
                  <i class="fas fa-download"></i> Export as PDF/Word
                </button>
                <button class="btn btn-success btn-sm" onclick="AgentManager.finalizeProposal()">
                  <i class="fas fa-check"></i> Finalize & Send
                </button>
              </div>
            </div>
          </div>
        `;
        
        const container = document.getElementById('agent-chat-messages');
        container.scrollTop = container.scrollHeight;
      }

      // Proposal Editing
      static editProposal() {
        const proposal = JSON.parse(localStorage.getItem('generated_proposal') || '{}');
        
        // Create editing modal
        const editModal = document.createElement('div');
        editModal.className = 'modal fade';
        editModal.id = 'editProposalModal';
        editModal.innerHTML = `
          <div class="modal-dialog modal-xl">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Edit Proposal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label class="form-label">Proposal Title</label>
                  <input type="text" class="form-control" id="edit-title" value="${proposal.title}">
                </div>
                ${Object.entries(proposal.sections).map(([section, content]) => `
                  <div class="mb-3">
                    <label class="form-label">${section.replace('_', ' ').toUpperCase()}</label>
                    <textarea class="form-control" id="edit-${section}" rows="8">${content}</textarea>
                  </div>
                `).join('')}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="AgentManager.saveProposalEdits()">Save Changes</button>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(editModal);
        const modal = new bootstrap.Modal(editModal);
        modal.show();
      }

      static saveProposalEdits() {
        const proposal = JSON.parse(localStorage.getItem('generated_proposal') || '{}');
        
        proposal.title = document.getElementById('edit-title').value;
        Object.keys(proposal.sections).forEach(section => {
          proposal.sections[section] = document.getElementById(`edit-${section}`).value;
        });
        
        localStorage.setItem('generated_proposal', JSON.stringify(proposal));
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('editProposalModal'));
        modal.hide();
        
        Utils.showNotification('Proposal updated successfully!', 'success');
      }

      // Document Export
      static async exportDocument(agentId) {
        const proposal = JSON.parse(localStorage.getItem('generated_proposal') || '{}');
        
        if (!proposal.title) {
          Utils.showNotification('No proposal to export. Generate one first.', 'warning');
          return;
        }

        const exportOptions = document.createElement('div');
        exportOptions.innerHTML = `
          <div class="btn-group">
            <button class="btn btn-primary" onclick="AgentManager.exportAsPDF()">
              <i class="fas fa-file-pdf"></i> Export as PDF
            </button>
            <button class="btn btn-success" onclick="AgentManager.exportAsWord()">
              <i class="fas fa-file-word"></i> Export as Word
            </button>
          </div>
        `;
        
        Utils.showNotification('Choose export format:', 'info');
      }

      static async exportAsPDF() {
        Utils.showNotification('Generating PDF...', 'info');
        
        try {
          const proposal = JSON.parse(localStorage.getItem('generated_proposal') || '{}');
          
          // Mock PDF generation - in real implementation, this would call the backend
          const pdfContent = this.generatePDFContent(proposal);
          const blob = new Blob([pdfContent], { type: 'application/pdf' });
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = `${proposal.title.replace(/[^a-z0-9]/gi, '_')}.pdf`;
          a.click();
          
          Utils.showNotification('PDF downloaded successfully!', 'success');
        } catch (error) {
          Utils.showNotification('PDF export failed', 'error');
        }
      }

      static async exportAsWord() {
        Utils.showNotification('Generating Word document...', 'info');
        
        try {
          const proposal = JSON.parse(localStorage.getItem('generated_proposal') || '{}');
          
          // Mock Word generation - in real implementation, this would call the backend
          const wordContent = this.generateWordContent(proposal);
          const blob = new Blob([wordContent], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = `${proposal.title.replace(/[^a-z0-9]/gi, '_')}.docx`;
          a.click();
          
          Utils.showNotification('Word document downloaded successfully!', 'success');
        } catch (error) {
          Utils.showNotification('Word export failed', 'error');
        }
      }

      static generatePDFContent(proposal) {
        // This is a mock - real implementation would use a PDF library
        return `PDF Content for: ${proposal.title}\n\n${Object.entries(proposal.sections).map(([section, content]) => `${section.toUpperCase()}\n${content}\n\n`).join('')}`;
      }

      static generateWordContent(proposal) {
        // This is a mock - real implementation would use a Word library
        return `Word Document for: ${proposal.title}\n\n${Object.entries(proposal.sections).map(([section, content]) => `${section.toUpperCase()}\n${content}\n\n`).join('')}`;
      }

      static finalizeProposal() {
        Utils.showNotification('Proposal finalized and ready to send!', 'success');
      }

      // Enhanced RFP workflow methods
      static async uploadRFP() {
        const modal = new bootstrap.Modal(document.getElementById('rfpUploadModal'));
        modal.show();
      }

      static async processRFPUpload() {
        const fileInput = document.getElementById('rfp-file-input');
        const file = fileInput.files[0];
        
        if (!file) {
          Utils.showNotification('Please select a file first', 'warning');
          return;
        }

        const extractRequirements = document.getElementById('extract-requirements').checked;
        const analyzeScope = document.getElementById('analyze-scope').checked;
        const matchCapabilities = document.getElementById('match-capabilities').checked;
        const generateOutline = document.getElementById('generate-outline').checked;

        const modal = bootstrap.Modal.getInstance(document.getElementById('rfpUploadModal'));
        modal.hide();

        await this.handleFileUpload(file, 5, {
          extractRequirements,
          analyzeScope,
          matchCapabilities,
          generateOutline
        });
      }

      static async generateResponse() {
        const rfpData = localStorage.getItem('rfp_extracted_data');
        if (!rfpData) {
          Utils.showNotification('Please upload an RFP document first', 'warning');
          return;
        }
        this.generateProposal(7); // Response Generator agent ID
      }

      // Contact Extraction Handler
      static async extractContacts(agentId) {
        // Create extraction options modal
        const extractModal = document.createElement('div');
        extractModal.className = 'modal fade';
        extractModal.id = 'contactExtractionModal';
        extractModal.innerHTML = `
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">
                  <i class="fas fa-user-plus"></i> Contact Ingestion Engine
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <p>Choose your contact extraction method:</p>
                <div class="d-grid gap-2">
                  <button class="btn btn-outline-danger" onclick="AgentManager.triggerPDFExtraction()">
                    <i class="fas fa-file-pdf"></i> Extract from PDF Documents
                    <small class="d-block text-muted">Business directories, contact lists, reports</small>
                  </button>
                  <button class="btn btn-outline-success" onclick="AgentManager.triggerBusinessCardOCR()">
                    <i class="fas fa-camera"></i> Scan Business Cards (OCR)
                    <small class="d-block text-muted">Phone photos, scanned images</small>
                  </button>
                  <button class="btn btn-outline-primary" onclick="AgentManager.triggerBulkProcessing()">
                    <i class="fas fa-layer-group"></i> Bulk Processing
                    <small class="d-block text-muted">Multiple files at once</small>
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(extractModal);
        const modal = new bootstrap.Modal(extractModal);
        modal.show();
        
        // Clean up after modal is hidden
        extractModal.addEventListener('hidden.bs.modal', () => {
          extractModal.remove();
        });
      }

      static triggerPDFExtraction() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('contactExtractionModal'));
        modal.hide();
        document.getElementById('pdfUpload').click();
      }

      static triggerBusinessCardOCR() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('contactExtractionModal'));
        modal.hide();
        document.getElementById('imageUpload').click();
      }

      static triggerBulkProcessing() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('contactExtractionModal'));
        modal.hide();
        Utils.showNotification('Bulk processing feature coming soon!', 'info');
      }
      
      // Main agent interaction method
      static async useAgent(agentType, data) {
        try {
          // Show loading state
          console.log(`Using agent: ${agentType}`, data);
          
          // Map agent types to specific functionality
          switch(agentType) {
            case 'rfp_reader':
              return await this.handleRFPExtraction(data);
            case 'capabilities_matcher':
              return await this.handleCapabilitiesMatching(data);
            case 'response_generator':
              return await this.handleResponseGeneration(data);
            case 'document_generator':
              return await this.handleDocumentGeneration(data);
            case 'contact_extractor':
              return await this.handleContactExtraction(data);
            default:
              return await this.handleGenericAgent(agentType, data);
          }
        } catch (error) {
          console.error(`Error using agent ${agentType}:`, error);
          return {
            success: false,
            message: error.message,
            data: null
          };
        }
      }
      
      static async handleRFPExtraction(data) {
        // Simulate RFP content extraction
        const mockResponse = {
          title: data.file ? data.file.name.replace(/\.[^/.]+$/, "") : "RFP Document",
          client: "Sample Corporation",
          deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
          value: Math.floor(Math.random() * 500000) + 50000,
          content: `This is an extracted RFP document for ${data.file ? data.file.name : 'the uploaded file'}. 
                   The document contains detailed requirements for software development, 
                   cloud infrastructure, and consulting services.`,
          requirements: [
            "Cloud infrastructure setup and migration",
            "Custom software development",
            "Data analytics and reporting",
            "Security compliance (SOC 2, GDPR)",
            "24/7 support and maintenance"
          ]
        };
        
        return {
          success: true,
          message: "RFP extracted successfully",
          data: mockResponse
        };
      }
      
      static async handleCapabilitiesMatching(data) {
        // Simulate capabilities matching
        const mockCapabilities = {
          matchScore: Math.floor(Math.random() * 30) + 70, // 70-100%
          strengths: [
            "Extensive cloud infrastructure experience",
            "Proven track record in similar projects",
            "Certified security compliance expertise",
            "24/7 support team availability"
          ],
          gaps: [
            "Limited experience in specific industry vertical",
            "May need additional resources for timeline"
          ],
          recommendations: [
            "Highlight previous cloud migration successes",
            "Emphasize security certifications",
            "Propose phased implementation approach"
          ]
        };
        
        return {
          success: true,
          message: "Capabilities analysis complete",
          data: mockCapabilities
        };
      }
      
      static async handleResponseGeneration(data) {
        // Simulate proposal generation
        const mockProposal = {
          executive_summary: `We are pleased to submit our proposal for ${data.rfp.title}. Our team brings extensive experience in cloud infrastructure and custom software development, making us the ideal partner for this project.`,
          technical_approach: `Our technical approach includes:
            1. Assessment and planning phase
            2. Infrastructure setup and migration
            3. Custom development and integration
            4. Testing and quality assurance
            5. Deployment and go-live support`,
          timeline: `Phase 1: Planning and Setup (2 weeks)
            Phase 2: Development (8 weeks)
            Phase 3: Testing and Integration (2 weeks)
            Phase 4: Deployment and Launch (1 week)
            Total Duration: 13 weeks`,
          budget: `Total Project Cost: $${(data.rfp.value || 250000).toLocaleString()}
            - Planning and Design: 15%
            - Development: 60%
            - Testing and QA: 15%
            - Project Management: 10%`,
          team: `Project Manager: John Smith (PMP Certified)
            Lead Developer: Sarah Johnson (10+ years experience)
            Cloud Architect: Mike Chen (AWS/Azure Expert)
            QA Lead: Emily Davis (Automation Specialist)`
        };
        
        return {
          success: true,
          message: "Proposal generated successfully",
          data: mockProposal
        };
      }
      
      static async handleDocumentGeneration(data) {
        // Simulate document generation (SOW, contracts, etc.)
        const mockDocument = {
          content: `STATEMENT OF WORK
            
            Project: ${data.data.title || 'Software Development Project'}
            Client: ${data.data.client || 'Client Name'}
            
            Scope of Work:
            ${data.data.scope || 'Project scope and deliverables will be defined here.'}
            
            Requirements:
            ${data.data.requirements || 'Key requirements and specifications.'}
            
            Timeline: ${data.data.start_date || 'TBD'} to ${data.data.end_date || 'TBD'}
            Value: $${data.data.value || 'TBD'}`,
          format: data.type || 'sow'
        };
        
        return {
          success: true,
          message: "Document generated successfully",
          data: mockDocument
        };
      }
      
      static async handleContactExtraction(data) {
        // Simulate contact extraction from documents
        const mockContacts = [
          {
            name: "John Smith",
            title: "Project Manager",
            company: "Tech Solutions Inc",
            email: "john.smith@techsolutions.com",
            phone: "(555) 123-4567"
          },
          {
            name: "Sarah Wilson",
            title: "IT Director",
            company: "Innovation Corp",
            email: "swilson@innovationcorp.com",
            phone: "(555) 987-6543"
          }
        ];
        
        return {
          success: true,
          message: "Contacts extracted successfully",
          data: { contacts: mockContacts }
        };
      }
      
      static async handleGenericAgent(agentType, data) {
        // Generic agent handler for other types
        return {
          success: true,
          message: `Agent ${agentType} processed request successfully`,
          data: { result: "Processing complete", input: data }
        };
      }
    }

    // Analytics Manager Class
    class AnalyticsManager {
      static init() {
        this.loadAnalytics();
      }

      static async loadAnalytics() {
        try {
          // Try to load real data, fallback to mock data
          const mockData = {
            totalContacts: 247,
            activeLeads: 89,
            conversionRate: 23.5,
            monthlyGrowth: 12.3,
            engagementData: [65, 59, 80, 81, 56, 55, 40],
            responseRates: [28, 48, 40, 19, 86, 27, 90]
          };
          
          this.displayAnalytics(mockData);
          this.renderCharts(mockData);
        } catch (error) {
          console.error('Error loading analytics:', error);
        }
      }

      static displayAnalytics(data) {
        const metricsContainer = document.getElementById('analytics-metrics');
        if (metricsContainer) {
          metricsContainer.innerHTML = `
            <div class="col-md-3">
              <div class="card text-center">
                <div class="card-body">
                  <h3 class="text-primary">${data.totalContacts}</h3>
                  <p class="text-muted">Total Contacts</p>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card text-center">
                <div class="card-body">
                  <h3 class="text-success">${data.activeLeads}</h3>
                  <p class="text-muted">Active Leads</p>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card text-center">
                <div class="card-body">
                  <h3 class="text-info">${data.conversionRate}%</h3>
                  <p class="text-muted">Conversion Rate</p>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card text-center">
                <div class="card-body">
                  <h3 class="text-warning">+${data.monthlyGrowth}%</h3>
                  <p class="text-muted">Monthly Growth</p>
                </div>
              </div>
            </div>
          `;
        }
      }

      static renderCharts(data) {
        // Engagement Chart
        const engagementCanvas = document.getElementById('engagement-chart');
        if (engagementCanvas) {
          const ctx = engagementCanvas.getContext('2d');
          ctx.clearRect(0, 0, engagementCanvas.width, engagementCanvas.height);
          
          // Simple bar chart for engagement
          const maxValue = Math.max(...data.engagementData);
          const barWidth = engagementCanvas.width / data.engagementData.length;
          
          data.engagementData.forEach((value, index) => {
            const barHeight = (value / maxValue) * (engagementCanvas.height - 40);
            const x = index * barWidth + 10;
            const y = engagementCanvas.height - barHeight - 20;
            
            ctx.fillStyle = '#007bff';
            ctx.fillRect(x, y, barWidth - 20, barHeight);
            
            // Add value labels
            ctx.fillStyle = '#333';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(value, x + (barWidth - 20) / 2, y - 5);
          });
        }

        // Response Rate Chart
        const responseCanvas = document.getElementById('response-chart');
        if (responseCanvas) {
          const ctx = responseCanvas.getContext('2d');
          ctx.clearRect(0, 0, responseCanvas.width, responseCanvas.height);
          
          // Simple line chart for response rates
          const maxValue = Math.max(...data.responseRates);
          const stepX = responseCanvas.width / (data.responseRates.length - 1);
          
          ctx.beginPath();
          ctx.strokeStyle = '#28a745';
          ctx.lineWidth = 3;
          
          data.responseRates.forEach((value, index) => {
            const x = index * stepX;
            const y = responseCanvas.height - ((value / maxValue) * (responseCanvas.height - 40)) - 20;
            
            if (index === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
            
            // Add point markers
            ctx.save();
            ctx.fillStyle = '#28a745';
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, 2 * Math.PI);
            ctx.fill();
            ctx.restore();
          });
          
          ctx.stroke();
        }
      }
    }

        // RFP Manager Class
        class RFPManager {
            static rfps = [];
            static currentRFP = null;
            
            static async loadRFPs() {
                try {
                    // Load RFPs from server or localStorage
                    const savedRFPs = localStorage.getItem('anthesis_rfps');
                    this.rfps = savedRFPs ? JSON.parse(savedRFPs) : [];
                    this.updateRFPTable();
                    this.updateDashboard();
                } catch (error) {
                    console.error('Error loading RFPs:', error);
                }
            }
            
            static saveRFPs() {
                localStorage.setItem('anthesis_rfps', JSON.stringify(this.rfps));
            }
            
            static uploadRFP() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.pdf,.doc,.docx,.txt';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    try {
                        // Show processing indicator
                        const loadingToast = this.showToast('Processing RFP...', 'info');
                        
                        // Check if AgentManager is available
                        if (typeof AgentManager === 'undefined' || !AgentManager.useAgent) {
                            console.error('AgentManager not available, using fallback processing');
                            // Fallback processing without agents
                            const newRFP = {
                                id: 'rfp_' + Date.now(),
                                title: file.name.replace(/\.[^/.]+$/, ""),
                                client: 'Unknown Client',
                                deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                                value: Math.floor(Math.random() * 500000) + 50000,
                                status: 'extracted',
                                content: `RFP document: ${file.name}. Content extraction in progress...`,
                                requirements: ['Requirements being analyzed...'],
                                uploadDate: new Date().toISOString(),
                                progress: 20
                            };
                            
                            this.rfps.push(newRFP);
                            this.saveRFPs();
                            this.updateRFPTable();
                            this.updateDashboard();
                            
                            this.showToast('RFP uploaded successfully! AI processing unavailable.', 'warning');
                            this.viewRFP(newRFP.id);
                            return;
                        }
                        
                        // Use RFP Reader Agent to extract content
                        const response = await AgentManager.useAgent('rfp_reader', {
                            action: 'extract',
                            file: file
                        });
                        
                        if (response.success) {
                            const newRFP = {
                                id: 'rfp_' + Date.now(),
                                title: response.data.title || file.name,
                                client: response.data.client || 'Unknown',
                                deadline: response.data.deadline || null,
                                value: response.data.value || null,
                                status: 'extracted',
                                content: response.data.content,
                                requirements: response.data.requirements,
                                uploadDate: new Date().toISOString(),
                                progress: 20
                            };
                            
                            this.rfps.push(newRFP);
                            this.saveRFPs();
                            this.updateRFPTable();
                            this.updateDashboard();
                            
                            this.showToast('RFP extracted successfully!', 'success');
                            this.viewRFP(newRFP.id);
                        } else {
                            this.showToast('Error extracting RFP: ' + response.message, 'error');
                        }
                    } catch (error) {
                        console.error('Error uploading RFP:', error);
                        this.showToast('Error processing RFP', 'error');
                    }
                };
                input.click();
            }
            
            static async generateResponse(rfpId = null) {
                let rfp = rfpId ? this.rfps.find(r => r.id === rfpId) : this.currentRFP;
                
                if (!rfp) {
                    this.showToast('Please select an RFP first', 'warning');
                    return;
                }
                
                // Show template selection modal first
                this.showTemplateSelectionModal(rfp);
            }
            
            static showTemplateSelectionModal(rfp) {
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Select Response Template & Output Format</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Template Type</h6>
                                        <div class="list-group" id="template-selection">
                                            <button class="list-group-item list-group-item-action active" data-template="rfp_template_1">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h6 class="mb-1">Technical Services Proposal</h6>
                                                    <small>Detailed</small>
                                                </div>
                                                <p class="mb-1">Comprehensive technical proposal with detailed sections</p>
                                            </button>
                                            <button class="list-group-item list-group-item-action" data-template="rfp_template_2">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h6 class="mb-1">Consulting Services Proposal</h6>
                                                    <small>Executive</small>
                                                </div>
                                                <p class="mb-1">Executive-level consulting proposal format</p>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Output Format</h6>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="outputFormat" id="format-markdown" value="markdown" checked>
                                            <label class="form-check-label" for="format-markdown">
                                                <i class="fab fa-markdown"></i> Markdown
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="outputFormat" id="format-html" value="html">
                                            <label class="form-check-label" for="format-html">
                                                <i class="fab fa-html5"></i> HTML
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="outputFormat" id="format-pdf" value="pdf">
                                            <label class="form-check-label" for="format-pdf">
                                                <i class="fas fa-file-pdf"></i> PDF Ready
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="outputFormat" id="format-docx" value="docx">
                                            <label class="form-check-label" for="format-docx">
                                                <i class="fas fa-file-word"></i> Word Ready
                                            </label>
                                        </div>
                                        
                                        <h6 class="mt-3">LLM Settings</h6>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="use-llm" checked>
                                            <label class="form-check-label" for="use-llm">
                                                Use AI/LLM Enhancement
                                            </label>
                                        </div>
                                        <div class="form-check form-switch mt-2">
                                            <input class="form-check-input" type="checkbox" id="include-sow" checked>
                                            <label class="form-check-label" for="include-sow">
                                                Include SOW Section in Response
                                            </label>
                                        </div>
                                        <div class="form-check form-switch mt-2">
                                            <input class="form-check-input" type="checkbox" id="generate-linked-sow">
                                            <label class="form-check-label" for="generate-linked-sow">
                                                Generate Separate Linked SOW Document
                                            </label>
                                        </div>
                                        
                                        <h6 class="mt-3">Modular Components</h6>
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="TemplateManager.showModularComponentSelector()">
                                            <i class="fas fa-puzzle-piece"></i> Add Components
                                        </button>
                                        <div id="selected-components" class="mt-2">
                                            <!-- Selected components will appear here -->
                                        </div>
                                        <div class="mt-2">
                                            <label class="form-label">Creativity Level</label>
                                            <input type="range" class="form-range" id="creativity-level" min="0.1" max="1.0" step="0.1" value="0.7">
                                            <div class="d-flex justify-content-between">
                                                <small>Conservative</small>
                                                <small>Creative</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <h6>Custom Variables (Optional)</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <input type="text" class="form-control mb-2" placeholder="company_name" value="Anthesis Technologies">
                                            <input type="text" class="form-control mb-2" placeholder="years_experience" value="10">
                                            <input type="text" class="form-control mb-2" placeholder="domain" value="Technology Consulting">
                                        </div>
                                        <div class="col-md-6">
                                            <input type="text" class="form-control mb-2" placeholder="methodology_name" value="Agile Development">
                                            <input type="text" class="form-control mb-2" placeholder="technology_stack" value="Cloud-Native">
                                            <input type="text" class="form-control mb-2" placeholder="expected_roi" value="300%">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="RFPManager.generateWithTemplate('${rfp.id}')">
                                    <i class="fas fa-magic"></i> Generate Response
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                // Template selection handler
                modal.querySelectorAll('[data-template]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        modal.querySelectorAll('[data-template]').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            }
            
            static async generateWithTemplate(rfpId) {
                const modal = document.querySelector('.modal');
                const selectedTemplate = modal.querySelector('[data-template].active').dataset.template;
                const outputFormat = modal.querySelector('input[name="outputFormat"]:checked').value;
                const useLLM = modal.querySelector('#use-llm').checked;
                const creativityLevel = parseFloat(modal.querySelector('#creativity-level').value);
                const includeSow = modal.querySelector('#include-sow')?.checked || false;
                const generateLinkedSow = modal.querySelector('#generate-linked-sow')?.checked || false;
                
                // Collect custom variables
                const customVariables = {};
                modal.querySelectorAll('input[placeholder]').forEach(input => {
                    if (input.value.trim()) {
                        customVariables[input.placeholder] = input.value.trim();
                    }
                });
                
                bootstrap.Modal.getInstance(modal).hide();
                
                try {
                    this.showToast('Generating AI-powered response...', 'info');
                    
                    const rfp = this.rfps.find(r => r.id === rfpId);
                    
                    // Get template data
                    const templateData = TemplateManager.getTemplate('rfp_responses', selectedTemplate);
                    if (!templateData) {
                        this.showToast('Template not found', 'error');
                        return;
                    }
                    
                    // Prepare variables for template
                    const variables = {
                        rfp_title: rfp.title,
                        client_name: rfp.client,
                        total_budget: rfp.value ? rfp.value.toLocaleString() : '250,000',
                        project_duration: '12 weeks',
                        start_date: new Date().toLocaleDateString(),
                        end_date: new Date(Date.now() + 84 * 24 * 60 * 60 * 1000).toLocaleDateString(),
                        ...customVariables
                    };
                    
                    let proposalContent;
                    
                    if (useLLM) {
                        // Use LLM for enhanced generation
                        proposalContent = await TemplateManager.generateContentWithLLM(
                            templateData, 
                            variables, 
                            outputFormat
                        );
                    } else {
                        // Use template processing only
                        proposalContent = TemplateManager.processTemplate(
                            templateData, 
                            variables, 
                            outputFormat
                        );
                    }
                    
                    if (proposalContent.success) {
                        const proposal = {
                            id: 'prop_' + Date.now(),
                            rfpId: rfp.id,
                            template_used: selectedTemplate,
                            output_format: outputFormat,
                            content: proposalContent.content,
                            executive_summary: proposalContent.content.executive_summary || 'Generated with template',
                            technical_approach: proposalContent.content.technical_approach || 'Generated with template',
                            timeline: proposalContent.content.timeline || 'Generated with template',
                            budget: proposalContent.content.budget || 'Generated with template',
                            team: proposalContent.content.team || 'Generated with template',
                            variables_used: variables,
                            created: new Date().toISOString(),
                            status: 'draft',
                            generated_with_llm: useLLM
                        };
                        
                        // Update RFP with proposal
                        rfp.proposal = proposal;
                        rfp.status = 'proposal_generated';
                        rfp.progress = 80;
                        
                        // Generate SOW if requested
                        if (includeSow || generateLinkedSow) {
                            await this.generateSOWForRFP(rfp, includeSow, generateLinkedSow, variables, useLLM, outputFormat);
                        }
                        
                        this.saveRFPs();
                        this.updateRFPTable();
                        this.showToast('Response generated successfully!', 'success');
                        this.viewProposal(proposal.id);
                    } else {
                        this.showToast('Error generating response: ' + proposalContent.error, 'error');
                    }
                } catch (error) {
                    console.error('Error generating response:', error);
                    this.showToast('Error generating response', 'error');
                }
            }
            
            static async generateSOWForRFP(rfp, includeSow, generateLinkedSow, rfpVariables, useLLM, outputFormat) {
                try {
                    // Prepare SOW variables based on RFP data
                    const sowVariables = {
                        project_title: rfp.title,
                        client_name: rfp.client,
                        contractor_name: 'Anthesis Technologies',
                        contract_date: new Date().toLocaleDateString(),
                        contract_value: rfp.value ? '$' + parseInt(rfp.value).toLocaleString() : 'TBD',
                        start_date: rfpVariables.start_date || 'TBD',
                        end_date: rfpVariables.end_date || 'TBD',
                        project_objectives: rfp.description || 'To be defined based on project requirements',
                        deliverables_list: rfpVariables.deliverables || 'Deliverables to be specified',
                        total_duration: rfpVariables.project_duration || 'TBD',
                        success_criteria: 'Project completion within timeline and budget',
                        functional_requirements: rfp.requirements || 'To be defined',
                        non_functional_requirements: 'Performance, security, and scalability requirements',
                        technology_stack: rfpVariables.technology_stack || 'Modern cloud-native technologies',
                        contractor_responsibilities: 'Design, development, testing, and deployment',
                        client_responsibilities: 'Requirements clarification, feedback, and acceptance',
                        team_structure: rfpVariables.team_structure || 'Project manager, developers, QA specialists',
                        payment_schedule: 'Milestone-based payments',
                        expense_policy: 'Pre-approved expenses reimbursed',
                        change_management_process: 'Change requests require written approval',
                        acceptance_criteria: 'Functional requirements met and client approval',
                        termination_conditions: '30-day written notice required',
                        ip_terms: 'Client retains all intellectual property rights',
                        confidentiality_terms: 'Standard confidentiality agreement applies',
                        methodology: rfpVariables.technical_approach || 'Agile development methodology with iterative deliverables'
                    };
                    
                    // Get SOW template (default to software development)
                    const templateData = TemplateManager.getTemplate('sow_templates', 'sow_template_1');
                    if (!templateData) {
                        console.error('SOW template not found');
                        return;
                    }
                    
                    let sowContent;
                    if (useLLM) {
                        sowContent = await TemplateManager.generateContentWithLLM(templateData, sowVariables, outputFormat);
                    } else {
                        sowContent = TemplateManager.processTemplate(templateData, sowVariables, outputFormat);
                    }
                    
                    if (sowContent.success) {
                        if (includeSow && rfp.proposal) {
                            // Add SOW section to the proposal content
                            if (typeof rfp.proposal.content === 'string') {
                                rfp.proposal.content += '\n\n## Statement of Work\n\n' + sowContent.content;
                            } else if (rfp.proposal.content && typeof rfp.proposal.content === 'object') {
                                rfp.proposal.content.sow_section = sowContent.content;
                            }
                            rfp.proposal.includes_sow = true;
                        }
                        
                        if (generateLinkedSow) {
                            // Create separate SOW document linked to RFP
                            const sow = {
                                id: 'sow_' + Date.now(),
                                title: `SOW - ${rfp.title}`,
                                client: rfp.client,
                                rfp_id: rfp.id,
                                rfp_title: rfp.title,
                                value: rfp.value,
                                template_used: 'sow_template_1',
                                output_format: outputFormat,
                                content: sowContent.content,
                                variables_used: sowVariables,
                                created: new Date().toISOString(),
                                status: 'draft',
                                generated_with_llm: useLLM,
                                linked_to_rfp: true
                            };
                            
                            // Save SOW
                            const sows = JSON.parse(localStorage.getItem('anthesis_sows') || '[]');
                            sows.push(sow);
                            localStorage.setItem('anthesis_sows', JSON.stringify(sows));
                            
                            // Link SOW to RFP
                            rfp.linked_sow_id = sow.id;
                            
                            this.showToast('SOW generated and linked to RFP!', 'success');
                        }
                    }
                } catch (error) {
                    console.error('Error generating SOW for RFP:', error);
                    this.showToast('Error generating SOW', 'warning');
                }
            }
            
            static createSOW() {
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Create Statement of Work</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="sow-form">
                                    <div class="mb-3">
                                        <label class="form-label">Project Title</label>
                                        <input type="text" class="form-control" name="title" required>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Client</label>
                                            <input type="text" class="form-control" name="client" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Project Value</label>
                                            <input type="number" class="form-control" name="value" step="0.01">
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Start Date</label>
                                            <input type="date" class="form-control" name="start_date">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">End Date</label>
                                            <input type="date" class="form-control" name="end_date">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label class="form-label">Project Scope</label>
                                        <textarea class="form-control" name="scope" rows="4" placeholder="Describe the project scope and deliverables..."></textarea>
                                    </div>
                                    <div class="mt-3">
                                        <label class="form-label">Key Requirements</label>
                                        <textarea class="form-control" name="requirements" rows="3" placeholder="List key requirements and specifications..."></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="RFPManager.generateSOW()">Generate SOW</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            }
            
            static async generateSOW() {
                const form = document.getElementById('sow-form');
                const formData = new FormData(form);
                const sowData = Object.fromEntries(formData);
                
                // Show template and format selection
                const templateModal = document.createElement('div');
                templateModal.className = 'modal fade';
                templateModal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">SOW Template & Format</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">Template Type</label>
                                    <select class="form-select" id="sow-template-select">
                                        <option value="sow_template_1">Software Development SOW</option>
                                        <option value="sow_template_2">Consulting Services SOW</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Output Format</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="sowFormat" value="markdown" checked>
                                        <label class="form-check-label">Markdown</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="sowFormat" value="html">
                                        <label class="form-check-label">HTML</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="sowFormat" value="pdf">
                                        <label class="form-check-label">PDF Ready</label>
                                    </div>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="sow-use-llm" checked>
                                    <label class="form-check-label" for="sow-use-llm">
                                        Use AI/LLM Enhancement
                                    </label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="RFPManager.generateSOWWithTemplate(${JSON.stringify(sowData).replace(/"/g, '&quot;')})">
                                    Generate SOW
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(templateModal);
                const bsTemplateModal = new bootstrap.Modal(templateModal);
                bsTemplateModal.show();
                
                templateModal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(templateModal);
                });
            }
            
            static async generateSOWWithTemplate(sowData) {
                const templateModal = document.querySelector('.modal');
                const selectedTemplate = templateModal.querySelector('#sow-template-select').value;
                const outputFormat = templateModal.querySelector('input[name="sowFormat"]:checked').value;
                const useLLM = templateModal.querySelector('#sow-use-llm').checked;
                
                bootstrap.Modal.getInstance(templateModal).hide();
                
                try {
                    this.showToast('Generating SOW with AI...', 'info');
                    
                    // Get template data
                    const templateData = TemplateManager.getTemplate('sow_templates', selectedTemplate);
                    if (!templateData) {
                        this.showToast('Template not found', 'error');
                        return;
                    }
                    
                    // Prepare variables for template
                    const variables = {
                        project_title: sowData.title,
                        client_name: sowData.client,
                        contractor_name: 'Anthesis Technologies',
                        contract_date: new Date().toLocaleDateString(),
                        contract_value: sowData.value ? '$' + parseInt(sowData.value).toLocaleString() : 'TBD',
                        start_date: sowData.start_date || 'TBD',
                        end_date: sowData.end_date || 'TBD',
                        project_objectives: sowData.scope || 'To be defined based on project requirements',
                        deliverables_list: sowData.requirements || 'Deliverables to be specified',
                        total_duration: sowData.start_date && sowData.end_date ? 
                            Math.ceil((new Date(sowData.end_date) - new Date(sowData.start_date)) / (1000 * 60 * 60 * 24)) + ' days' : 
                            'TBD',
                        success_criteria: 'Project completion within timeline and budget',
                        functional_requirements: sowData.requirements || 'To be defined',
                        non_functional_requirements: 'Performance, security, and scalability requirements',
                        technology_stack: 'Modern cloud-native technologies',
                        contractor_responsibilities: 'Design, development, testing, and deployment',
                        client_responsibilities: 'Requirements clarification, feedback, and acceptance',
                        team_structure: 'Project manager, developers, QA specialists',
                        payment_schedule: 'Milestone-based payments',
                        expense_policy: 'Pre-approved expenses reimbursed',
                        change_management_process: 'Change requests require written approval',
                        acceptance_criteria: 'Functional requirements met and client approval',
                        termination_conditions: '30-day written notice required',
                        ip_terms: 'Client retains all intellectual property rights',
                        confidentiality_terms: 'Standard confidentiality agreement applies'
                    };
                    
                    let sowContent;
                    
                    if (useLLM) {
                        // Use LLM for enhanced generation
                        sowContent = await TemplateManager.generateContentWithLLM(
                            templateData, 
                            variables, 
                            outputFormat
                        );
                    } else {
                        // Use template processing only
                        sowContent = TemplateManager.processTemplate(
                            templateData, 
                            variables, 
                            outputFormat
                        );
                    }
                    
                    if (sowContent.success) {
                        const sow = {
                            id: 'sow_' + Date.now(),
                            ...sowData,
                            template_used: selectedTemplate,
                            output_format: outputFormat,
                            content: sowContent.content,
                            variables_used: variables,
                            created: new Date().toISOString(),
                            status: 'draft',
                            generated_with_llm: useLLM
                        };
                        
                        // Save SOW
                        const sows = JSON.parse(localStorage.getItem('anthesis_sows') || '[]');
                        sows.push(sow);
                        localStorage.setItem('anthesis_sows', JSON.stringify(sows));
                        
                        this.showToast('SOW generated successfully!', 'success');
                        this.viewSOW(sow.id);
                    } else {
                        this.showToast('Error generating SOW: ' + sowContent.error, 'error');
                    }
                } catch (error) {
                    console.error('Error generating SOW:', error);
                    this.showToast('Error generating SOW', 'error');
                }
            }
            
            static updateRFPTable() {
                const tbody = document.getElementById('rfp-table-body');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                this.rfps.forEach(rfp => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${rfp.title}</td>
                        <td>${rfp.client}</td>
                        <td>${rfp.deadline ? new Date(rfp.deadline).toLocaleDateString() : 'N/A'}</td>
                        <td>${rfp.value ? '$' + new Intl.NumberFormat().format(rfp.value) : 'N/A'}</td>
                        <td>
                            <span class="badge bg-${this.getStatusColor(rfp.status)}">
                                ${this.getStatusText(rfp.status)}
                            </span>
                            ${rfp.proposal ? '<span class="badge bg-success ms-1" title="Proposal Generated"><i class="fas fa-file-alt"></i></span>' : ''}
                            ${rfp.linked_sow_id ? '<span class="badge bg-info ms-1" title="SOW Linked"><i class="fas fa-file-contract"></i></span>' : ''}
                            ${rfp.proposal && rfp.proposal.includes_sow ? '<span class="badge bg-warning ms-1" title="SOW Included in Proposal"><i class="fas fa-paperclip"></i></span>' : ''}
                        </td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar" role="progressbar" style="width: ${rfp.progress}%">
                                    ${rfp.progress}%
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="RFPManager.viewRFP('${rfp.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="RFPManager.generateResponse('${rfp.id}')">
                                    <i class="fas fa-magic"></i>
                                </button>
                                ${rfp.linked_sow_id ? `
                                <button class="btn btn-outline-info" onclick="RFPManager.viewLinkedSOW('${rfp.linked_sow_id}')" title="View SOW">
                                    <i class="fas fa-file-contract"></i>
                                </button>
                                ` : `
                                <button class="btn btn-outline-secondary" onclick="RFPManager.createSOWForRFP('${rfp.id}')" title="Create SOW">
                                    <i class="fas fa-plus"></i>
                                </button>
                                `}
                                <button class="btn btn-outline-info" onclick="RFPManager.downloadProposal('${rfp.id}')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                if (this.rfps.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted">
                                No RFPs uploaded yet. Click "Upload RFP" to get started.
                            </td>
                        </tr>
                    `;
                }
            }
            
            static updateDashboard() {
                const activeRFPs = this.rfps.filter(r => ['extracted', 'analyzing', 'proposal_generated'].includes(r.status));
                const proposals = this.rfps.filter(r => r.proposal);
                const won = this.rfps.filter(r => r.status === 'won');
                const winRate = this.rfps.length > 0 ? Math.round((won.length / this.rfps.length) * 100) : 0;
                
                document.getElementById('rfp-count').textContent = activeRFPs.length;
                document.getElementById('proposals-generated').textContent = proposals.length;
                document.getElementById('win-rate').textContent = winRate + '%';
                document.getElementById('avg-response-time').textContent = '2.5 days';
            }
            
            static getStatusColor(status) {
                const colors = {
                    'uploaded': 'secondary',
                    'extracted': 'info',
                    'analyzing': 'warning',
                    'proposal_generated': 'primary',
                    'submitted': 'success',
                    'won': 'success',
                    'lost': 'danger'
                };
                return colors[status] || 'secondary';
            }
            
            static getStatusText(status) {
                const texts = {
                    'uploaded': 'Uploaded',
                    'extracted': 'Extracted',
                    'analyzing': 'Analyzing',
                    'proposal_generated': 'Proposal Ready',
                    'submitted': 'Submitted',
                    'won': 'Won',
                    'lost': 'Lost'
                };
                return texts[status] || status;
            }
            
            static viewRFP(rfpId) {
                const rfp = this.rfps.find(r => r.id === rfpId);
                if (!rfp) return;
                
                this.currentRFP = rfp;
                
                // Create detailed view modal
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">RFP Details: ${rfp.title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h6>RFP Content</h6>
                                        <div class="border p-3 mb-3" style="max-height: 400px; overflow-y: auto;">
                                            ${rfp.content || 'Content being processed...'}
                                        </div>
                                        
                                        ${rfp.requirements ? `
                                        <h6>Requirements</h6>
                                        <div class="border p-3 mb-3">
                                            ${Array.isArray(rfp.requirements) ? rfp.requirements.join('<br>') : rfp.requirements}
                                        </div>
                                        ` : ''}
                                    </div>
                                    <div class="col-md-4">
                                        <h6>RFP Information</h6>
                                        <table class="table table-sm">
                                            <tr><td><strong>Client:</strong></td><td>${rfp.client}</td></tr>
                                            <tr><td><strong>Status:</strong></td><td><span class="badge bg-${this.getStatusColor(rfp.status)}">${this.getStatusText(rfp.status)}</span></td></tr>
                                            <tr><td><strong>Deadline:</strong></td><td>${rfp.deadline ? new Date(rfp.deadline).toLocaleDateString() : 'N/A'}</td></tr>
                                            <tr><td><strong>Value:</strong></td><td>${rfp.value ? '$' + new Intl.NumberFormat().format(rfp.value) : 'N/A'}</td></tr>
                                            <tr><td><strong>Uploaded:</strong></td><td>${new Date(rfp.uploadDate).toLocaleDateString()}</td></tr>
                                        </table>
                                        
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" onclick="RFPManager.generateResponse('${rfp.id}')">
                                                <i class="fas fa-magic"></i> Generate Response
                                            </button>
                                            ${rfp.proposal ? `
                                            <button class="btn btn-success" onclick="RFPManager.viewProposal('${rfp.proposal.id}')">
                                                <i class="fas fa-file-alt"></i> View Proposal
                                            </button>
                                            ` : ''}
                                            ${rfp.linked_sow_id ? `
                                            <button class="btn btn-info" onclick="RFPManager.viewLinkedSOW('${rfp.linked_sow_id}')">
                                                <i class="fas fa-file-contract"></i> View Linked SOW
                                            </button>
                                            ` : ''}
                                            <button class="btn btn-outline-secondary" onclick="RFPManager.createSOWForRFP('${rfp.id}')">
                                                <i class="fas fa-plus"></i> ${rfp.linked_sow_id ? 'Create Additional SOW' : 'Create SOW'}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            }
            
            static viewLinkedSOW(sowId) {
                // Use existing viewSOW method
                this.viewSOW(sowId);
            }
            
            static createSOWForRFP(rfpId) {
                const rfp = this.rfps.find(r => r.id === rfpId);
                if (!rfp) {
                    this.showToast('RFP not found', 'error');
                    return;
                }
                
                // Pre-populate SOW form with RFP data
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Create SOW for: ${rfp.title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="rfp-sow-form">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">SOW Title</label>
                                            <input type="text" class="form-control" name="title" value="SOW - ${rfp.title}" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Client</label>
                                            <input type="text" class="form-control" name="client" value="${rfp.client}" required>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Contract Value</label>
                                            <input type="number" class="form-control" name="value" value="${rfp.value || ''}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">SOW Type</label>
                                            <select class="form-select" name="sow_type">
                                                <option value="sow_template_1">Software Development</option>
                                                <option value="sow_template_2">Consulting Services</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Start Date</label>
                                            <input type="date" class="form-control" name="start_date">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">End Date</label>
                                            <input type="date" class="form-control" name="end_date">
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label class="form-label">Project Scope</label>
                                        <textarea class="form-control" name="scope" rows="4" placeholder="Describe the project scope and deliverables...">${rfp.description || ''}</textarea>
                                    </div>
                                    <div class="mt-3">
                                        <label class="form-label">Key Requirements</label>
                                        <textarea class="form-control" name="requirements" rows="3" placeholder="List key requirements and specifications...">${Array.isArray(rfp.requirements) ? rfp.requirements.join('\\n') : (rfp.requirements || '')}</textarea>
                                    </div>
                                    <div class="mt-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="rfp-sow-use-llm" checked>
                                            <label class="form-check-label" for="rfp-sow-use-llm">
                                                Use AI/LLM Enhancement
                                            </label>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="RFPManager.generateSOWFromRFP('${rfpId}')">Generate SOW</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            }
            
            static async generateSOWFromRFP(rfpId) {
                const modal = document.querySelector('.modal');
                const form = modal.querySelector('#rfp-sow-form');
                const formData = new FormData(form);
                const sowData = Object.fromEntries(formData);
                const useLLM = modal.querySelector('#rfp-sow-use-llm').checked;
                
                bootstrap.Modal.getInstance(modal).hide();
                
                try {
                    this.showToast('Generating SOW from RFP...', 'info');
                    
                    const rfp = this.rfps.find(r => r.id === rfpId);
                    const templateData = TemplateManager.getTemplate('sow_templates', sowData.sow_type);
                    
                    if (!templateData) {
                        this.showToast('SOW template not found', 'error');
                        return;
                    }
                    
                    // Prepare comprehensive variables
                    const variables = {
                        project_title: sowData.title,
                        client_name: sowData.client,
                        contractor_name: 'Anthesis Technologies',
                        contract_date: new Date().toLocaleDateString(),
                        contract_value: sowData.value ? '$' + parseInt(sowData.value).toLocaleString() : 'TBD',
                        start_date: sowData.start_date || 'TBD',
                        end_date: sowData.end_date || 'TBD',
                        project_objectives: sowData.scope || 'To be defined based on project requirements',
                        deliverables_list: sowData.requirements || 'Deliverables to be specified',
                        total_duration: sowData.start_date && sowData.end_date ? 
                            Math.ceil((new Date(sowData.end_date) - new Date(sowData.start_date)) / (1000 * 60 * 60 * 24)) + ' days' : 
                            'TBD',
                        methodology: rfp.proposal?.technical_approach || 'Agile development methodology',
                        success_criteria: 'Project completion within timeline and budget',
                        functional_requirements: sowData.requirements || 'To be defined',
                        non_functional_requirements: 'Performance, security, and scalability requirements',
                        technology_stack: 'Modern cloud-native technologies',
                        contractor_responsibilities: 'Design, development, testing, and deployment',
                        client_responsibilities: 'Requirements clarification, feedback, and acceptance',
                        team_structure: 'Project manager, developers, QA specialists',
                        payment_schedule: 'Milestone-based payments',
                        expense_policy: 'Pre-approved expenses reimbursed',
                        change_management_process: 'Change requests require written approval',
                        acceptance_criteria: 'Functional requirements met and client approval',
                        termination_conditions: '30-day written notice required',
                        ip_terms: 'Client retains all intellectual property rights',
                        confidentiality_terms: 'Standard confidentiality agreement applies'
                    };
                    
                    let sowContent;
                    if (useLLM) {
                        sowContent = await TemplateManager.generateContentWithLLM(templateData, variables, 'markdown');
                    } else {
                        sowContent = TemplateManager.processTemplate(templateData, variables, 'markdown');
                    }
                    
                    if (sowContent.success) {
                        const sow = {
                            id: 'sow_' + Date.now(),
                            ...sowData,
                            rfp_id: rfpId,
                            rfp_title: rfp.title,
                            template_used: sowData.sow_type,
                            output_format: 'markdown',
                            content: sowContent.content,
                            variables_used: variables,
                            created: new Date().toISOString(),
                            status: 'draft',
                            generated_with_llm: useLLM,
                            linked_to_rfp: true
                        };
                        
                        // Save SOW
                        const sows = JSON.parse(localStorage.getItem('anthesis_sows') || '[]');
                        sows.push(sow);
                        localStorage.setItem('anthesis_sows', JSON.stringify(sows));
                        
                        // Link SOW to RFP
                        rfp.linked_sow_id = sow.id;
                        this.saveRFPs();
                        
                        this.showToast('SOW generated and linked to RFP successfully!', 'success');
                        this.viewSOW(sow.id);
                    } else {
                        this.showToast('Error generating SOW: ' + sowContent.error, 'error');
                    }
                } catch (error) {
                    console.error('Error generating SOW from RFP:', error);
                    this.showToast('Error generating SOW', 'error');
                }
            }
            
            static viewProposal(proposalId) {
                const rfp = this.rfps.find(r => r.proposal && r.proposal.id === proposalId);
                if (!rfp || !rfp.proposal) return;
                
                const proposal = rfp.proposal;
                
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Proposal: ${rfp.title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <nav>
                                            <div class="nav nav-tabs" id="proposal-tabs">
                                                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#executive-summary">Executive Summary</button>
                                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#technical-approach">Technical Approach</button>
                                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#timeline">Timeline</button>
                                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#budget">Budget</button>
                                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#team">Team</button>
                                            </div>
                                        </nav>
                                        <div class="tab-content mt-3">
                                            <div class="tab-pane fade show active" id="executive-summary">
                                                <div class="p-3 border">
                                                    ${proposal.executive_summary || 'Executive summary will be generated...'}
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="technical-approach">
                                                <div class="p-3 border">
                                                    ${proposal.technical_approach || 'Technical approach will be generated...'}
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="timeline">
                                                <div class="p-3 border">
                                                    ${proposal.timeline || 'Timeline will be generated...'}
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="budget">
                                                <div class="p-3 border">
                                                    ${proposal.budget || 'Budget will be generated...'}
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="team">
                                                <div class="p-3 border">
                                                    ${proposal.team || 'Team information will be generated...'}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-outline-primary" onclick="RFPManager.editProposal('${proposal.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-success" onclick="RFPManager.downloadProposal('${rfp.id}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="btn btn-primary" onclick="RFPManager.submitProposal('${proposal.id}')">
                                    <i class="fas fa-paper-plane"></i> Submit
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            }
            
            static downloadProposal(rfpId) {
                const rfp = this.rfps.find(r => r.id === rfpId);
                if (!rfp || !rfp.proposal) {
                    this.showToast('No proposal available for download', 'warning');
                    return;
                }
                
                // Generate downloadable document
                const content = `
                    PROPOSAL FOR: ${rfp.title}
                    CLIENT: ${rfp.client}
                    DATE: ${new Date().toLocaleDateString()}
                    
                    EXECUTIVE SUMMARY
                    ${rfp.proposal.executive_summary || 'N/A'}
                    
                    TECHNICAL APPROACH
                    ${rfp.proposal.technical_approach || 'N/A'}
                    
                    TIMELINE
                    ${rfp.proposal.timeline || 'N/A'}
                    
                    BUDGET
                    ${rfp.proposal.budget || 'N/A'}
                    
                    TEAM
                    ${rfp.proposal.team || 'N/A'}
                `;
                
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${rfp.title.replace(/[^a-z0-9]/gi, '_')}_proposal.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showToast('Proposal downloaded successfully!', 'success');
            }
            
            static editProposal(proposalId) {
                const rfp = this.rfps.find(r => r.proposal && r.proposal.id === proposalId);
                if (!rfp || !rfp.proposal) {
                    this.showToast('Proposal not found', 'error');
                    return;
                }
                
                const proposal = rfp.proposal;
                
                // Create edit modal
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Edit Proposal: ${rfp.title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="edit-proposal-form">
                                    <div class="mb-3">
                                        <label class="form-label">Executive Summary</label>
                                        <textarea class="form-control" name="executive_summary" rows="4">${proposal.executive_summary || ''}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Technical Approach</label>
                                        <textarea class="form-control" name="technical_approach" rows="6">${proposal.technical_approach || ''}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Timeline</label>
                                        <textarea class="form-control" name="timeline" rows="4">${proposal.timeline || ''}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Budget</label>
                                        <textarea class="form-control" name="budget" rows="4">${proposal.budget || ''}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Team</label>
                                        <textarea class="form-control" name="team" rows="4">${proposal.team || ''}</textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="RFPManager.saveProposalEdits('${proposalId}')">Save Changes</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            }
            
            static saveProposalEdits(proposalId) {
                const form = document.getElementById('edit-proposal-form');
                const formData = new FormData(form);
                const updatedData = Object.fromEntries(formData);
                
                const rfp = this.rfps.find(r => r.proposal && r.proposal.id === proposalId);
                if (rfp && rfp.proposal) {
                    // Update proposal with edited content
                    Object.assign(rfp.proposal, updatedData);
                    rfp.proposal.modified = new Date().toISOString();
                    
                    this.saveRFPs();
                    bootstrap.Modal.getInstance(document.querySelector('.modal')).hide();
                    this.showToast('Proposal updated successfully!', 'success');
                    
                    // Refresh the proposal view if it's open
                    setTimeout(() => this.viewProposal(proposalId), 100);
                }
            }
            
            static submitProposal(proposalId) {
                const rfp = this.rfps.find(r => r.proposal && r.proposal.id === proposalId);
                if (!rfp || !rfp.proposal) {
                    this.showToast('Proposal not found', 'error');
                    return;
                }
                
                // Create submission confirmation modal
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Submit Proposal</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p>Are you ready to submit this proposal for <strong>${rfp.title}</strong>?</p>
                                <p class="text-muted">Once submitted, the proposal status will be updated and the client will be notified.</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="final-review-check">
                                    <label class="form-check-label" for="final-review-check">
                                        I have completed final review and approve this proposal for submission
                                    </label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-success" onclick="RFPManager.confirmSubmitProposal('${proposalId}')" id="confirm-submit-btn" disabled>Submit Proposal</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                // Enable submit button when checkbox is checked
                modal.querySelector('#final-review-check').addEventListener('change', function() {
                    modal.querySelector('#confirm-submit-btn').disabled = !this.checked;
                });
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            }
            
            static confirmSubmitProposal(proposalId) {
                const rfp = this.rfps.find(r => r.proposal && r.proposal.id === proposalId);
                if (rfp && rfp.proposal) {
                    // Update RFP status to submitted
                    rfp.status = 'submitted';
                    rfp.progress = 95;
                    rfp.proposal.status = 'submitted';
                    rfp.proposal.submitted_date = new Date().toISOString();
                    
                    this.saveRFPs();
                    this.updateRFPTable();
                    this.updateDashboard();
                    
                    bootstrap.Modal.getInstance(document.querySelector('.modal')).hide();
                    this.showToast('Proposal submitted successfully!', 'success');
                    
                    // Optional: Send notification or email to client
                    setTimeout(() => {
                        this.showToast('Client notification sent', 'info');
                    }, 2000);
                }
            }
            
            static viewSOW(sowId) {
                // Load and display SOW document
                const sows = JSON.parse(localStorage.getItem('anthesis_sows') || '[]');
                const sow = sows.find(s => s.id === sowId);
                
                if (!sow) {
                    this.showToast('SOW not found', 'error');
                    return;
                }
                
                // Create SOW viewer modal
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Statement of Work: ${sow.title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="border p-4" style="max-height: 500px; overflow-y: auto; white-space: pre-line;">
                                            ${sow.content}
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <h6>SOW Details</h6>
                                        <table class="table table-sm">
                                            <tr><td><strong>Client:</strong></td><td>${sow.client}</td></tr>
                                            <tr><td><strong>Value:</strong></td><td>$${sow.value ? new Intl.NumberFormat().format(sow.value) : 'TBD'}</td></tr>
                                            <tr><td><strong>Start:</strong></td><td>${sow.start_date || 'TBD'}</td></tr>
                                            <tr><td><strong>End:</strong></td><td>${sow.end_date || 'TBD'}</td></tr>
                                            <tr><td><strong>Status:</strong></td><td><span class="badge bg-${sow.status === 'approved' ? 'success' : 'secondary'}">${sow.status}</span></td></tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-outline-primary" onclick="RFPManager.editSOW('${sow.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-success" onclick="RFPManager.downloadSOW('${sow.id}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                modal.addEventListener('hidden.bs.modal', () => {
                    document.body.removeChild(modal);
                });
            }
            
            static editSOW(sowId) {
                this.showToast('SOW editing coming soon!', 'info');
            }
            
            static downloadSOW(sowId) {
                const sows = JSON.parse(localStorage.getItem('anthesis_sows') || '[]');
                const sow = sows.find(s => s.id === sowId);
                
                if (sow) {
                    const blob = new Blob([sow.content], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${sow.title.replace(/[^a-z0-9]/gi, '_')}_SOW.txt`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    this.showToast('SOW downloaded successfully!', 'success');
                }
            }
            
            static showToast(message, type = 'info') {
                // Create toast notification
                const toast = document.createElement('div');
                toast.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
                toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                toast.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 5000);
                
                return toast;
            }
        }

    // Template Manager Class
    class TemplateManager {
      static templates = {
        rfp_responses: [],
        sow_templates: [],
        email_templates: []
      };
      
      static init() {
        this.loadTemplates();
      }

      static async loadTemplates() {
        try {
          // Load templates from local storage or use defaults
          const savedTemplates = localStorage.getItem('anthesis_templates');
          if (savedTemplates) {
            this.templates = JSON.parse(savedTemplates);
          } else {
            this.templates = this.getDefaultTemplates();
            this.saveTemplates();
          }
          this.displayTemplates();
        } catch (error) {
          console.error('Error loading templates:', error);
        }
      }
      
      static saveTemplates() {
        localStorage.setItem('anthesis_templates', JSON.stringify(this.templates));
      }

      static getDefaultTemplates() {
        return {
          company_profile: {
            name: 'Anthesis Technologies',
            tagline: 'Innovative Solutions for Digital Transformation',
            founded_year: '2018',
            headquarters: 'Seattle, WA',
            employees: '150+',
            annual_revenue: '$25M+',
            certifications: ['ISO 9001', 'SOC 2 Type II', 'AWS Partner', 'Microsoft Gold Partner'],
            industries_served: ['Healthcare', 'Financial Services', 'Government', 'Education', 'Manufacturing'],
            core_capabilities: [
              'Cloud Migration & Architecture',
              'Custom Software Development',
              'AI/ML Implementation',
              'Cybersecurity Solutions',
              'DevOps & Infrastructure',
              'Data Analytics & BI',
              'Mobile App Development',
              'UI/UX Design'
            ],
            key_technologies: {
              'Cloud Platforms': ['AWS', 'Azure', 'Google Cloud'],
              'Programming Languages': ['Python', 'JavaScript', 'Java', 'C#', '.NET'],
              'Frameworks': ['React', 'Angular', 'Node.js', 'Django', 'Spring Boot'],
              'Databases': ['PostgreSQL', 'MongoDB', 'Redis', 'Elasticsearch'],
              'DevOps': ['Docker', 'Kubernetes', 'Jenkins', 'Terraform', 'Ansible']
            },
            team_leads: [
              {
                name: 'Sarah Chen',
                title: 'Chief Technology Officer',
                experience: '15+ years',
                specialties: ['Cloud Architecture', 'AI/ML', 'Team Leadership'],
                certifications: ['AWS Solutions Architect', 'PMP', 'Certified Scrum Master']
              },
              {
                name: 'Michael Rodriguez',
                title: 'Lead Software Architect',
                experience: '12+ years',
                specialties: ['Microservices', 'Security', 'Performance Optimization'],
                certifications: ['Azure Solutions Architect', 'CISSP', 'Oracle Certified Professional']
              },
              {
                name: 'Emily Johnson',
                title: 'Project Manager',
                experience: '10+ years',
                specialties: ['Agile Methodologies', 'Stakeholder Management', 'Risk Assessment'],
                certifications: ['PMP', 'CSM', 'PRINCE2']
              }
            ],
            recent_projects: [
              {
                client: 'Regional Healthcare System',
                project: 'Cloud Migration & EHR Integration',
                value: '$2.5M',
                duration: '18 months',
                technologies: ['AWS', 'HL7 FHIR', 'React', 'Node.js'],
                outcome: '40% reduction in infrastructure costs, 99.9% uptime'
              },
              {
                client: 'Financial Services Company',
                project: 'AI-Powered Fraud Detection System',
                value: '$1.8M',
                duration: '12 months',
                technologies: ['Python', 'TensorFlow', 'Kubernetes', 'PostgreSQL'],
                outcome: '85% improvement in fraud detection accuracy'
              },
              {
                client: 'Government Agency',
                project: 'Secure Document Management Platform',
                value: '$3.2M',
                duration: '24 months',
                technologies: ['Azure', 'C#', '.NET Core', 'SQL Server'],
                outcome: 'FedRAMP compliance achieved, 60% faster document processing'
              }
            ],
            differentiators: [
              'Proven track record with 200+ successful projects',
              'Industry-leading security practices and compliance expertise',
              'Agile development methodology with continuous client collaboration',
              'Dedicated post-deployment support and maintenance',
              '24/7 monitoring and incident response capabilities'
            ],
            awards_recognition: [
              'AWS Partner of the Year 2023',
              'Microsoft Solution Partner Excellence Award',
              'Inc. 5000 Fastest Growing Companies (3 consecutive years)',
              'Best Places to Work in Tech - Seattle Business Journal'
            ]
          },
          rfp_responses: [
            {
              id: 'rfp_template_1',
              name: 'Technical Services Proposal',
              type: 'technical',
              format: 'detailed',
              modular: true,
              available_sections: ['executive_summary', 'technical_approach', 'methodology', 'sow_embedded', 'timeline', 'budget', 'team', 'risk_management', 'quality_assurance'],
              sections: {
                executive_summary: {
                  template: `# Executive Summary

We are pleased to submit our proposal for {{rfp_title}}. With {{years_experience}} years of experience in {{domain}}, {{company_name}} is uniquely positioned to deliver exceptional results for {{client_name}}.

## Key Value Propositions:
- {{value_prop_1}}
- {{value_prop_2}}
- {{value_prop_3}}

## Investment Overview:
Total Project Investment: ${{total_budget}}
Timeline: {{project_duration}}
Expected ROI: {{expected_roi}}

We are confident that our approach will exceed your expectations and deliver measurable business value.`,
                  variables: ['rfp_title', 'years_experience', 'domain', 'company_name', 'client_name', 'value_prop_1', 'value_prop_2', 'value_prop_3', 'total_budget', 'project_duration', 'expected_roi']
                },
                technical_approach: {
                  template: `# Technical Approach

## Methodology
Our proven {{methodology_name}} methodology ensures successful project delivery through structured phases:

### Phase 1: Discovery & Analysis ({{phase1_duration}})
- Requirements gathering and validation
- Technical architecture assessment
- Risk analysis and mitigation planning
- {{custom_phase1_activity}}

### Phase 2: Design & Development ({{phase2_duration}})
- System design and architecture
- Development using {{technology_stack}}
- Quality assurance and testing
- {{custom_phase2_activity}}

### Phase 3: Implementation & Deployment ({{phase3_duration}})
- Production deployment
- User training and documentation
- Performance optimization
- {{custom_phase3_activity}}

### Phase 4: Support & Maintenance ({{phase4_duration}})
- Ongoing technical support
- Performance monitoring
- Feature enhancements
- {{custom_phase4_activity}}

## Technology Stack
- **Frontend**: {{frontend_tech}}
- **Backend**: {{backend_tech}}
- **Database**: {{database_tech}}
- **Cloud Platform**: {{cloud_platform}}
- **Security**: {{security_framework}}`,
                  variables: ['methodology_name', 'phase1_duration', 'phase2_duration', 'phase3_duration', 'phase4_duration', 'custom_phase1_activity', 'custom_phase2_activity', 'custom_phase3_activity', 'custom_phase4_activity', 'technology_stack', 'frontend_tech', 'backend_tech', 'database_tech', 'cloud_platform', 'security_framework']
                },
                timeline: {
                  template: `# Project Timeline

## Overall Schedule
**Project Duration**: {{total_duration}}
**Start Date**: {{start_date}}
**Completion Date**: {{end_date}}

## Detailed Milestones

| Phase | Duration | Start Date | End Date | Key Deliverables |
|-------|----------|------------|----------|------------------|
| {{phase1_name}} | {{phase1_duration}} | {{phase1_start}} | {{phase1_end}} | {{phase1_deliverables}} |
| {{phase2_name}} | {{phase2_duration}} | {{phase2_start}} | {{phase2_end}} | {{phase2_deliverables}} |
| {{phase3_name}} | {{phase3_duration}} | {{phase3_start}} | {{phase3_end}} | {{phase3_deliverables}} |
| {{phase4_name}} | {{phase4_duration}} | {{phase4_start}} | {{phase4_end}} | {{phase4_deliverables}} |

## Critical Dependencies
- {{dependency_1}}
- {{dependency_2}}
- {{dependency_3}}

## Risk Mitigation
- {{risk_mitigation_1}}
- {{risk_mitigation_2}}
- {{risk_mitigation_3}}`,
                  variables: ['total_duration', 'start_date', 'end_date', 'phase1_name', 'phase1_duration', 'phase1_start', 'phase1_end', 'phase1_deliverables', 'phase2_name', 'phase2_duration', 'phase2_start', 'phase2_end', 'phase2_deliverables', 'phase3_name', 'phase3_duration', 'phase3_start', 'phase3_end', 'phase3_deliverables', 'phase4_name', 'phase4_duration', 'phase4_start', 'phase4_end', 'phase4_deliverables', 'dependency_1', 'dependency_2', 'dependency_3', 'risk_mitigation_1', 'risk_mitigation_2', 'risk_mitigation_3']
                },
                budget: {
                  template: `# Budget Breakdown

## Investment Summary
**Total Project Investment**: ${{total_budget}}
**Payment Terms**: {{payment_terms}}

## Detailed Cost Breakdown

### Professional Services
| Service Category | Hours | Rate | Total |
|------------------|-------|------|-------|
| {{service1_name}} | {{service1_hours}} | ${{service1_rate}} | ${{service1_total}} |
| {{service2_name}} | {{service2_hours}} | ${{service2_rate}} | ${{service2_total}} |
| {{service3_name}} | {{service3_hours}} | ${{service3_rate}} | ${{service3_total}} |
| {{service4_name}} | {{service4_hours}} | ${{service4_rate}} | ${{service4_total}} |

### Technology & Infrastructure
- {{tech_cost_1}}: ${{tech_amount_1}}
- {{tech_cost_2}}: ${{tech_amount_2}}
- {{tech_cost_3}}: ${{tech_amount_3}}

### Additional Costs
- {{additional_cost_1}}: ${{additional_amount_1}}
- {{additional_cost_2}}: ${{additional_amount_2}}

## Payment Schedule
- **Phase 1 Completion**: {{payment1_percent}}% (${{payment1_amount}})
- **Phase 2 Completion**: {{payment2_percent}}% (${{payment2_amount}})
- **Phase 3 Completion**: {{payment3_percent}}% (${{payment3_amount}})
- **Final Delivery**: {{payment4_percent}}% (${{payment4_amount}})`,
                  variables: ['total_budget', 'payment_terms', 'service1_name', 'service1_hours', 'service1_rate', 'service1_total', 'service2_name', 'service2_hours', 'service2_rate', 'service2_total', 'service3_name', 'service3_hours', 'service3_rate', 'service3_total', 'service4_name', 'service4_hours', 'service4_rate', 'service4_total', 'tech_cost_1', 'tech_amount_1', 'tech_cost_2', 'tech_amount_2', 'tech_cost_3', 'tech_amount_3', 'additional_cost_1', 'additional_amount_1', 'additional_cost_2', 'additional_amount_2', 'payment1_percent', 'payment1_amount', 'payment2_percent', 'payment2_amount', 'payment3_percent', 'payment3_amount', 'payment4_percent', 'payment4_amount']
                },
                team: {
                  template: `# Project Team

## Core Team Members

### {{team_lead_title}}
**{{team_lead_name}}**
- {{team_lead_experience}} years of experience in {{team_lead_expertise}}
- {{team_lead_credential_1}}
- {{team_lead_credential_2}}
- Previous projects: {{team_lead_projects}}

### {{developer_title}}
**{{developer_name}}**
- {{developer_experience}} years of experience in {{developer_expertise}}
- {{developer_credential_1}}
- {{developer_credential_2}}
- Specializations: {{developer_specializations}}

### {{architect_title}}
**{{architect_name}}**
- {{architect_experience}} years of experience in {{architect_expertise}}
- {{architect_credential_1}}
- {{architect_credential_2}}
- Architecture focus: {{architect_focus}}

### {{qa_title}}
**{{qa_name}}**
- {{qa_experience}} years of experience in {{qa_expertise}}
- {{qa_credential_1}}
- {{qa_credential_2}}
- Testing methodologies: {{qa_methodologies}}

## Team Availability
All core team members are available for {{availability_percentage}}% dedication to this project during the {{project_duration}} timeline.

## Additional Resources
- {{additional_resource_1}}
- {{additional_resource_2}}
- {{additional_resource_3}}`,
                  variables: ['team_lead_title', 'team_lead_name', 'team_lead_experience', 'team_lead_expertise', 'team_lead_credential_1', 'team_lead_credential_2', 'team_lead_projects', 'developer_title', 'developer_name', 'developer_experience', 'developer_expertise', 'developer_credential_1', 'developer_credential_2', 'developer_specializations', 'architect_title', 'architect_name', 'architect_experience', 'architect_expertise', 'architect_credential_1', 'architect_credential_2', 'architect_focus', 'qa_title', 'qa_name', 'qa_experience', 'qa_expertise', 'qa_credential_1', 'qa_credential_2', 'qa_methodologies', 'availability_percentage', 'project_duration', 'additional_resource_1', 'additional_resource_2', 'additional_resource_3']
                }
              },
              output_formats: ['markdown', 'html', 'pdf', 'docx'],
              created: new Date().toISOString()
            },
            {
              id: 'rfp_template_2',
              name: 'Consulting Services Proposal',
              type: 'consulting',
              format: 'executive',
              sections: {
                executive_summary: {
                  template: `# Executive Summary

{{company_name}} is pleased to present this proposal for {{rfp_title}}. Our consulting approach combines strategic insight with practical implementation to deliver measurable business outcomes.

## Our Understanding
{{client_name}} is seeking {{client_need}} to achieve {{client_goal}}. We understand the importance of {{critical_factor}} in your decision-making process.

## Our Solution
Our recommendation includes:
1. {{solution_component_1}}
2. {{solution_component_2}}
3. {{solution_component_3}}

## Expected Outcomes
- {{outcome_1}}
- {{outcome_2}}
- {{outcome_3}}

**Investment**: ${{total_investment}}
**Timeline**: {{project_timeline}}
**ROI Projection**: {{roi_projection}}`,
                  variables: ['company_name', 'rfp_title', 'client_name', 'client_need', 'client_goal', 'critical_factor', 'solution_component_1', 'solution_component_2', 'solution_component_3', 'outcome_1', 'outcome_2', 'outcome_3', 'total_investment', 'project_timeline', 'roi_projection']
                }
              },
              output_formats: ['markdown', 'html', 'pdf'],
              created: new Date().toISOString()
            }
          ],
          sow_templates: [
            {
              id: 'sow_template_1',
              name: 'Software Development SOW',
              type: 'software_development',
              template: `# STATEMENT OF WORK

**Project**: {{project_title}}
**Client**: {{client_name}}
**Contractor**: {{contractor_name}}
**Date**: {{contract_date}}

## 1. PROJECT SCOPE

### 1.1 Objectives
{{project_objectives}}

### 1.2 Deliverables
{{deliverables_list}}

### 1.3 Success Criteria
{{success_criteria}}

## 2. TECHNICAL REQUIREMENTS

### 2.1 Functional Requirements
{{functional_requirements}}

### 2.2 Non-Functional Requirements
{{non_functional_requirements}}

### 2.3 Technology Stack
{{technology_stack}}

## 3. PROJECT TIMELINE

**Start Date**: {{start_date}}
**End Date**: {{end_date}}
**Total Duration**: {{total_duration}}

### Milestones
{{milestones_table}}

## 4. RESOURCES AND RESPONSIBILITIES

### 4.1 {{contractor_name}} Responsibilities
{{contractor_responsibilities}}

### 4.2 {{client_name}} Responsibilities
{{client_responsibilities}}

### 4.3 Team Structure
{{team_structure}}

## 5. FINANCIAL TERMS

**Total Contract Value**: ${{contract_value}}
**Payment Schedule**: {{payment_schedule}}
**Expenses**: {{expense_policy}}

## 6. CHANGE MANAGEMENT

{{change_management_process}}

## 7. ACCEPTANCE CRITERIA

{{acceptance_criteria}}

## 8. TERMINATION CONDITIONS

{{termination_conditions}}

## 9. INTELLECTUAL PROPERTY

{{ip_terms}}

## 10. CONFIDENTIALITY

{{confidentiality_terms}}

---

**Client Signature**: _________________ Date: _________

**Contractor Signature**: _________________ Date: _________`,
              variables: ['project_title', 'client_name', 'contractor_name', 'contract_date', 'project_objectives', 'deliverables_list', 'success_criteria', 'functional_requirements', 'non_functional_requirements', 'technology_stack', 'start_date', 'end_date', 'total_duration', 'milestones_table', 'contractor_responsibilities', 'client_responsibilities', 'team_structure', 'contract_value', 'payment_schedule', 'expense_policy', 'change_management_process', 'acceptance_criteria', 'termination_conditions', 'ip_terms', 'confidentiality_terms'],
              output_formats: ['markdown', 'html', 'pdf', 'docx'],
              created: new Date().toISOString()
            },
            {
              id: 'sow_template_2',
              name: 'Consulting Services SOW',
              type: 'consulting',
              template: `# STATEMENT OF WORK - CONSULTING SERVICES

**Engagement**: {{engagement_title}}
**Client**: {{client_name}}
**Consultant**: {{consultant_name}}
**Effective Date**: {{effective_date}}

## ENGAGEMENT OVERVIEW

### Objective
{{engagement_objective}}

### Scope of Services
{{scope_of_services}}

### Expected Outcomes
{{expected_outcomes}}

## DELIVERABLES

{{deliverables_detailed}}

## TIMELINE

**Engagement Duration**: {{engagement_duration}}
**Key Milestones**:
{{milestones_list}}

## FEES AND EXPENSES

**Professional Fees**: {{professional_fees}}
**Billing Rate**: {{billing_rate}}
**Estimated Hours**: {{estimated_hours}}
**Expense Reimbursement**: {{expense_terms}}

## TERMS AND CONDITIONS

{{terms_and_conditions}}

---

**Authorized Signatures**

Client: _________________ Date: _________

Consultant: _________________ Date: _________`,
              variables: ['engagement_title', 'client_name', 'consultant_name', 'effective_date', 'engagement_objective', 'scope_of_services', 'expected_outcomes', 'deliverables_detailed', 'engagement_duration', 'milestones_list', 'professional_fees', 'billing_rate', 'estimated_hours', 'expense_terms', 'terms_and_conditions'],
              output_formats: ['markdown', 'html', 'pdf'],
              created: new Date().toISOString()
            }
          ],
          email_templates: [
            {
              id: 'email_template_1',
              name: "RFP Response Cover Letter",
              subject: "Proposal Submission - {{rfp_title}}",
              category: "rfp",
              body: `Dear {{client_name}},

We are pleased to submit our comprehensive proposal for {{rfp_title}}. Our team has carefully reviewed your requirements and developed a solution that addresses your specific needs.

Key highlights of our proposal:
- {{key_strength_1}}
- {{key_strength_2}}
- {{key_strength_3}}

Attached you will find our detailed proposal including technical approach, timeline, and budget information.

We look forward to discussing our proposal with you and answering any questions you may have.

Best regards,
{{company_name}}
{{contact_person}}
{{contact_email}}
{{contact_phone}}`,
              variables: ['rfp_title', 'client_name', 'key_strength_1', 'key_strength_2', 'key_strength_3', 'company_name', 'contact_person', 'contact_email', 'contact_phone'],
              created: new Date().toISOString()
            }
          ],
          component_templates: {
            executive_summary: {
              id: 'exec_summary',
              name: 'Executive Summary',
              category: 'Introduction',
              template: `
                <div class="component-section executive-summary">
                  <h2 class="section-header">Executive Summary</h2>
                  <div class="company-intro">
                    <h3>{company_name}</h3>
                    <p class="tagline">{company_tagline}</p>
                    <div class="company-stats">
                      <span class="stat">Founded: {founded_year}</span>
                      <span class="stat">Employees: {employees}</span>
                      <span class="stat">Revenue: {annual_revenue}</span>
                    </div>
                  </div>
                  <div class="value-proposition">
                    <p>We understand your need for {rfp_objective} and are uniquely positioned to deliver exceptional results through our proven expertise in {relevant_capabilities}.</p>
                    <p>Our approach combines {methodology} with deep industry knowledge in {industry}, ensuring {key_benefits}.</p>
                  </div>
                  <div class="key-highlights">
                    <h4>Why Choose {company_name}</h4>
                    <ul class="highlight-list">
                      {differentiators}
                    </ul>
                  </div>
                </div>
              `,
              style: `
                .executive-summary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; }
                .executive-summary .section-header { color: white; font-size: 2.2em; margin-bottom: 20px; }
                .company-intro h3 { font-size: 1.8em; margin-bottom: 5px; }
                .tagline { font-style: italic; opacity: 0.9; margin-bottom: 15px; }
                .company-stats { display: flex; gap: 20px; margin-bottom: 20px; }
                .stat { background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9em; }
                .value-proposition p { margin-bottom: 15px; line-height: 1.6; }
                .key-highlights h4 { margin-bottom: 15px; font-size: 1.3em; }
                .highlight-list { list-style: none; padding: 0; }
                .highlight-list li { padding: 8px 0; border-left: 3px solid white; padding-left: 15px; margin-bottom: 10px; }
              `
            },
            company_overview: {
              id: 'company_overview',
              name: 'Company Overview',
              category: 'About Us',
              template: `
                <div class="component-section company-overview">
                  <h2 class="section-header">About {company_name}</h2>
                  <div class="overview-grid">
                    <div class="company-story">
                      <h3>Our Story</h3>
                      <p>Founded in {founded_year}, {company_name} has grown from a startup vision to a leading provider of {core_focus}. With headquarters in {headquarters} and {employees} dedicated professionals, we serve clients across {industries_count} industries.</p>
                      <p>Our mission is to deliver {mission_statement} through innovative technology solutions and exceptional client service.</p>
                    </div>
                    <div class="certifications">
                      <h3>Certifications & Partnerships</h3>
                      <div class="cert-grid">
                        {certifications_list}
                      </div>
                    </div>
                    <div class="awards">
                      <h3>Awards & Recognition</h3>
                      <ul class="awards-list">
                        {awards_list}
                      </ul>
                    </div>
                  </div>
                </div>
              `,
              style: `
                .company-overview { background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 30px; }
                .overview-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px; }
                .company-story { grid-column: 1 / -1; margin-bottom: 20px; }
                .company-story p { line-height: 1.6; margin-bottom: 15px; }
                .cert-grid { display: flex; flex-wrap: wrap; gap: 10px; }
                .cert-badge { background: #e3f2fd; color: #1976d2; padding: 8px 15px; border-radius: 20px; font-size: 0.9em; border: 1px solid #bbdefb; }
                .awards-list { list-style: none; padding: 0; }
                .awards-list li { padding: 10px 0; border-bottom: 1px solid #dee2e6; }
                .awards-list li:last-child { border-bottom: none; }
              `
            },
            technical_capabilities: {
              id: 'tech_capabilities',
              name: 'Technical Capabilities',
              category: 'Capabilities',
              template: `
                <div class="component-section technical-capabilities">
                  <h2 class="section-header">Technical Capabilities</h2>
                  <div class="capabilities-grid">
                    <div class="core-capabilities">
                      <h3>Core Capabilities</h3>
                      <div class="capability-cards">
                        {core_capabilities_cards}
                      </div>
                    </div>
                    <div class="technology-stack">
                      <h3>Technology Stack</h3>
                      <div class="tech-categories">
                        {technology_categories}
                      </div>
                    </div>
                  </div>
                  <div class="specializations">
                    <h3>Industry Specializations</h3>
                    <div class="industry-tags">
                      {industry_tags}
                    </div>
                  </div>
                </div>
              `,
              style: `
                .technical-capabilities { padding: 30px; background: white; border: 1px solid #e0e0e0; border-radius: 12px; margin-bottom: 30px; }
                .capabilities-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 20px 0; }
                .capability-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
                .capability-card { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; padding: 20px; border-radius: 8px; text-align: center; }
                .tech-categories { space-y: 20px; }
                .tech-category { margin-bottom: 20px; }
                .tech-category h4 { color: #333; margin-bottom: 10px; }
                .tech-tags { display: flex; flex-wrap: wrap; gap: 8px; }
                .tech-tag { background: #e8f5e8; color: #2e7d32; padding: 6px 12px; border-radius: 15px; font-size: 0.85em; }
                .industry-tags { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 15px; }
                .industry-tag { background: #fff3e0; color: #f57c00; padding: 10px 20px; border-radius: 25px; border: 2px solid #ffcc02; }
              `
            },
            team_profiles: {
              id: 'team_profiles',
              name: 'Team Profiles',
              category: 'Team',
              template: `
                <div class="component-section team-profiles">
                  <h2 class="section-header">Our Project Team</h2>
                  <p class="team-intro">Meet the dedicated professionals who will lead your project to success:</p>
                  <div class="team-grid">
                    {team_member_cards}
                  </div>
                  <div class="team-structure">
                    <h3>Project Organization</h3>
                    <div class="org-chart">
                      {organizational_structure}
                    </div>
                  </div>
                </div>
              `,
              style: `
                .team-profiles { padding: 30px; background: #fafafa; border-radius: 12px; margin-bottom: 30px; }
                .team-intro { font-size: 1.1em; color: #666; margin-bottom: 30px; text-align: center; }
                .team-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px; }
                .team-member { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; }
                .member-photo { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8em; font-weight: bold; }
                .member-name { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
                .member-title { color: #666; margin-bottom: 15px; }
                .member-experience { font-weight: bold; color: #333; margin-bottom: 10px; }
                .member-specialties { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 15px; }
                .specialty-tag { background: #e3f2fd; color: #1976d2; padding: 4px 10px; border-radius: 12px; font-size: 0.8em; }
                .member-certs { font-size: 0.9em; color: #666; }
                .org-chart { text-align: center; }
              `
            },
            methodology: {
              id: 'methodology',
              name: 'Project Methodology',
              category: 'Approach',
              template: `
                <div class="component-section methodology">
                  <h2 class="section-header">Our Proven Methodology</h2>
                  <div class="methodology-overview">
                    <p>We employ a {methodology_type} approach tailored to your specific requirements, ensuring {methodology_benefits}.</p>
                  </div>
                  <div class="process-phases">
                    <h3>Project Phases</h3>
                    <div class="phases-timeline">
                      {methodology_phases}
                    </div>
                  </div>
                  <div class="quality-assurance">
                    <h3>Quality Assurance</h3>
                    <div class="qa-practices">
                      {qa_practices}
                    </div>
                  </div>
                  <div class="risk-management">
                    <h3>Risk Management</h3>
                    <div class="risk-strategies">
                      {risk_management_strategies}
                    </div>
                  </div>
                </div>
              `,
              style: `
                .methodology { padding: 30px; background: white; border-left: 5px solid #4caf50; margin-bottom: 30px; }
                .methodology-overview { background: #f1f8e9; padding: 20px; border-radius: 8px; margin-bottom: 25px; }
                .phases-timeline { display: flex; flex-direction: column; gap: 20px; }
                .phase-item { display: flex; align-items: center; padding: 20px; background: #fafafa; border-radius: 8px; border-left: 4px solid #4caf50; }
                .phase-number { background: #4caf50; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 20px; }
                .phase-content h4 { margin-bottom: 10px; color: #2e7d32; }
                .phase-content p { color: #666; line-height: 1.5; }
                .qa-practices, .risk-strategies { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
                .practice-card, .risk-card { background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 3px solid #4caf50; }
                .practice-card h4, .risk-card h4 { color: #2e7d32; margin-bottom: 8px; }
              `
            },
            project_timeline: {
              id: 'project_timeline',
              name: 'Project Timeline',
              category: 'Planning',
              template: `
                <div class="component-section project-timeline">
                  <h2 class="section-header">Project Timeline & Milestones</h2>
                  <div class="timeline-overview">
                    <div class="timeline-summary">
                      <div class="summary-item">
                        <span class="label">Total Duration:</span>
                        <span class="value">{total_duration}</span>
                      </div>
                      <div class="summary-item">
                        <span class="label">Major Milestones:</span>
                        <span class="value">{milestone_count}</span>
                      </div>
                      <div class="summary-item">
                        <span class="label">Go-Live Date:</span>
                        <span class="value">{go_live_date}</span>
                      </div>
                    </div>
                  </div>
                  <div class="timeline-visual">
                    <h3>Project Phases Timeline</h3>
                    <div class="timeline-container">
                      {timeline_phases}
                    </div>
                  </div>
                  <div class="deliverables-schedule">
                    <h3>Key Deliverables Schedule</h3>
                    <div class="deliverables-table">
                      {deliverables_table}
                    </div>
                  </div>
                </div>
              `,
              style: `
                .project-timeline { padding: 30px; background: linear-gradient(to right, #f8f9fa, #ffffff); border-radius: 12px; margin-bottom: 30px; }
                .timeline-summary { display: flex; justify-content: space-around; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 25px; }
                .summary-item { text-align: center; }
                .summary-item .label { display: block; color: #666; font-size: 0.9em; margin-bottom: 5px; }
                .summary-item .value { display: block; font-size: 1.3em; font-weight: bold; color: #333; }
                .timeline-container { position: relative; padding: 20px 0; }
                .timeline-phase { display: flex; align-items: center; margin-bottom: 25px; position: relative; }
                .phase-marker { width: 20px; height: 20px; background: #2196f3; border-radius: 50%; margin-right: 20px; position: relative; z-index: 2; }
                .phase-marker::after { content: ''; position: absolute; top: 20px; left: 9px; width: 2px; height: 40px; background: #e0e0e0; }
                .phase-details { flex: 1; background: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
                .phase-details h4 { color: #2196f3; margin-bottom: 8px; }
                .phase-duration { color: #666; font-size: 0.9em; }
                .deliverables-table { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
              `
            },
            pricing: {
              id: 'pricing',
              name: 'Pricing Structure',
              category: 'Commercial',
              template: `
                <div class="component-section pricing">
                  <h2 class="section-header">Investment & Pricing</h2>
                  <div class="pricing-overview">
                    <div class="total-investment">
                      <h3>Total Project Investment</h3>
                      <div class="price-display">
                        <span class="currency">$</span>
                        <span class="amount">{total_price}</span>
                      </div>
                      <p class="price-note">{pricing_note}</p>
                    </div>
                  </div>
                  <div class="pricing-breakdown">
                    <h3>Cost Breakdown</h3>
                    <div class="breakdown-table">
                      {pricing_breakdown_items}
                    </div>
                  </div>
                  <div class="payment-terms">
                    <h3>Payment Terms</h3>
                    <div class="payment-schedule">
                      {payment_schedule}
                    </div>
                  </div>
                  <div class="value-proposition">
                    <h3>Value Delivered</h3>
                    <div class="value-items">
                      {value_propositions}
                    </div>
                  </div>
                </div>
              `,
              style: `
                .pricing { padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; margin-bottom: 30px; }
                .pricing .section-header { color: white; }
                .total-investment { text-align: center; margin-bottom: 30px; }
                .price-display { font-size: 3em; font-weight: bold; margin: 15px 0; }
                .currency { font-size: 0.6em; vertical-align: top; }
                .price-note { opacity: 0.9; font-style: italic; }
                .breakdown-table { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 20px; margin-bottom: 25px; }
                .breakdown-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.2); }
                .breakdown-item:last-child { border-bottom: none; }
                .payment-schedule { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
                .payment-milestone { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; text-align: center; }
                .value-items { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
                .value-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; }
                .value-item h4 { margin-bottom: 8px; }
              `
            },
            case_studies: {
              id: 'case_studies',
              name: 'Relevant Case Studies',
              category: 'Experience',
              template: `
                <div class="component-section case-studies">
                  <h2 class="section-header">Relevant Project Experience</h2>
                  <div class="case-studies-grid">
                    {case_study_cards}
                  </div>
                  <div class="success-metrics">
                    <h3>Proven Results</h3>
                    <div class="metrics-grid">
                      {success_metrics}
                    </div>
                  </div>
                </div>
              `,
              style: `
                .case-studies { padding: 30px; background: #f5f5f5; border-radius: 12px; margin-bottom: 30px; }
                .case-studies-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 30px; }
                .case-study-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-left: 5px solid #4caf50; }
                .case-study-header { display: flex; justify-content: between; align-items: start; margin-bottom: 15px; }
                .case-client { font-size: 1.2em; font-weight: bold; color: #333; }
                .case-value { background: #e8f5e8; color: #2e7d32; padding: 5px 10px; border-radius: 15px; font-size: 0.9em; }
                .case-project { color: #666; margin-bottom: 15px; font-style: italic; }
                .case-description { line-height: 1.6; margin-bottom: 15px; }
                .case-technologies { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
                .tech-badge { background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 10px; font-size: 0.8em; }
                .case-outcome { background: #f1f8e9; padding: 15px; border-radius: 8px; border-left: 3px solid #4caf50; }
                .outcome-label { font-weight: bold; color: #2e7d32; margin-bottom: 5px; }
                .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
                .metric-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                .metric-number { font-size: 2.5em; font-weight: bold; color: #4caf50; margin-bottom: 10px; }
                .metric-label { color: #666; font-size: 0.9em; }
              `
            },
            references: {
              id: 'references',
              name: 'Client References',
              category: 'References',
              template: `
                <div class="component-section references">
                  <h2 class="section-header">Client References</h2>
                  <div class="references-intro">
                    <p>We're proud of the relationships we've built with our clients. Here are references who can speak to our capabilities and service quality:</p>
                  </div>
                  <div class="references-grid">
                    {reference_cards}
                  </div>
                  <div class="testimonials">
                    <h3>Client Testimonials</h3>
                    <div class="testimonials-carousel">
                      {testimonials}
                    </div>
                  </div>
                </div>
              `,
              style: `
                .references { padding: 30px; background: white; border: 1px solid #e0e0e0; border-radius: 12px; margin-bottom: 30px; }
                .references-intro { text-align: center; color: #666; margin-bottom: 30px; font-size: 1.1em; }
                .references-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px; }
                .reference-card { background: #fafafa; padding: 25px; border-radius: 12px; border: 1px solid #e0e0e0; }
                .reference-header { margin-bottom: 15px; }
                .reference-name { font-size: 1.2em; font-weight: bold; color: #333; margin-bottom: 5px; }
                .reference-title { color: #666; margin-bottom: 3px; }
                .reference-company { color: #2196f3; font-weight: bold; }
                .reference-contact { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px; }
                .contact-label { font-size: 0.9em; color: #666; margin-bottom: 5px; }
                .contact-info { color: #333; }
                .testimonials-carousel { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
                .testimonial { background: #f8f9fa; padding: 25px; border-radius: 12px; border-left: 5px solid #4caf50; position: relative; }
                .testimonial-quote { font-style: italic; font-size: 1.1em; line-height: 1.6; color: #333; margin-bottom: 15px; }
                .testimonial-quote::before { content: '"'; font-size: 2em; color: #4caf50; position: absolute; top: 10px; left: 15px; }
                .testimonial-author { font-weight: bold; color: #666; }
              `
            },
            appendices: {
              id: 'appendices',
              name: 'Appendices & Supporting Documents',
              category: 'Supporting',
              template: `
                <div class="component-section appendices">
                  <h2 class="section-header">Appendices & Supporting Documentation</h2>
                  <div class="appendices-grid">
                    <div class="technical-docs">
                      <h3>Technical Documentation</h3>
                      <div class="doc-list">
                        {technical_documents}
                      </div>
                    </div>
                    <div class="compliance-docs">
                      <h3>Compliance & Certifications</h3>
                      <div class="doc-list">
                        {compliance_documents}
                      </div>
                    </div>
                    <div class="legal-docs">
                      <h3>Legal & Contractual</h3>
                      <div class="doc-list">
                        {legal_documents}
                      </div>
                    </div>
                    <div class="additional-info">
                      <h3>Additional Information</h3>
                      <div class="doc-list">
                        {additional_documents}
                      </div>
                    </div>
                  </div>
                </div>
              `,
              style: `
                .appendices { padding: 30px; background: #f8f9fa; border-radius: 12px; margin-bottom: 30px; }
                .appendices-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
                .doc-list { space-y: 10px; }
                .doc-item { display: flex; align-items: center; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e0e0e0; margin-bottom: 10px; }
                .doc-icon { width: 40px; height: 40px; background: #e3f2fd; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px; color: #1976d2; font-weight: bold; }
                .doc-info h4 { margin-bottom: 3px; color: #333; }
                .doc-description { font-size: 0.9em; color: #666; }
              `
            }
          },
          modular_components: [
            {
              id: 'methodology_agile',
              name: 'Agile Methodology',
              type: 'methodology',
              category: 'development',
              template: `## Development Methodology

### Agile Development Approach
Our proven Agile methodology ensures rapid delivery and continuous client collaboration:

#### Sprint Planning ({{sprint_duration}} weeks)
- Requirements analysis and user story creation
- Sprint backlog prioritization
- Capacity planning and resource allocation

#### Development Cycles
- Daily standups and progress tracking
- Continuous integration and testing
- Regular client demos and feedback integration

#### Quality Assurance
- Test-driven development (TDD)
- Automated testing pipelines
- Code reviews and pair programming

#### Delivery Framework
- {{delivery_frequency}} releases
- Continuous deployment to {{environment_type}}
- Performance monitoring and optimization

### Risk Mitigation
- {{risk_mitigation_strategy}}
- Regular retrospectives and process improvement
- Flexible resource allocation and timeline adjustments`,
              variables: ['sprint_duration', 'delivery_frequency', 'environment_type', 'risk_mitigation_strategy'],
              style: {
                heading_style: 'bold',
                bullet_style: 'dash',
                emphasis: 'italic'
              },
              created: new Date().toISOString()
            },
            {
              id: 'methodology_waterfall',
              name: 'Waterfall Methodology',
              type: 'methodology',
              category: 'traditional',
              template: `## Project Methodology

### Structured Waterfall Approach
Our systematic waterfall methodology ensures comprehensive planning and controlled execution:

#### Phase 1: Requirements Analysis ({{phase1_duration}})
- Comprehensive requirements gathering
- Stakeholder interviews and documentation
- Technical specification development

#### Phase 2: System Design ({{phase2_duration}})
- Architecture design and documentation
- Database design and modeling
- Interface and integration planning

#### Phase 3: Implementation ({{phase3_duration}})
- Development according to specifications
- Code documentation and version control
- Progressive system integration

#### Phase 4: Testing ({{phase4_duration}})
- Unit testing and system testing
- User acceptance testing (UAT)
- Performance and security testing

#### Phase 5: Deployment ({{phase5_duration}})
- Production deployment and configuration
- Training and documentation delivery
- Go-live support and monitoring

### Quality Gates
Each phase includes formal review and approval processes to ensure deliverable quality and client satisfaction.`,
              variables: ['phase1_duration', 'phase2_duration', 'phase3_duration', 'phase4_duration', 'phase5_duration'],
              style: {
                heading_style: 'bold',
                bullet_style: 'number',
                emphasis: 'bold'
              },
              created: new Date().toISOString()
            },
            {
              id: 'sow_embedded_software',
              name: 'Embedded SOW - Software Development',
              type: 'sow_embedded',
              category: 'software',
              template: `## Statement of Work

### Project Scope
This Statement of Work defines the deliverables, timeline, and responsibilities for {{project_title}}.

#### Deliverables
1. **{{deliverable_1}}** - {{deliverable_1_description}}
2. **{{deliverable_2}}** - {{deliverable_2_description}}
3. **{{deliverable_3}}** - {{deliverable_3_description}}

#### Timeline
- **Project Start**: {{start_date}}
- **Milestone 1**: {{milestone_1_date}} - {{milestone_1_deliverable}}
- **Milestone 2**: {{milestone_2_date}} - {{milestone_2_deliverable}}
- **Project Completion**: {{end_date}}

#### Pricing Structure
- **Total Project Cost**: ${{total_cost}}
- **Payment Schedule**: {{payment_schedule}}
- **Additional Services**: {{additional_services_rate}}/hour

#### Client Responsibilities
- {{client_responsibility_1}}
- {{client_responsibility_2}}
- {{client_responsibility_3}}

#### Contractor Responsibilities
- {{contractor_responsibility_1}}
- {{contractor_responsibility_2}}
- {{contractor_responsibility_3}}

### Change Management
Any changes to scope will be documented through formal change requests with impact analysis on timeline and budget.`,
              variables: ['project_title', 'deliverable_1', 'deliverable_1_description', 'deliverable_2', 'deliverable_2_description', 'deliverable_3', 'deliverable_3_description', 'start_date', 'milestone_1_date', 'milestone_1_deliverable', 'milestone_2_date', 'milestone_2_deliverable', 'end_date', 'total_cost', 'payment_schedule', 'additional_services_rate', 'client_responsibility_1', 'client_responsibility_2', 'client_responsibility_3', 'contractor_responsibility_1', 'contractor_responsibility_2', 'contractor_responsibility_3'],
              style: {
                heading_style: 'bold',
                bullet_style: 'number',
                emphasis: 'bold'
              },
              created: new Date().toISOString()
            },
            {
              id: 'risk_management_standard',
              name: 'Risk Management Framework',
              type: 'risk_management',
              category: 'management',
              template: `## Risk Management

### Risk Assessment Framework
Our comprehensive risk management approach identifies, analyzes, and mitigates potential project risks:

#### Technical Risks
- **{{technical_risk_1}}**: {{technical_risk_1_mitigation}}
- **{{technical_risk_2}}**: {{technical_risk_2_mitigation}}
- **Integration Complexity**: Managed through {{integration_strategy}}

#### Schedule Risks
- **Resource Availability**: {{resource_risk_mitigation}}
- **Scope Creep**: Controlled through {{scope_management_process}}
- **Dependencies**: Tracked via {{dependency_management_tool}}

#### Business Risks
- **Budget Overruns**: Prevented through {{budget_control_mechanism}}
- **Stakeholder Changes**: Managed via {{stakeholder_management_plan}}
- **Market Changes**: Addressed through {{market_risk_strategy}}

### Mitigation Strategies
- Weekly risk assessment reviews
- Proactive communication and escalation procedures
- Contingency planning for critical path activities
- Regular stakeholder updates and decision checkpoints`,
              variables: ['technical_risk_1', 'technical_risk_1_mitigation', 'technical_risk_2', 'technical_risk_2_mitigation', 'integration_strategy', 'resource_risk_mitigation', 'scope_management_process', 'dependency_management_tool', 'budget_control_mechanism', 'stakeholder_management_plan', 'market_risk_strategy'],
              style: {
                heading_style: 'bold',
                bullet_style: 'dash',
                emphasis: 'italic'
              },
              created: new Date().toISOString()
            },
            {
              id: 'quality_assurance_comprehensive',
              name: 'Quality Assurance Framework',
              type: 'quality_assurance',
              category: 'quality',
              template: `## Quality Assurance

### Quality Management System
Our comprehensive QA framework ensures consistent, high-quality deliverables throughout the project lifecycle:

#### Testing Strategy
- **Unit Testing**: {{unit_test_coverage}}% code coverage minimum
- **Integration Testing**: {{integration_test_approach}}
- **System Testing**: {{system_test_methodology}}
- **User Acceptance Testing**: {{uat_process}}

#### Code Quality Standards
- **Coding Standards**: {{coding_standards_framework}}
- **Code Reviews**: {{code_review_process}}
- **Documentation**: {{documentation_standards}}
- **Version Control**: {{version_control_strategy}}

#### Performance Standards
- **Response Time**: {{response_time_requirement}}
- **Throughput**: {{throughput_requirement}}
- **Availability**: {{availability_requirement}}
- **Scalability**: {{scalability_requirement}}

#### Quality Metrics
- Defect density tracking
- Test coverage reporting
- Performance benchmarking
- Client satisfaction scoring

### Deliverable Review Process
All deliverables undergo multi-stage review including peer review, technical review, and client approval before release.`,
              variables: ['unit_test_coverage', 'integration_test_approach', 'system_test_methodology', 'uat_process', 'coding_standards_framework', 'code_review_process', 'documentation_standards', 'version_control_strategy', 'response_time_requirement', 'throughput_requirement', 'availability_requirement', 'scalability_requirement'],
              style: {
                heading_style: 'bold',
                bullet_style: 'dash',
                emphasis: 'bold'
              },
              created: new Date().toISOString()
            }
          ],
          document_styles: [
            {
              id: 'corporate_style_1',
              name: 'Corporate Professional',
              style: {
                font_family: 'Arial, sans-serif',
                heading_color: '#2c3e50',
                text_color: '#34495e',
                accent_color: '#3498db',
                spacing: 'standard',
                bullet_style: 'bullet',
                number_style: 'decimal',
                emphasis_style: 'bold',
                quote_style: 'italic',
                header_format: 'title_case',
                page_margins: 'standard'
              },
              css_template: `
.document { 
  font-family: Arial, sans-serif; 
  color: #34495e; 
  line-height: 1.6; 
}
h1, h2, h3 { 
  color: #2c3e50; 
  font-weight: bold; 
}
.accent { 
  color: #3498db; 
}
ul { 
  list-style-type: disc; 
}
ol { 
  list-style-type: decimal; 
}
strong { 
  font-weight: bold; 
}
em { 
  font-style: italic; 
}`,
              created: new Date().toISOString()
            },
            {
              id: 'modern_style_1',
              name: 'Modern Minimal',
              style: {
                font_family: 'Helvetica, sans-serif',
                heading_color: '#1a1a1a',
                text_color: '#4a4a4a',
                accent_color: '#ff6b6b',
                spacing: 'wide',
                bullet_style: 'dash',
                number_style: 'roman',
                emphasis_style: 'italic',
                quote_style: 'bold',
                header_format: 'sentence_case',
                page_margins: 'wide'
              },
              css_template: `
.document { 
  font-family: Helvetica, sans-serif; 
  color: #4a4a4a; 
  line-height: 1.8; 
}
h1, h2, h3 { 
  color: #1a1a1a; 
  font-weight: 300; 
}
.accent { 
  color: #ff6b6b; 
}
ul { 
  list-style-type: none; 
}
ul li:before { 
  content: "—"; 
  margin-right: 10px; 
}`,
              created: new Date().toISOString()
            }
          ]
        };
      }
      
      static displayTemplates(templates) {
        const templatesContainer = document.getElementById('templates-list');
        if (templatesContainer) {
          templatesContainer.innerHTML = templates.map(template => `
            <div class="col-md-6 col-lg-4 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title">${template.name}</h6>
                    <span class="badge ${this.getCategoryColor(template.category)}">${template.category}</span>
                  </div>
                  <p class="card-text text-muted small">${template.subject}</p>
                  <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-sm btn-primary" onclick="TemplateManager.useTemplate(${template.id})">
                      <i class="fas fa-paper-plane"></i> Use
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="TemplateManager.editTemplate(${template.id})">
                      <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="TemplateManager.deleteTemplate(${template.id})">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `).join('');
        }
      }

      static getCategoryColor(category) {
        const colors = {
          'outreach': 'bg-primary',
          'follow-up': 'bg-success',
          'rfp': 'bg-warning',
          'proposal': 'bg-info',
          'meeting': 'bg-secondary',
          'thank-you': 'bg-light'
        };
        return colors[category] || 'bg-secondary';
      }

      static async saveTemplate() {
        const name = document.getElementById('template-name').value;
        const subject = document.getElementById('template-subject').value;
        const category = document.getElementById('template-category').value;
        const body = document.getElementById('template-body').value;

        if (!name || !subject || !body) {
          Utils.showNotification('Please fill in all required fields', 'warning');
          return;
        }

        const template = {
          id: Date.now(),
          name,
          subject,
          category,
          body,
          created: new Date().toISOString()
        };

        // Save to local storage
        const savedTemplates = localStorage.getItem('email_templates');
        const templates = savedTemplates ? JSON.parse(savedTemplates) : [];
        templates.push(template);
        localStorage.setItem('email_templates', JSON.stringify(templates));

        // Close modal and refresh display
        const modal = bootstrap.Modal.getInstance(document.getElementById('createTemplateModal'));
        modal.hide();
        document.getElementById('createTemplateForm').reset();
        
        this.loadTemplates();
        Utils.showNotification('Template saved successfully!', 'success');
      }

      static useTemplate(templateId) {
        Utils.showNotification('Template usage feature coming soon!', 'info');
      }

      static editTemplate(templateId) {
        Utils.showNotification('Template editing feature coming soon!', 'info');
      }

      static deleteTemplate(templateId) {
        if (confirm('Are you sure you want to delete this template?')) {
          const savedTemplates = localStorage.getItem('email_templates');
          if (savedTemplates) {
            const templates = JSON.parse(savedTemplates);
            const filteredTemplates = templates.filter(t => t.id !== templateId);
            localStorage.setItem('email_templates', JSON.stringify(filteredTemplates));
            this.loadTemplates();
            Utils.showNotification('Template deleted successfully!', 'success');
          }
        }
      }
      
      static getTemplate(category, templateId) {
        if (!this.templates[category]) {
          return null;
        }
        return this.templates[category].find(template => template.id === templateId);
      }
      
      static processTemplate(templateData, variables, outputFormat = 'markdown') {
        try {
          let content = templateData.content || templateData.template || '';
          
          // Replace variables in template
          for (const [key, value] of Object.entries(variables)) {
            const regex = new RegExp(`{{${key}}}`, 'g');
            content = content.replace(regex, value);
          }
          
          // Format output based on requested format
          switch (outputFormat) {
            case 'html':
              content = content.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
              break;
            case 'pdf':
              // Add PDF-specific formatting
              content = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
        h1, h2, h3 { color: #333; }
        .header { border-bottom: 2px solid #333; padding-bottom: 20px; }
    </style>
</head>
<body>
${content.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
</body>
</html>`;
              break;
            case 'docx':
              // Add DOCX-compatible formatting
              content = content.replace(/\*\*(.*?)\*\*/g, '<w:b>$1</w:b>');
              break;
          }
          
          return {
            success: true,
            content: content,
            format: outputFormat
          };
        } catch (error) {
          return {
            success: false,
            error: error.message
          };
        }
      }
      
      static async generateContentWithLLM(templateData, variables, outputFormat = 'markdown') {
        try {
          // First process template normally
          const baseContent = this.processTemplate(templateData, variables, outputFormat);
          
          if (!baseContent.success) {
            return baseContent;
          }
          
          // Enhance with LLM
          const prompt = `Please enhance and improve the following ${templateData.type || 'document'} content:

${baseContent.content}

Please:
1. Improve the language and flow
2. Add professional details where appropriate
3. Ensure the content is comprehensive and well-structured
4. Maintain the original format and variables
5. Return in ${outputFormat} format`;

          const response = await Utils.apiCall('/api/llm/generate', {
            method: 'POST',
            body: JSON.stringify({
              prompt: prompt,
              max_tokens: 2000,
              temperature: 0.7
            })
          });
          
          if (response.success && response.data && response.data.content) {
            return {
              success: true,
              content: response.data.content,
              format: outputFormat,
              enhanced_with_llm: true
            };
          } else {
            // Fallback to template-only processing
            return baseContent;
          }
        } catch (error) {
          console.error('LLM enhancement failed:', error);
          // Fallback to template-only processing
          return this.processTemplate(templateData, variables, outputFormat);
        }
      }
      
      static getModularComponents(type = null) {
        const components = this.templates.modular_components || [];
        return type ? components.filter(comp => comp.type === type) : components;
      }
      
      static showModularComponentSelector() {
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.innerHTML = `
          <div class="modal-dialog modal-xl">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Select Modular Components</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-3">
                    <h6>Component Types</h6>
                    <div class="list-group" id="component-types">
                      <button class="list-group-item list-group-item-action active" data-type="all">All Components</button>
                      <button class="list-group-item list-group-item-action" data-type="methodology">Methodology</button>
                      <button class="list-group-item list-group-item-action" data-type="sow_embedded">Embedded SOW</button>
                      <button class="list-group-item list-group-item-action" data-type="risk_management">Risk Management</button>
                      <button class="list-group-item list-group-item-action" data-type="quality_assurance">Quality Assurance</button>
                    </div>
                  </div>
                  <div class="col-md-9">
                    <h6>Available Components</h6>
                    <div id="modular-components-list" class="row">
                      <!-- Components will be loaded here -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="TemplateManager.applySelectedComponents()">Apply Components</button>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
        
        // Load components
        this.loadModularComponents('all');
        
        // Setup type filtering
        modal.querySelectorAll('[data-type]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            modal.querySelectorAll('[data-type]').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.loadModularComponents(e.target.dataset.type);
          });
        });
        
        modal.addEventListener('hidden.bs.modal', () => {
          document.body.removeChild(modal);
        });
      }
      
      static loadModularComponents(type) {
        const container = document.getElementById('modular-components-list');
        const components = this.getModularComponents(type === 'all' ? null : type);
        
        container.innerHTML = components.map(comp => `
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="${comp.id}" id="comp_${comp.id}">
                  <label class="form-check-label" for="comp_${comp.id}">
                    <h6 class="card-title">${comp.name}</h6>
                  </label>
                </div>
                <span class="badge bg-secondary">${comp.type}</span>
                <span class="badge bg-info">${comp.category}</span>
                <p class="card-text small mt-2">${comp.template.substring(0, 100)}...</p>
                <button class="btn btn-sm btn-outline-primary" onclick="TemplateManager.previewComponent('${comp.id}')">
                  <i class="fas fa-eye"></i> Preview
                </button>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      static previewComponent(componentId) {
        const component = this.templates.modular_components.find(c => c.id === componentId);
        if (!component) return;
        
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.innerHTML = `
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Preview: ${component.name}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <span class="badge bg-secondary">${component.type}</span>
                  <span class="badge bg-info">${component.category}</span>
                </div>
                <pre class="bg-light p-3 rounded" style="white-space: pre-wrap;">${component.template}</pre>
                <div class="mt-3">
                  <h6>Variables:</h6>
                  <div class="d-flex flex-wrap gap-1">
                    ${component.variables.map(v => `<span class="badge bg-warning">${v}</span>`).join('')}
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
        
        modal.addEventListener('hidden.bs.modal', () => {
          document.body.removeChild(modal);
        });
      }
      
      static async generateComponentFromTemplate(componentId, rfpContext = {}) {
        try {
          // Call backend API to generate component
          const response = await Utils.apiCall(`${API_CONFIG.ENDPOINTS.COMPONENTS}/${componentId}/generate`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ rfp_context: rfpContext })
          });

          if (response.success && response.data) {
            return `
              <style>${response.data.style || ''}</style>
              ${response.data.template || response.data.content || ''}
            `;
          } else {
            console.error('Component generation failed:', response.error);
            return '<div class="error">Failed to generate component</div>';
          }
        } catch (error) {
          console.error('Error generating component:', error);
          
          // Fallback to local generation
          return this.generateComponentFromTemplateLocal(componentId, rfpContext);
        }
      }

      static generateComponentFromTemplateLocal(componentId, rfpContext = {}) {
        // Fallback local generation for when backend is not available
        const companyData = this.getCompanyProfile();
        
        const templates = {
          'executive_summary': {
            content: `
              <div class="component-section executive-summary">
                <h2 class="section-header">Executive Summary</h2>
                <div class="company-intro">
                  <h3>${companyData.name}</h3>
                  <p class="tagline">${companyData.tagline}</p>
                  <div class="company-stats">
                    <span class="stat">Founded: ${companyData.founded_year}</span>
                    <span class="stat">Employees: ${companyData.employees}</span>
                    <span class="stat">Revenue: ${companyData.annual_revenue}</span>
                  </div>
                </div>
                <div class="value-proposition">
                  <p>We understand your need for ${rfpContext.objective || 'innovative technology solutions'} and are uniquely positioned to deliver exceptional results through our proven expertise.</p>
                </div>
              </div>
            `,
            style: `
              .executive-summary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; }
              .executive-summary .section-header { color: white; font-size: 2.2em; margin-bottom: 20px; }
              .company-intro h3 { font-size: 1.8em; margin-bottom: 5px; }
              .tagline { font-style: italic; opacity: 0.9; margin-bottom: 15px; }
              .company-stats { display: flex; gap: 20px; margin-bottom: 20px; }
              .stat { background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9em; }
            `
          }
        };

        const template = templates[componentId];
        if (template) {
          return `<style>${template.style}</style>${template.content}`;
        } else {
          return '<div class="error">Component template not found</div>';
        }
      }

      static generateDifferentiatorsList(differentiators) {
        return differentiators.map(item => `<li>${item}</li>`).join('');
      }

      static generateCertificationsBadges(certifications) {
        return certifications.map(cert => 
          `<span class="cert-badge">${cert}</span>`
        ).join('');
      }

      static generateAwardsList(awards) {
        return awards.map(award => `<li>${award}</li>`).join('');
      }

      static generateCapabilityCards(capabilities) {
        return capabilities.map(capability => 
          `<div class="capability-card">
            <h4>${capability}</h4>
          </div>`
        ).join('');
      }

      static generateTechnologyCategories(technologies) {
        return Object.keys(technologies).map(category => 
          `<div class="tech-category">
            <h4>${category}</h4>
            <div class="tech-tags">
              ${technologies[category].map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
            </div>
          </div>`
        ).join('');
      }

      static generateIndustryTags(industries) {
        return industries.map(industry => 
          `<span class="industry-tag">${industry}</span>`
        ).join('');
      }

      static generateTeamMemberCards(teamMembers) {
        return teamMembers.map(member => {
          const initials = member.name.split(' ').map(n => n[0]).join('');
          return `
            <div class="team-member">
              <div class="member-photo">${initials}</div>
              <div class="member-name">${member.name}</div>
              <div class="member-title">${member.title}</div>
              <div class="member-experience">${member.experience}</div>
              <div class="member-specialties">
                ${member.specialties.map(spec => `<span class="specialty-tag">${spec}</span>`).join('')}
              </div>
              <div class="member-certs">
                Certifications: ${member.certifications.join(', ')}
              </div>
            </div>
          `;
        }).join('');
      }

      static generateCaseStudyCards(projects) {
        return projects.map(project => 
          `<div class="case-study-card">
            <div class="case-study-header">
              <div class="case-client">${project.client}</div>
              <div class="case-value">${project.value}</div>
            </div>
            <div class="case-project">${project.project}</div>
            <div class="case-description">
              ${project.duration} project delivering comprehensive ${project.project.toLowerCase()} solution.
            </div>
            <div class="case-technologies">
              ${project.technologies.map(tech => `<span class="tech-badge">${tech}</span>`).join('')}
            </div>
            <div class="case-outcome">
              <div class="outcome-label">Results Achieved:</div>
              <div>${project.outcome}</div>
            </div>
          </div>`
        ).join('');
      }

      static generateSuccessMetrics(projects) {
        const metrics = [
          { number: '200+', label: 'Projects Completed' },
          { number: '99.9%', label: 'Uptime Achieved' },
          { number: '85%', label: 'Avg. Performance Improvement' },
          { number: '100%', label: 'Client Satisfaction' }
        ];
        
        return metrics.map(metric => 
          `<div class="metric-card">
            <div class="metric-number">${metric.number}</div>
            <div class="metric-label">${metric.label}</div>
          </div>`
        ).join('');
      }

      static getCompanyProfile() {
        return this.getTemplateDefaults().company_profile;
      }

      static showDocumentUploadForStyleExtraction() {
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.innerHTML = `
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Upload Document for Style Extraction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label class="form-label">Upload Document</label>
                  <input type="file" class="form-control" id="style-document-upload" accept=".pdf,.docx,.html,.txt">
                  <div class="form-text">Supported formats: PDF, DOCX, HTML, TXT</div>
                </div>
                
                <div class="mb-3">
                  <label class="form-label">Template Name</label>
                  <input type="text" class="form-control" id="style-template-name" placeholder="e.g., Corporate Brand Style">
                </div>
                
                <div class="mb-3">
                  <label class="form-label">Style Category</label>
                  <select class="form-select" id="style-category">
                    <option value="corporate">Corporate</option>
                    <option value="modern">Modern</option>
                    <option value="academic">Academic</option>
                    <option value="creative">Creative</option>
                    <option value="government">Government</option>
                  </select>
                </div>
                
                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="extract-formatting" checked>
                    <label class="form-check-label" for="extract-formatting">
                      Extract formatting styles (headings, fonts, colors)
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="extract-structure" checked>
                    <label class="form-check-label" for="extract-structure">
                      Extract document structure (sections, layout)
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="extract-language" checked>
                    <label class="form-check-label" for="extract-language">
                      Extract language patterns and tone
                    </label>
                  </div>
                </div>
                
                <div id="upload-progress" class="d-none">
                  <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                  </div>
                  <div class="mt-2 text-muted">Processing document...</div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="TemplateManager.uploadAndExtractStyle()">
                  <i class="fas fa-upload"></i> Upload & Extract Style
                </button>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
        
        modal.addEventListener('hidden.bs.modal', () => {
          document.body.removeChild(modal);
        });
      }
      
      static async uploadAndExtractStyle() {
        const fileInput = document.getElementById('style-document-upload');
        const templateName = document.getElementById('style-template-name').value;
        const category = document.getElementById('style-category').value;
        const extractFormatting = document.getElementById('extract-formatting').checked;
        const extractStructure = document.getElementById('extract-structure').checked;
        const extractLanguage = document.getElementById('extract-language').checked;
        
        if (!fileInput.files[0] || !templateName) {
          Utils.showNotification('Please select a file and provide a template name', 'error');
          return;
        }
        
        const progressContainer = document.getElementById('upload-progress');
        const progressBar = progressContainer.querySelector('.progress-bar');
        progressContainer.classList.remove('d-none');
        progressBar.style.width = '10%';
        
        try {
          const file = fileInput.files[0];
          const formData = new FormData();
          formData.append('document', file);
          formData.append('template_name', templateName);
          formData.append('category', category);
          formData.append('extract_formatting', extractFormatting);
          formData.append('extract_structure', extractStructure);
          formData.append('extract_language', extractLanguage);
          
          progressBar.style.width = '30%';
          
          // Simulate style extraction (in real implementation, this would call an API)
          await new Promise(resolve => setTimeout(resolve, 2000));
          progressBar.style.width = '70%';
          
          // Extract basic style information
          const extractedStyle = {
            id: 'extracted_' + Date.now(),
            name: templateName,
            category: category,
            source_document: file.name,
            style: {
              font_family: 'Arial, sans-serif', // Would be extracted from document
              heading_color: '#2c3e50',
              text_color: '#34495e',
              accent_color: '#3498db',
              spacing: 'standard',
              bullet_style: 'bullet',
              number_style: 'decimal',
              emphasis_style: 'bold',
              quote_style: 'italic',
              header_format: 'title_case',
              page_margins: 'standard'
            },
            css_template: `.document { 
  font-family: Arial, sans-serif; 
  color: #34495e; 
  line-height: 1.6; 
}
h1, h2, h3 { 
  color: #2c3e50; 
  font-weight: bold; 
}
.accent { 
  color: #3498db; 
}`,
            extraction_settings: {
              formatting: extractFormatting,
              structure: extractStructure,
              language: extractLanguage
            },
            created: new Date().toISOString()
          };
          
          progressBar.style.width = '90%';
          
          // Save extracted style
          if (!this.templates.document_styles) {
            this.templates.document_styles = [];
          }
          this.templates.document_styles.push(extractedStyle);
          this.saveTemplates();
          
          progressBar.style.width = '100%';
          
          Utils.showNotification('Style template "' + templateName + '" created successfully!', 'success');
          
          setTimeout(() => {
            bootstrap.Modal.getInstance(document.querySelector('.modal')).hide();
          }, 1000);
          
        } catch (error) {
          console.error('Error extracting style:', error);
          Utils.showNotification('Error extracting style from document', 'error');
          progressContainer.classList.add('d-none');
        }
      }
      
      static getDocumentStyles() {
        return this.templates.document_styles || [];
      }
      
      static applyStyleToTemplate(templateId, styleId) {
        const style = this.templates.document_styles.find(s => s.id === styleId);
        if (!style) return false;
        
        // Apply style to template (implementation would depend on template structure)
        Utils.showNotification('Style "' + style.name + '" applied to template', 'success');
        return true;
      }
      
      static loadAllTemplateGrids() {
        this.loadRFPTemplatesGrid();
        this.loadSOWTemplatesGrid();
        this.loadModularComponentsGrid();
        this.loadDocumentStylesGrid();
        this.loadEmailTemplatesGrid();
      }
      
      static loadRFPTemplatesGrid() {
        const container = document.getElementById('rfp-templates-grid');
        if (!container) return;
        
        const rfpTemplates = this.templates.rfp_responses || [];
        container.innerHTML = rfpTemplates.map(template => `
          <div class="col-md-6 col-lg-4 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="card-title">${template.name}</h6>
                  <span class="badge bg-primary">${template.type}</span>
                </div>
                <p class="card-text text-muted small">
                  ${template.modular ? '<i class="fas fa-puzzle-piece text-success"></i> Modular' : '<i class="fas fa-file-alt text-info"></i> Standard'}
                  • ${template.available_sections ? template.available_sections.length + ' sections' : 'Complete template'}
                </p>
                <div class="d-flex gap-2 flex-wrap">
                  <button class="btn btn-sm btn-primary" onclick="TemplateManager.useRFPTemplate('${template.id}')">
                    <i class="fas fa-magic"></i> Use
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" onclick="TemplateManager.editTemplate('${template.id}')">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="btn btn-sm btn-outline-info" onclick="TemplateManager.previewRFPTemplate('${template.id}')">
                    <i class="fas fa-eye"></i> Preview
                  </button>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      static loadSOWTemplatesGrid() {
        const container = document.getElementById('sow-templates-grid');
        if (!container) return;
        
        const sowTemplates = this.templates.sow_templates || [];
        container.innerHTML = sowTemplates.map(template => `
          <div class="col-md-6 col-lg-4 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="card-title">${template.name}</h6>
                  <span class="badge bg-success">${template.type}</span>
                </div>
                <p class="card-text text-muted small">${template.template.substring(0, 100)}...</p>
                <div class="d-flex gap-2 flex-wrap">
                  <button class="btn btn-sm btn-success" onclick="TemplateManager.useSOWTemplate('${template.id}')">
                    <i class="fas fa-file-contract"></i> Use
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" onclick="TemplateManager.editTemplate('${template.id}')">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      static loadModularComponentsGrid() {
        const container = document.getElementById('modular-components-grid');
        if (!container) return;
        
        const templates = this.getTemplateDefaults();
        const components = templates.component_templates || {};
        
        let html = '<div class="components-overview mb-4">';
        html += '<h5>Component Templates</h5>';
        html += '<p class="text-muted">Pre-built components populated with your company data and capabilities:</p>';
        html += '</div>';
        
        // Group components by category
        const componentsByCategory = {};
        Object.keys(components).forEach(key => {
          const component = components[key];
          const category = component.category || 'Other';
          if (!componentsByCategory[category]) {
            componentsByCategory[category] = [];
          }
          componentsByCategory[category].push({key, ...component});
        });
        
        // Render each category
        Object.keys(componentsByCategory).forEach(category => {
          html += `
            <div class="component-category mb-4">
              <h6 class="category-header text-primary mb-3">
                <i class="fas fa-folder-open"></i> ${category.charAt(0).toUpperCase() + category.slice(1)}
              </h6>
              <div class="row">
          `;
          
          componentsByCategory[category].forEach(component => {
            html += `
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="card h-100 component-card" data-component="${component.key}">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <h6 class="card-title">${component.name}</h6>
                      <span class="badge bg-primary">${component.category}</span>
                    </div>
                    <p class="card-text text-muted small mb-3">
                      Auto-generated from company profile including capabilities, team profiles, and project history.
                    </p>
                    <div class="component-features mb-3">
                      <span class="badge bg-success me-1">Dynamic Content</span>
                      <span class="badge bg-info me-1">Styled</span>
                      <span class="badge bg-warning">Company Data</span>
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                      <button class="btn btn-sm btn-primary" onclick="TemplateManager.addComponentToRFP('${component.key}')">
                        <i class="fas fa-plus"></i> Add to RFP
                      </button>
                      <button class="btn btn-sm btn-outline-secondary" onclick="TemplateManager.previewComponent('${component.key}')">
                        <i class="fas fa-eye"></i> Preview
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            `;
          });
          
          html += '</div></div>';
        });
        
        container.innerHTML = html;
        
        // Add component preview modal if it doesn't exist
        if (!document.getElementById('componentPreviewModal')) {
          const modalHtml = `
            <div class="modal fade" id="componentPreviewModal" tabindex="-1">
              <div class="modal-dialog modal-xl">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Component Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    <div id="componentPreviewContent" style="max-height: 70vh; overflow-y: auto;"></div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="addPreviewedComponent">Add to RFP</button>
                  </div>
                </div>
              </div>
            </div>
          `;
          document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
      }

      static previewComponent(componentId) {
        const generatedContent = this.generateComponentFromTemplate(componentId);
        const previewContent = document.getElementById('componentPreviewContent');
        previewContent.innerHTML = generatedContent;
        
        // Store current component for "Add to RFP" button
        document.getElementById('addPreviewedComponent').setAttribute('data-component', componentId);
        document.getElementById('addPreviewedComponent').onclick = () => {
          this.addComponentToRFP(componentId);
        };
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('componentPreviewModal'));
        modal.show();
      }

      static addComponentToRFP(componentId) {
        // Get current RFP editor content
        const editor = tinymce.get('rfpEditor');
        if (editor) {
          const generatedContent = this.generateComponentFromTemplate(componentId);
          // Remove style tags for editor insertion and clean up the HTML
          let contentOnly = generatedContent.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '');
          contentOnly = contentOnly.replace(/class="[^"]*"/g, ''); // Remove class attributes for clean insertion
          
          editor.insertContent(contentOnly);
          
          // Show success message
          this.showNotification('Component added to RFP successfully!', 'success');
          
          // Close modal if open
          const modal = bootstrap.Modal.getInstance(document.getElementById('componentPreviewModal'));
          if (modal) {
            modal.hide();
          }
        } else {
          this.showNotification('Please open the RFP editor first', 'warning');
        }
      }

      static showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // Auto-remove after 3 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 3000);
      }
      
      static loadDocumentStylesGrid() {
        const container = document.getElementById('document-styles-grid');
        if (!container) return;
        
        const styles = this.templates.document_styles || [];
        container.innerHTML = styles.map(style => `
          <div class="col-md-6 col-lg-4 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="card-title">${style.name}</h6>
                  <span class="badge bg-secondary">${style.category}</span>
                </div>
                ${style.source_document ? `<p class="small text-muted">Extracted from: ${style.source_document}</p>` : ''}
                <div class="small mb-2">
                  <strong>Font:</strong> ${style.style.font_family}<br>
                  <strong>Colors:</strong> 
                  <span class="color-dot" style="background-color: ${style.style.heading_color}"></span>
                  <span class="color-dot" style="background-color: ${style.style.text_color}"></span>
                  <span class="color-dot" style="background-color: ${style.style.accent_color}"></span>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                  <button class="btn btn-sm btn-secondary" onclick="TemplateManager.applyStyle('${style.id}')">
                    <i class="fas fa-paint-brush"></i> Apply
                  </button>
                  <button class="btn btn-sm btn-outline-primary" onclick="TemplateManager.previewStyle('${style.id}')">
                    <i class="fas fa-eye"></i> Preview
                  </button>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      static loadEmailTemplatesGrid() {
        // Existing email templates loading logic
        this.displayTemplates(this.templates.email_templates || []);
      }
    }

    // Event Listeners
    function setupEventListeners() {
      // Auth forms
      document.getElementById('login-btn').addEventListener('click', handleLogin);
      document.getElementById('register-btn').addEventListener('click', handleRegister);
      document.getElementById('logout-btn').addEventListener('click', Auth.logout);
      
      // Enter key for forms
      document.getElementById('login-password').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleLogin();
      });
      
      // Chat input handler for AI agent modal
      const agentChatInput = document.getElementById('agent-chat-input');
      if (agentChatInput) {
        agentChatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') AgentManager.sendMessage();
        });
      }
      
      // Sidebar navigation
      document.querySelectorAll('[data-view]').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          ViewManager.switchView(link.dataset.view);
        });
      });
      
      // File upload
      document.getElementById('fileUpload').addEventListener('change', handleFileUpload);
      
      // PDF contact extraction
      const pdfUpload = document.getElementById('pdfUpload');
      if (pdfUpload) {
        pdfUpload.addEventListener('change', handlePDFUpload);
      }
      
      // Image/Business Card OCR
      const imageUpload = document.getElementById('imageUpload');
      if (imageUpload) {
        imageUpload.addEventListener('change', handleImageUpload);
      }
      
      // RFP file upload
      const rfpFileInput = document.getElementById('rfp-file-input');
      if (rfpFileInput) {
        rfpFileInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            document.querySelector('.upload-area h5').textContent = file.name;
          }
        });
      }
      
      // Module navigation
      document.querySelectorAll('[data-module]').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const module = link.dataset.module;
          
          if (module === 'education') {
            window.open('cadet_dashboard.html', '_blank');
            return;
          }
          
          // Update active module
          document.querySelectorAll('.module-nav-item').forEach(item => {
            item.classList.remove('active');
          });
          link.classList.add('active');
          
          // Hide all views
          document.querySelectorAll('.view-content').forEach(view => {
            view.style.display = 'none';
          });
          
          // Show appropriate view
          switch(module) {
            case 'crm':
              document.getElementById('contacts-view').style.display = 'block';
              ContactManager.loadContacts();
              break;
            case 'rfp':
              document.getElementById('rfp-view').style.display = 'block';
              RFPManager.loadRFPs();
              break;
            default:
              // Show dashboard
              document.getElementById('dashboard-view').style.display = 'block';
              AnalyticsManager.updateDashboard();
          }
        });
      });
    }

    // Event Handlers
    async function handleLogin() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('login-error');
      
      if (!username || !password) {
        errorDiv.textContent = 'Please enter both username and password';
        return;
      }
      
      try {
        document.getElementById('login-text').style.display = 'none';
        document.getElementById('login-spinner').style.display = 'inline-block';
        
        const success = await Auth.login(username, password);
        
        if (success) {
          Utils.showMain();
          await initializeApp();
          Utils.showNotification('Welcome back!', 'success');
        } else {
          errorDiv.textContent = 'Invalid username or password';
        }
      } catch (error) {
        errorDiv.textContent = error.message;
      } finally {
        document.getElementById('login-text').style.display = 'inline';
        document.getElementById('login-spinner').style.display = 'none';
      }
    }

    async function handleRegister() {
      const username = document.getElementById('reg-username').value.trim();
      const email = document.getElementById('reg-email').value.trim();
      const password = document.getElementById('reg-password').value;
      const confirm = document.getElementById('reg-confirm').value;
      const errorDiv = document.getElementById('register-error');
      
      if (!username || !email || !password) {
        errorDiv.textContent = 'All fields are required';
        return;
      }
      
      if (password !== confirm) {
        errorDiv.textContent = 'Passwords do not match';
        return;
      }
      
      try {
        document.getElementById('register-text').style.display = 'none';
        document.getElementById('register-spinner').style.display = 'inline-block';
        
        const success = await Auth.register(username, email, password);
        
        if (success) {
          Utils.showNotification('Account created successfully! Please log in.', 'success');
          showLogin();
        } else {
          errorDiv.textContent = 'Registration failed. Please try again.';
        }
      } catch (error) {
        errorDiv.textContent = error.message;
      } finally {
        document.getElementById('register-text').style.display = 'inline';
        document.getElementById('register-spinner').style.display = 'none';
      }
    }

    function sendChatMessage() {
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      if (message) {
        ChatManager.sendMessage(message);
      }
    }

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      Papa.parse(file, {
        header: true,
        complete: function(results) {
          if (results.data && results.data.length > 0) {
            // Process CSV data
            const newContacts = results.data.map(row => [
              row.Name || row.name || '',
              row.Email || row.email || '',
              row.Company || row.company || '',
              row.Focus || row.focus || '',
              row.Notes || row.notes || ''
            ]).filter(contact => contact[0] && contact[1]); // Only include rows with name and email
            
            AppState.contacts = [...AppState.contacts, ...newContacts];
            ContactManager.renderContactsTable();
            ContactManager.updateStats();
            Utils.showNotification(`Imported ${newContacts.length} contacts from CSV`, 'success');
          }
        },
        error: function(error) {
          Utils.showNotification(`CSV import error: ${error.message}`, 'error');
        }
      });
    }

    function handlePDFUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (file.type !== 'application/pdf') {
        Utils.showNotification('Please select a PDF file', 'warning');
        return;
      }
      
      ContactManager.extractContactsFromPDF(file);
      // Reset file input
      event.target.value = '';
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        Utils.showNotification('Please select an image file', 'warning');
        return;
      }
      
      ContactManager.processBusinessCard(file);
      // Reset file input
      event.target.value = '';
    }

    // Auth form toggles
    function showRegister() {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'block';
    }

    function showLogin() {
      document.getElementById('register-form').style.display = 'none';
      document.getElementById('login-form').style.display = 'block';
    }

    // Quick action functions
    function createNewContact() {
      const modal = new bootstrap.Modal(document.getElementById('createContactModal'));
      modal.show();
    }

    function openAIAgent() {
      Utils.showNotification('Advanced AI Agent interface - Coming soon!', 'info');
    }

    function generateReport() {
      Utils.showNotification('Report generation - Coming soon!', 'info');
    }

    function importContacts() {
      document.getElementById('fileUpload').click();
    }

    function showAllContacts() {
      ViewManager.switchView('contacts');
    }

    // Initialize App
    async function initializeApp() {
      try {
        // Check server health
        await Utils.apiCall(API_CONFIG.ENDPOINTS.HEALTH);
        
        // Load initial data
        await ContactManager.loadContacts();
        await RFPManager.loadRFPs();
        TemplateManager.init(); // Initialize template system
        
        // Initialize AI agents
        try {
          const agents = await Utils.apiCall(API_CONFIG.ENDPOINTS.AGENTS.INITIALIZE, {
            method: 'POST'
          });
          AppState.agents = agents;
          console.log('AI Agents initialized:', agents);
        } catch (error) {
          console.log('AI Agents initialization failed:', error.message);
        }
        
        console.log('App initialized successfully');
      } catch (error) {
        console.error('App initialization failed:', error);
        Utils.showNotification('Some features may not be available', 'warning');
      }
    }

    // App startup
    document.addEventListener('DOMContentLoaded', async function() {
      setupEventListeners();
      
      // Check for existing authentication
      const token = localStorage.getItem('anthesis_token');
      if (token) {
        const isValid = await Auth.validateToken();
        if (isValid) {
          AppState.isAuthenticated = true;
          Utils.showMain();
          await initializeApp();
        } else {
          localStorage.removeItem('anthesis_token');
          Utils.showLogin();
        }
      } else {
        Utils.showLogin();
      }
    });

    // Global error handler
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);
      Utils.showNotification('An unexpected error occurred', 'error');
    });

    // Handle unhandled promise rejections
    window.addEventListener('unhandledrejection', function(e) {
      console.error('Unhandled promise rejection:', e.reason);
      Utils.showNotification('An unexpected error occurred', 'error');
    });
  </script>
</body>
</html>
